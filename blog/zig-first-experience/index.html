<!DOCTYPE html><html lang="zh-CN"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/webp" href="/_astro/logo.zcK9pHo2_2eS7vq.webp"><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/rss+xml" title="Zero Calorie Drink Shop" href="https://lhcfl.github.io/rss.xml"><meta name="generator" content="Astro v5.10.0"><!-- Font --><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://chinese-fonts-cdn.deno.dev"><link rel="preconnect" href="https://ik.imagekit.io" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://lhcfl.github.io/blog/zig-first-experience/"><!-- Primary Meta Tags --><title>更好的 C 语言：Zig 初体验 ⬝ Zero Calorie Drink Shop</title><meta name="title" content="更好的 C 语言：Zig 初体验 ⬝ Zero Calorie Drink Shop"><meta name="description" content="久闻 Zig 语言大名，作为一众底层语言的有力竞争者，Zig 被常常认为是 better C。Zig 自己也说，“Zig 与 C 竞争，而不是依赖于它”。前天用 Zig 写了一个简单的命令行跨平台贪吃蛇游戏，也算是体验了一下 Zig 的有趣功能。
"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://lhcfl.github.io/blog/zig-first-experience/"><meta property="og:title" content="更好的 C 语言：Zig 初体验 ⬝ Zero Calorie Drink Shop"><meta property="og:description" content="久闻 Zig 语言大名，作为一众底层语言的有力竞争者，Zig 被常常认为是 better C。Zig 自己也说，“Zig 与 C 竞争，而不是依赖于它”。前天用 Zig 写了一个简单的命令行跨平台贪吃蛇游戏，也算是体验了一下 Zig 的有趣功能。
"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://lhcfl.github.io/blog/zig-first-experience/"><meta property="twitter:title" content="更好的 C 语言：Zig 初体验 ⬝ Zero Calorie Drink Shop"><meta property="twitter:description" content="久闻 Zig 语言大名，作为一众底层语言的有力竞争者，Zig 被常常认为是 better C。Zig 自己也说，“Zig 与 C 竞争，而不是依赖于它”。前天用 Zig 写了一个简单的命令行跨平台贪吃蛇游戏，也算是体验了一下 Zig 的有趣功能。
"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.AM2StPgK.js"></script><link rel="stylesheet" href="/_astro/_static_page_.DYt1UbNe.css">
<link rel="stylesheet" href="/_astro/_static_page_.DST4ihUU.css">
<link rel="stylesheet" href="/_astro/_static_page_.CGWgwbcx.css">
<style>@reference "../styles/tailwind.css";.items[data-astro-cid-qtyrxm4s]{display:flex;flex-wrap:wrap;gap:calc(var(--spacing) * 2);max-width:100%;text-overflow:ellipsis;overflow:hidden}.item[data-astro-cid-qtyrxm4s]{font-size:var(--text-sm-fontSize);line-height:var(--un-leading, var(--text-sm-lineHeight));display:flex;gap:calc(var(--spacing) * 1);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;align-items:center;position:relative}.item[data-astro-cid-qtyrxm4s]:after{background-color:color-mix(in srgb,var(--colors-primary) 50%,transparent);width:100%;height:.15em;--un-scale-x:0%;--un-scale-y:0%;scale:var(--un-scale-x) var(--un-scale-y);transition-property:all;transition-timing-function:var(--un-ease, var(--default-transition-timingFunction));transition-duration:var(--un-duration, var(--default-transition-duration));left:calc(var(--spacing) * 0);bottom:calc(var(--spacing) * 0);position:absolute;content:""}@supports (color: color-mix(in lab,red,red)){.item[data-astro-cid-qtyrxm4s]:after{background-color:color-mix(in oklab,var(--colors-primary) 50%,transparent)}}@property --un-bg-opacity{syntax:"<percentage>";inherits:false;initial-value:100%;}.item[data-astro-cid-qtyrxm4s]:hover:after{--un-scale-x:100%;--un-scale-y:100%;scale:var(--un-scale-x) var(--un-scale-y)}@property --un-scale-x{syntax:"*";inherits:false;initial-value:1;syntax:"*";inherits:false;initial-value:1;}@property --un-scale-y{syntax:"*";inherits:false;initial-value:1;syntax:"*";inherits:false;initial-value:1;}@property --un-scale-z{syntax:"*";inherits:false;initial-value:1;syntax:"*";inherits:false;initial-value:1;}
</style><script type="module" src="/_astro/page.sN3tJsal.js"></script></head> <body class="overflow-y-scroll has-sidebar"> <div class="app bg-surface text-content md:flex lg:justify-center max-w-full">  <header class="print:hidden flex sticky top-0 flex-[0_0_auto]" un-max-md="items-center justify-between w-full h-15 z-50 bg-surface px-2" un-max-lg="w-20" un-lg="w-70" un-md="flex-col h-screen text-lg p-4 flex-shrink-0 flex-grow-0" un-border="max-md:b md:r  base-300"> <a href="/" class="flex flex-col items-center gap-2 lg:mt-4"> <div class="nav-site-avatar avatar w-10 md:w-12 lg:hidden"> <img src="/_astro/logo.zcK9pHo2_2eS7vq.webp" alt="Zero Calorie Drink Shop" loading="eager" decoding="async" fetchpriority="auto" width="100" height="100"> </div> <div class="nav-site-avatar avatar max-lg:hidden w-40"> <img src="/_astro/logo.zcK9pHo2_16JEEU.webp" alt="Zero Calorie Drink Shop" loading="eager" decoding="async" fetchpriority="auto" width="512" height="512"> </div> <span class="nav-site-title text-lg font-bold max-lg:hidden">Zero Calorie Drink Shop</span> </a> <nav class="links flex items-center gap-2 text-lg" un-md="flex-col pt-6 text-2xl" un-lg="text-base"> <a href="/" role="button" class="header-link flex items-center justify-center gap-1 transition md:h-10 md:w-full md:hover:bg-primary/10 md:hover:text-primary" aria-label="Home" data-path-name="blog/zig-first-experience/" data-href-base="/"> <svg width="1em" height="1em" data-icon="mingcute:home-3-line">   <symbol id="ai:mingcute:home-3-line" viewBox="0 0 24 24"><g fill="none"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M10.772 2.688a2 2 0 0 1 2.317-.099l.139.1l8.384 6.52c.721.561.37 1.692-.499 1.785l-.116.006H20v8a2 2 0 0 1-1.85 1.995L18 21H6a2 2 0 0 1-1.994-1.85L4 19v-8h-.997C2.09 11 1.671 9.892 2.3 9.285l.088-.076zM12 4.267L5.625 9.225c.229.185.375.468.375.785V19h3v-5a3 3 0 1 1 6 0v5h3v-8.99c0-.317.146-.6.375-.785zM12 13a1 1 0 0 0-1 1v5h2v-5a1 1 0 0 0-1-1"/></g></symbol><use href="#ai:mingcute:home-3-line"></use>  </svg> <span class="max-lg:hidden"> Home </span> </a><a href="/archives" role="button" class="header-link flex items-center justify-center gap-1 transition md:h-10 md:w-full md:hover:bg-primary/10 md:hover:text-primary" aria-label="Archives" data-path-name="blog/zig-first-experience/" data-href-base="archives"> <svg width="1em" height="1em" data-icon="mingcute:archive-line">   <symbol id="ai:mingcute:archive-line" viewBox="0 0 24 24"><g fill="none" fill-rule="evenodd"><path d="m12.594 23.258l-.012.002l-.071.035l-.02.004l-.014-.004l-.071-.036q-.016-.004-.024.006l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.016-.018m.264-.113l-.014.002l-.184.093l-.01.01l-.003.011l.018.43l.005.012l.008.008l.201.092q.019.005.029-.008l.004-.014l-.034-.614q-.005-.019-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.003-.011l.018-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M16.586 3A2 2 0 0 1 18 3.586L20.414 6A2 2 0 0 1 21 7.414V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7.414A2 2 0 0 1 3.586 6L6 3.586A2 2 0 0 1 7.414 3zM19 9H5v10h14zm-7 1a1 1 0 0 1 1 1v3.186l.414-.414a1 1 0 1 1 1.414 1.414l-2.12 2.121a1 1 0 0 1-1.415 0l-2.121-2.121a1 1 0 1 1 1.414-1.414l.414.414V11a1 1 0 0 1 1-1m4.586-5H7.414l-2 2h13.172z"/></g></symbol><use href="#ai:mingcute:archive-line"></use>  </svg> <span class="max-lg:hidden"> Archives </span> </a><a href="/notes/1" role="button" class="header-link flex items-center justify-center gap-1 transition md:h-10 md:w-full md:hover:bg-primary/10 md:hover:text-primary" aria-label="Notes" data-path-name="blog/zig-first-experience/" data-href-base="notes"> <svg width="1em" height="1em" data-icon="mingcute:notebook-line">   <symbol id="ai:mingcute:notebook-line" viewBox="0 0 24 24"><g fill="none"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M17 2c1.598 0 3 1.3 3 3v13c0 1.7-1.4 3-3 3H6c-1.054 0-2-.95-2-2V4c0-1.054.95-2 2-2zm0 2h-7v15h7c.513 0 1-.39 1-1V5c0-.513-.49-1-1-1M8 4H6v15h2z"/></g></symbol><use href="#ai:mingcute:notebook-line"></use>  </svg> <span class="max-lg:hidden"> Notes </span> </a><a href="/tags" role="button" class="header-link flex items-center justify-center gap-1 transition md:h-10 md:w-full md:hover:bg-primary/10 md:hover:text-primary" aria-label="Tags" data-path-name="blog/zig-first-experience/" data-href-base="tags"> <svg width="1em" height="1em" data-icon="mingcute:tag-2-line">   <symbol id="ai:mingcute:tag-2-line" viewBox="0 0 24 24"><g fill="none"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M10.238 4.827a3 3 0 0 1 2.122.878l6.485 6.486a3 3 0 0 1 0 4.242l-4.243 4.243a3 3 0 0 1-4.242 0l-6.486-6.485a3 3 0 0 1-.878-2.122V7.327a2.5 2.5 0 0 1 2.5-2.5zm0 2H5.496a.5.5 0 0 0-.5.5v4.742a1 1 0 0 0 .292.707l6.486 6.486a1 1 0 0 0 1.414 0l4.243-4.243a1 1 0 0 0 0-1.414L10.945 7.12a1 1 0 0 0-.707-.293M7.531 9.362a1.5 1.5 0 1 1 2.121 2.122a1.5 1.5 0 0 1-2.121-2.122M11.652 2a3 3 0 0 1 2.122.878l7.192 7.193a1 1 0 0 1-1.414 1.414L12.36 4.29a1 1 0 0 0-.708-.29H7a1 1 0 0 1 0-2z"/></g></symbol><use href="#ai:mingcute:tag-2-line"></use>  </svg> <span class="max-lg:hidden"> Tags </span> </a><a href="/about" role="button" class="header-link flex items-center justify-center gap-1 transition md:h-10 md:w-full md:hover:bg-primary/10 md:hover:text-primary" aria-label="About" data-path-name="blog/zig-first-experience/" data-href-base="about"> <svg width="1em" height="1em" data-icon="mingcute:user-3-line">   <symbol id="ai:mingcute:user-3-line" viewBox="0 0 24 24"><g fill="none" fill-rule="evenodd"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M12 13c2.396 0 4.575.694 6.178 1.672c.8.488 1.484 1.064 1.978 1.69c.486.615.844 1.351.844 2.138c0 .845-.411 1.511-1.003 1.986c-.56.45-1.299.748-2.084.956c-1.578.417-3.684.558-5.913.558s-4.335-.14-5.913-.558c-.785-.208-1.524-.506-2.084-.956C3.41 20.01 3 19.345 3 18.5c0-.787.358-1.523.844-2.139c.494-.625 1.177-1.2 1.978-1.69C7.425 13.695 9.605 13 12 13m0 2c-2.023 0-3.843.59-5.136 1.379c-.647.394-1.135.822-1.45 1.222c-.324.41-.414.72-.414.899c0 .122.037.251.255.426c.249.2.682.407 1.344.582C7.917 19.858 9.811 20 12 20c2.19 0 4.083-.143 5.4-.492c.663-.175 1.096-.382 1.345-.582c.218-.175.255-.304.255-.426c0-.18-.09-.489-.413-.899c-.316-.4-.804-.828-1.451-1.222C15.843 15.589 14.023 15 12 15m0-13a5 5 0 1 1 0 10a5 5 0 0 1 0-10m0 2a3 3 0 1 0 0 6a3 3 0 0 0 0-6"/></g></symbol><use href="#ai:mingcute:user-3-line"></use>  </svg> <span class="max-lg:hidden"> About </span> </a><a href="/links" role="button" class="header-link flex items-center justify-center gap-1 transition md:h-10 md:w-full md:hover:bg-primary/10 md:hover:text-primary" aria-label="Links" data-path-name="blog/zig-first-experience/" data-href-base="links"> <svg width="1em" height="1em" data-icon="mingcute:link-3-line">   <symbol id="ai:mingcute:link-3-line" viewBox="0 0 24 24"><g fill="none" fill-rule="evenodd"><path d="m12.594 23.258l-.012.002l-.071.035l-.02.004l-.014-.004l-.071-.036q-.016-.004-.024.006l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.016-.018m.264-.113l-.014.002l-.184.093l-.01.01l-.003.011l.018.43l.005.012l.008.008l.201.092q.019.005.029-.008l.004-.014l-.034-.614q-.005-.019-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.003-.011l.018-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M1 10a5 5 0 0 1 5-5h6a5 5 0 0 1 0 10a1 1 0 1 1 0-2a3 3 0 1 0 0-6H6a3 3 0 0 0-.75 5.906a1 1 0 0 1-.5 1.936A5 5 0 0 1 1 10m11 1a3 3 0 1 0 0 6h6a3 3 0 0 0 .75-5.905a1 1 0 0 1 .5-1.937A5.002 5.002 0 0 1 18 19h-6a5 5 0 0 1 0-10a1 1 0 1 1 0 2"/></g></symbol><use href="#ai:mingcute:link-3-line"></use>  </svg> <span class="max-lg:hidden"> Links </span> </a><a href="/search" role="button" class="header-link flex items-center justify-center gap-1 transition md:h-10 md:w-full md:hover:bg-primary/10 md:hover:text-primary" aria-label="Search" data-path-name="blog/zig-first-experience/" data-href-base="search"> <svg width="1em" height="1em" data-icon="mingcute:search-3-line">   <symbol id="ai:mingcute:search-3-line" viewBox="0 0 24 24"><g fill="none" fill-rule="evenodd"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M10.5 4a6.5 6.5 0 1 0 0 13a6.5 6.5 0 0 0 0-13M2 10.5a8.5 8.5 0 1 1 15.176 5.262l3.652 3.652a1 1 0 0 1-1.414 1.414l-3.652-3.652A8.5 8.5 0 0 1 2 10.5M9.5 7a1 1 0 0 1 1-1a4.5 4.5 0 0 1 4.5 4.5a1 1 0 1 1-2 0A2.5 2.5 0 0 0 10.5 8a1 1 0 0 1-1-1"/></g></symbol><use href="#ai:mingcute:search-3-line"></use>  </svg> <span class="max-lg:hidden"> Search </span> </a> </nav> <div class="navbar-end" un-md="flex-grow flex items-baseline-last justify-center"> <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();</script><script>(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t),11:t=>1/0*t},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="18tXJb" component-url="/_astro/DarkLightToggle.6qHju4aH.js" component-export="default" renderer-url="/_astro/client.svelte.DMhakGtm.js" props="{}" ssr client="load" opts="{&quot;name&quot;:&quot;DarkLightToggle&quot;,&quot;value&quot;:true}" await-children><!--[--><button class="i-mingcute:moon-stars-line" aria-label="toggle theme"></button><!--]--><!--astro:end--></astro-island> </div> </header> <div class="main-and-footer__outer-container
        max-w-full min-h-screen overflow-x-hidden
        flex flex-grow flex-shrink flex-basis-200 xl:flex-grow-0 at-md:justify-center"> <div class="flex flex-col w-full max-w-200"> <main class="flex-grow relative p-4 md:pt-6 undefined">  <article> <h1 class="page-title text-3xl font-bold">  <span>更好的 C 语言：Zig 初体验</span>  </h1> <div> <div class="markdown-body is-detailed"> <p lang="zh">久闻 <a href="https://ziglang.org/">Zig</a> 语言大名，作为一众底层语言的有力竞争者，Zig 被常常认为是 better C。Zig 自己也说，“Zig 与 C 竞争，而不是依赖于它”。前天用 Zig 写了一个简单的命令行跨平台贪吃蛇游戏，也算是体验了一下 Zig 的有趣功能。</p>
<!-- more -->
<h3 id="zig-核心">Zig 核心</h3>
<p lang="zh">照例先来写个 hello world 然后说一下 Zig 官方的简介：</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="zig"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#E36209;--shiki-dark:#FFAB70"> std</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> @import</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"std"</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">pub</span><span style="color:#D73A49;--shiki-dark:#F97583"> fn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> main</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">!void</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">    std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#E36209;--shiki-dark:#FFAB70">debug</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">print</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"hello, world</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, .</span><span style="color:#5a32a3;--shiki-dark:#b392f0">{</span><span style="color:#5a32a3;--shiki-dark:#b392f0">}</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span></code></pre>
<blockquote>
<p lang="zh"><strong>Zig 是一种简单的语言。</strong>
专注于调试你的应用程序，而不是调试你的编程语言知识。</p>
<ul lang="zh">
<li>没有隐式控制流。</li>
<li>没有隐式内存分配。</li>
<li>没有预处理器，没有宏。</li>
</ul>
<p lang="zh"><strong>编译期代码执行</strong>
基于编译期代码执行和惰性求值的全新元编程方法。</p>
<ul lang="zh">
<li>编译期调用任意函数。</li>
<li>在没有运行时开销的情况下，将类型作为值进行操作。</li>
<li>编译期模拟目标架构。</li>
</ul>
</blockquote>
<p lang="zh">实际上在我的体验来看，Zig 这几个特色确实非常突出，可以说是这个语言最重要的特色甚至是基石了。</p>
<h3 id="没有隐式控制流">没有隐式控制流</h3>
<p lang="zh">其实我觉得这没什么特别大的必要，毕竟重载运算符还是一个很方便的语言特性的，但是 Zig 排除了它。</p>
<p lang="zh">Zig 抛弃隐式控制流是为了可读性和可维护性。不过我觉得这更可能是一种 C with classes<sup><a href="#user-content-fn-%E8%BF%99%E9%87%8C%E6%8C%87%E4%BB%A3%E4%B8%8D%E5%A5%BD%E5%A5%BD%E5%AD%A6%20c++%20%E6%8B%BF%20c%20%E8%AF%AD%E8%A8%80%E7%9A%84%E7%BB%8F%E9%AA%8C%E5%86%99%E4%BB%A3%E7%A0%81%E7%9A%84%E5%82%BB%E7%93%9C" id="user-content-fnref-%E8%BF%99%E9%87%8C%E6%8C%87%E4%BB%A3%E4%B8%8D%E5%A5%BD%E5%A5%BD%E5%AD%A6%20c++%20%E6%8B%BF%20c%20%E8%AF%AD%E8%A8%80%E7%9A%84%E7%BB%8F%E9%AA%8C%E5%86%99%E4%BB%A3%E7%A0%81%E7%9A%84%E5%82%BB%E7%93%9C" data-footnote-ref="" aria-describedby="footnote-label">1</a></sup> 心理阴影（？</p>
<p lang="zh">一个不负责任的 <ruby>C++<rt>C with classes</rt></ruby> 程序员有可能会写出这样的代码——</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="c"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> foo</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    auto some_resource </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> bar</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    baz</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">some_resource</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    some_resource.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">close</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span></code></pre>
<p lang="zh">这看上去一点问题都没有，对吧。创建资源，使用资源，释放资源。这如果写成等价的的 C 语言是一点问题都没有的，可惜这是 C++。C++是有异常的，你在 <code>baz</code> 的时候说不定在调用栈的深处从哪抛出了一个异常，于是你的资源就没有释放——最常见的是内存泄漏，更坏一些的可能是网络资源或者文件资源，于是你的程序直接崩溃了，甚至丢失用户数据。</p>
<p lang="zh">拿 C with classes 的思路，抛弃 RAII<sup><a href="#user-content-fn-%E4%B8%8D%E8%A6%81%E9%97%AE%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E6%8A%9B%E5%BC%83%20raii%20%E8%BF%99%E6%A0%B7%E7%9A%84%E5%A5%BD%E4%B8%9C%E8%A5%BF%E3%80%82%E8%BF%99%E5%B0%B1%E6%98%AF%E6%B4%BB%E8%B7%83%E4%BA%8E%E7%BC%96%E7%A8%8B%E8%AF%9D%E9%A2%98%E4%B8%8B%20c%20with%20classes%20%E4%BA%BA%EF%BC%8C%E4%BB%96%E4%BB%AC%E5%9D%9A%E4%BF%A1%20c%20with%20classes%20%E5%B0%B1%E8%83%BD%E6%BB%A1%E8%B6%B3%2099%25%20%E7%9A%84%E9%9C%80%E6%B1%82" id="user-content-fnref-%E4%B8%8D%E8%A6%81%E9%97%AE%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E6%8A%9B%E5%BC%83%20raii%20%E8%BF%99%E6%A0%B7%E7%9A%84%E5%A5%BD%E4%B8%9C%E8%A5%BF%E3%80%82%E8%BF%99%E5%B0%B1%E6%98%AF%E6%B4%BB%E8%B7%83%E4%BA%8E%E7%BC%96%E7%A8%8B%E8%AF%9D%E9%A2%98%E4%B8%8B%20c%20with%20classes%20%E4%BA%BA%EF%BC%8C%E4%BB%96%E4%BB%AC%E5%9D%9A%E4%BF%A1%20c%20with%20classes%20%E5%B0%B1%E8%83%BD%E6%BB%A1%E8%B6%B3%2099%25%20%E7%9A%84%E9%9C%80%E6%B1%82" data-footnote-ref="" aria-describedby="footnote-label">2</a></sup>，不让人用异常却忽视 STL 中有大量异常。隐式控制流用好了非常好用，但是用得烂的话就是对可读性和可维护性的损失。而 Zig 是一门追求简洁的语言，于是它抛弃了它。</p>
<p lang="zh">如果 Zig 代码看起来不像是在调用一个函数，那么它就不是。这意味着你可以确定下面的代码只会先调用 <code>foo()</code>，然后一定会^[当然 <code>foo()</code> 有可能死循环或者在某处被你使用 <code>panic</code> 或者 <code>std.process.exit(1)</code> 之类的强制结束进程，导致 <code>bar()</code> 无法被执行。但是任何一个图灵完备的编程语言都没办法完全预防前者，这是停机问题。]调用 <code>bar()</code>，不需要知道任何元素的类型，这一点也是可以保证的：</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="zig"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#E36209;--shiki-dark:#FFAB70"> a</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#E36209;--shiki-dark:#FFAB70"> b</span><span style="color:#D73A49;--shiki-dark:#F97583"> +</span><span style="color:#E36209;--shiki-dark:#FFAB70"> c</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#E36209;--shiki-dark:#FFAB70">d</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">foo</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">bar</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span></code></pre>
<h3 id="没有隐式内存分配">没有隐式内存分配</h3>
<p lang="zh">真是为嵌入式着想啊（赞美）</p>
<p lang="zh">对于许多桌面应用程序——也就是 Rust, C++, Go, Java 发光发热的地方，操作系统肯定会提供好的内存分配器，没有隐式内存分配完全就是增加复杂性，所以这个设计完全是为了 zig 一次编写到处运行的宏大理想而量身定制</p>
<p lang="zh">zig 语言完全没有任何隐式内存分配。包括标准库——除了那些本身就是用来做堆分配器的 API。所以只要你不用堆分配器，你的代码就不会有堆分配。这意味着你完全可以在裸金属环境下使用几乎全部标准库，而 C++ 和 Rust 都要排除掉依赖内存分配器的实用标准库。</p>
<p lang="zh">举个例子，当你想要一个双向链表的时候，Zig 提供的是这样的 API：</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="zig"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">pub</span><span style="color:#D73A49;--shiki-dark:#F97583"> fn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> append</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">list</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#E36209;--shiki-dark:#FFAB70">Self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">new_node</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#E36209;--shiki-dark:#FFAB70">Node</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">void</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// Insert a new node at the end of the list.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">pub</span><span style="color:#D73A49;--shiki-dark:#F97583"> fn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> pop</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">list</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#E36209;--shiki-dark:#FFAB70">Self</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">?*</span><span style="color:#E36209;--shiki-dark:#FFAB70">Node</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// Remove and return the last node in the list.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">pub</span><span style="color:#D73A49;--shiki-dark:#F97583"> fn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> popFirst</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">list</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#E36209;--shiki-dark:#FFAB70">Self</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">?*</span><span style="color:#E36209;--shiki-dark:#FFAB70">Node</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// Remove and return the first node in the list.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">pub</span><span style="color:#D73A49;--shiki-dark:#F97583"> fn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> prepend</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">list</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#E36209;--shiki-dark:#FFAB70">Self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">new_node</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#E36209;--shiki-dark:#FFAB70">Node</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">void</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// Insert a new node at the beginning of the list.</span></span></code></pre>
<p lang="zh">注意到全部需要插入 <code>*Node</code> 类型！也就是说，Zig 把对 <code>Node</code> 进行内存分配的任务交给了你，你可以自由安排将它分配在什么位置，无论是堆上还是 buffer 上。Zig 给了程序员最大的自由来调配内存分配——这在底层开发、嵌入式开发中非常重要。</p>
<p lang="zh">当然这使得 Zig 程序需要到处传递 <code>Allocator</code>，使得在比较偏应用层的代码里比较难绷，不过 Zig 本来就不是设计出来干这种事情的——你也不会用 C 语言去写应用吧，自讨苦吃的事情还是少干（</p>
<h3 id="超强的-c-交互性">超强的 C 交互性</h3>
<p lang="zh">说到嵌入式，许多嵌入式的机器，厂商只给了 C 库，如果是别的语言（除了 C++ ）的话，就不得不通过 C ABI 专门定义自己的函数来互操作了，到时候还得交叉编译，非常麻烦。所以就算 Rust 非常安全，也没什么人拿来用作嵌入式，大家还是老老实实写 C。</p>
<p lang="zh">而 Zig 就是破局者，因为 Zig 直接内置了 C 语言支持。和 C++ 不同的是，Zig 的 C 语言支持堪称十分明智，它提供了某种自动重写，你可以直接使用 <code>@cImport</code> 导入 C 语言的头文件，直接使用 C 语言的函数，而且还有完美的类型支持。</p>
<p lang="zh">比如我写的贪吃小游戏，为了直接读取键盘操作，需要用到操作系统给的库。Zig 没有对应的 std 支持怎么办？没关系，直接导入 <code>windows.h</code></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="zig"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#E36209;--shiki-dark:#FFAB70"> std</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> @import</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"std"</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#E36209;--shiki-dark:#FFAB70"> c_windows</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> @cImport</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#e36209;--shiki-dark:#ffab70">{</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    @cInclude</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"windows.h"</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#e36209;--shiki-dark:#ffab70">}</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">pub</span><span style="color:#D73A49;--shiki-dark:#F97583"> const</span><span style="color:#E36209;--shiki-dark:#FFAB70"> GetchError</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> error</span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">    CannotGetStdHandle</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">    ReadNotOk</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">pub</span><span style="color:#D73A49;--shiki-dark:#F97583"> fn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> getch_win</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#E36209;--shiki-dark:#FFAB70">GetchError</span><span style="color:#D73A49;--shiki-dark:#F97583">!i32</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    const</span><span style="color:#E36209;--shiki-dark:#FFAB70"> stdin</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#E36209;--shiki-dark:#FFAB70"> std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#E36209;--shiki-dark:#FFAB70">os</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#E36209;--shiki-dark:#FFAB70">windows</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">GetStdHandle</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#E36209;--shiki-dark:#FFAB70">os</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#E36209;--shiki-dark:#FFAB70">windows</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#E36209;--shiki-dark:#FFAB70">STD_INPUT_HANDLE</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">catch</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#e36209;--shiki-dark:#ffab70">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#E36209;--shiki-dark:#FFAB70"> GetchError</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#E36209;--shiki-dark:#FFAB70">CannotGetStdHandle</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    </span><span style="color:#e36209;--shiki-dark:#ffab70">}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    var</span><span style="color:#E36209;--shiki-dark:#FFAB70"> input_record</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#E36209;--shiki-dark:#FFAB70">c_windows</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#E36209;--shiki-dark:#FFAB70">INPUT_RECORD</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> undefined</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    var</span><span style="color:#E36209;--shiki-dark:#FFAB70"> _num_events_read</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#E36209;--shiki-dark:#FFAB70">std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#E36209;--shiki-dark:#FFAB70">os</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#E36209;--shiki-dark:#FFAB70">windows</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#E36209;--shiki-dark:#FFAB70">DWORD</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> undefined</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    while</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#D73A49;--shiki-dark:#F97583">true</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#e36209;--shiki-dark:#ffab70">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        const</span><span style="color:#E36209;--shiki-dark:#FFAB70"> ok</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#E36209;--shiki-dark:#FFAB70"> c_windows</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ReadConsoleInputW</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">stdin</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#E36209;--shiki-dark:#FFAB70">input_record</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#E36209;--shiki-dark:#FFAB70">_num_events_read</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">ok</span><span style="color:#D73A49;--shiki-dark:#F97583"> ==</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#5a32a3;--shiki-dark:#b392f0">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            return</span><span style="color:#E36209;--shiki-dark:#FFAB70"> GetchError</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#E36209;--shiki-dark:#FFAB70">ReadNotOk</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        </span><span style="color:#5a32a3;--shiki-dark:#b392f0">}</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">input_record</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#E36209;--shiki-dark:#FFAB70">EventType</span><span style="color:#D73A49;--shiki-dark:#F97583"> !=</span><span style="color:#E36209;--shiki-dark:#FFAB70"> c_windows</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#E36209;--shiki-dark:#FFAB70">KEY_EVENT</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#5a32a3;--shiki-dark:#b392f0">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            continue</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        </span><span style="color:#5a32a3;--shiki-dark:#b392f0">}</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">input_record</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#E36209;--shiki-dark:#FFAB70">Event</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#E36209;--shiki-dark:#FFAB70">KeyEvent</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#E36209;--shiki-dark:#FFAB70">bKeyDown</span><span style="color:#D73A49;--shiki-dark:#F97583"> !=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#5a32a3;--shiki-dark:#b392f0">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            continue</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        </span><span style="color:#5a32a3;--shiki-dark:#b392f0">}</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#E36209;--shiki-dark:#FFAB70"> input_record</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#E36209;--shiki-dark:#FFAB70">Event</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#E36209;--shiki-dark:#FFAB70">KeyEvent</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#E36209;--shiki-dark:#FFAB70">wVirtualKeyCode</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    </span><span style="color:#e36209;--shiki-dark:#ffab70">}</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span></code></pre>
<p lang="zh">是的，只需要一个 <code>@cImport</code>， <code>windows.h</code> 里的所有函数就能为 zig 所用。 Zig 会自动将导入的 C 库重写成 Zig 的语法来提供合适的类型定义和语法高亮，完全和你用 zig 原生库一样简单——除了需要 C 风格的错误处理和字符串。真是应了<a href="https://ziglang.org/zh-CN/learn/overview/">深入了解 ⚡ Zig 编程语言</a>那句话，<em>Zig 比 C 更擅长使用 C 库。</em></p>
<p><img  loading="lazy" decoding="async" fetchpriority="auto" width="1889" height="373" src="/_astro/Pasted%20image%2020250206205023.rEis8Uvl_1jBoi6.webp" ></p>
<p lang="zh">相比于 C++ 直接在语法上兼容 C 最后被 C 的历史遗留问题坑死，Zig 的做法简直明智多了，直接通过原生支持交叉编译互相导入来解决问题，一点历史包袱不负同时还兼顾了兼容性和迁移能力。</p>
<p lang="zh">另外，zig 编译器还可以直接编译和运行 C/C++代码。这更是为 zig 提供了逐步替换 C 项目的可能。想想看，想要为你的 C 项目引入 Zig 只需要把编译器换成 Zig，然后添加新的 Zig 文件愉快写代码就可以了，那有什么理由不试试呢？</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>$ zig run prime_fast_cpp.cpp --library c++</span></span>
<span class="line"><span>start calculating</span></span>
<span class="line"><span>1227 ms</span></span>
<span class="line"><span>2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67, 71, 73, 79, 83, 89, 97, 101, 103, 107, 109, 113, 127, 131, 137, 139, 149, 151, 157, 163, 167, 173, 179, 181, 191, 193, 197, 199, 211, 223, 227, 229, 233, 239, 241, 251, 257, 263, 269, 271, 277, 281, 283, 293, 307, 311, 313, 317, 331, 337, 347, 349, 353, 359, 367, 373, 379, 383, 389, 397, 401, 409, 419, 421, 431, 433, 439, 443, 449, 457, 461, 463, 467, 479, 487, 491, 499, 503, 509, 521, 523, 541,</span></span>
<span class="line"><span></span></span>
<span class="line"><span>$ zig run prime_fast.c --library c</span></span>
<span class="line"><span>start calculating</span></span>
<span class="line"><span>1411 ms</span></span>
<span class="line"><span>2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67, 71, 73, 79, 83, 89, 97, 101, 103, 107, 109, 113, 127, 131, 137, 139, 149, 151, 157, 163, 167, 173, 179, 181, 191, 193, 197, 199, 211, 223, 227, 229, 233, 239, 241, 251, 257, 263, 269, 271, 277, 281, 283, 293, 307, 311, 313, 317, 331, 337, 347, 349, 353, 359, 367, 373, 379, 383, 389, 397, 401, 409, 419, 421, 431, 433, 439, 443, 449, 457, 461, 463, 467, 479, 487, 491, 499, 503, 509, 521, 523, 541,</span></span>
<span class="line"><span></span></span>
<span class="line"><span>$ zig run prime_fast.zig</span></span>
<span class="line"><span>start calculating</span></span>
<span class="line"><span>done, executed in 1274900500 nanoseconds</span></span>
<span class="line"><span>2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67, 71, 73, 79, 83, 89, 97, 101, 103, 107, 109, 113, 127, 131, 137, 139, 149, 151, 157, 163, 167, 173, 179, 181, 191, 193, 197, 199, 211, 223, 227, 229, 233, 239, 241, 251, 257, 263, 269, 271, 277, 281, 283, 293, 307, 311, 313, 317, 331, 337, 347, 349, 353, 359, 367, 373, 379, 383, 389, 397, 401, 409, 419, 421, 431, 433, 439, 443, 449, 457, 461, 463, 467, 479, 487, 491, 499, 503, 509, 521, 523, 541,</span></span></code></pre>
<center><small>上述代码是我用 C，C++，Zig 分别写的快速筛素数。算法相同。</small></center>
<h3 id="更好的错误处理">更好的错误处理</h3>
<p lang="en">和 Rust 一样，zig 抛弃了 null 的空处理和 exception 的错误处理。Null 的事情不用我说，大家应该都知道 <a href="https://www.infoq.com/presentations/Null-References-The-Billion-Dollar-Mistake-Tony-Hoare/">Null References: The Billion Dollar Mistake</a></p>
<blockquote>
<p lang="en">I call it my billion-dollar mistake. At that time, I was designing the first comprehensive type system for references in an object-oriented language. My goal was to ensure that all use of references should be absolutely safe, with checking performed automatically by the compiler. But I couldn’t resist the temptation to put in a null reference, simply because it was so easy to implement. This has led to innumerable errors, vulnerabilities, and system crashes, which have probably caused a billion dollars of pain and damage in the last forty years.</p>
</blockquote>
<p lang="nb">Zig 没有对 Rust 那样 enum 的原生支持（大概是因为它是 better C 而不是 C++），而是引入了两种类型，<code>?T</code> 和 <code>Error!T</code> 分别代表 <code>Option&#x3C;T></code> 和 <code>Result&#x3C;T, Error></code>。</p>
<p lang="zh">与 C 完全不一样的是，Zig 的普通指针 <code>*T</code> 不能为 null，只有 optional pointer <code>?*T</code> 可以为 null。这样以来，人们就不需要担心一个 <code>*T</code> 被意外的传入 null 而不停地编写重复的 <code>if (xxx == null) return;</code> 了</p>
<p lang="zh">Zig 的错误处理也非常有意思。Zig 的错误类型能且仅能是一个 enum，我对此只能说有好有坏吧，坏处是没法返回 struct 来得到更详细的错误信息，好处大概是其实它就是 C 语言<strong>错误码</strong>的对应——毕竟 Zig 一心设计为一个更好的 C 而不是 C++（不然就和 Rust 生态位重了）我们最常见到 C 语言中使用</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="c"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> foo</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">Foo</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#E36209;--shiki-dark:#FFAB70"> res</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Args </span><span style="color:#E36209;--shiki-dark:#FFAB70">args</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span></code></pre>
<p lang="zh">来表示一个可能出错的函数，然后查表每个错误码代表着什么。然后又有 Linux 风格和 Windows 风格，有的返回 0 代表成功，有的返回 1 代表成功，还有的返回一串 bit，每一位代表哪一个参数成功了……而 Zig 就不需要这一堆混乱的东西，错误类型已经在 enum 的名字里告诉你了。</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="zig"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">pub</span><span style="color:#D73A49;--shiki-dark:#F97583"> const</span><span style="color:#E36209;--shiki-dark:#FFAB70"> GetchError</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> error</span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">    CannotGetStdHandle</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">    ReadNotOk</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">pub</span><span style="color:#D73A49;--shiki-dark:#F97583"> fn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> getch_win</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#E36209;--shiki-dark:#FFAB70">GetchError</span><span style="color:#D73A49;--shiki-dark:#F97583">!i32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span></code></pre>
<p lang="zh">更好的是，Zig 强制你处理这些错误。拿上面这段代码为例，你只有三种选择：</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="zig"><code><span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">_</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> getch_win</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; </span><span style="color:#6A737D;--shiki-dark:#6A737D">// 只执行，我管你出错不出错，当然也没法使用结果了</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#E36209;--shiki-dark:#FFAB70"> v</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> try</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> getch_win</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; </span><span style="color:#6A737D;--shiki-dark:#6A737D">// 如果出错，就继续往上抛</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#E36209;--shiki-dark:#FFAB70"> v</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> getch_win</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">catch</span><span style="color:#D73A49;--shiki-dark:#F97583"> |</span><span style="color:#E36209;--shiki-dark:#FFAB70">err</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">	// handle error ...</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">	// 处理错误</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span></code></pre>
<p lang="zh">和 Rust 一样，哪里使用就在哪里处理错误，而不是 C++ 风格的 expection，会打穿整个调用栈，而 <code>try ... catch ...</code> 还可能抓到不属于自己想要的错误。</p>
<p lang="zh">另外，Zig 还原生自带 <code>anyerror</code> 功能。使用 Rust 的人应该都有印象，有时候其实根本不关心发生了什么错误，上头一个日志就完事了，但是还是得乖乖写 <code>Result&#x3C;T, E></code> 的类型，于是催生了 <code>anyhow</code> 库，用 <code>anyhow::Result&#x3C;T></code> 来表示随便什么错误我不关心。但是 Zig 就很好的解决了这个问题。同样的，如果你只是单纯的懒，也可以直接用 <code>anyerror</code> 的特性不定义 error 的 enum 就直接返回一个错误的名字。</p>
<h3 id="defer-关键字"><code>defer</code> 关键字</h3>
<blockquote>
<p>你以为只有 go 语言有 defer？NO，NO，NO，zig 也有。</p>
</blockquote>
<p lang="zh">C++ 和 Rust 选择用 RAII 来解决<strong>哪怕是经验老到的 C 程序员也可能忘记释放内存的问题</strong>。而 Zig 就不一样，它选择了和 Go 一样的做法： <code>defer</code> （和 <code>errdefer</code>）</p>
<aside>
<p lang="zh">这里让我再 cue 一下，经常有知乎程序员觉得 Rust 算什么我们 C 手动释放内存也可以，borrow checker 多烦啊和编译器做斗争太难了——妈呀，想问你一下你都写不出过得了 Rust 编译的程序你凭什么觉得自己写得出内存安全的 C，你能给 GNOME 做贡献吗，而 GNOME 开发者们这样的经验老到的 C 程序员都会因为忘记 <code>free</code> 而搞出内存泄漏，你呢？</p>
</aside>
<p lang="zh">Zig 的思路是：在哪里分配就在哪里释放。这也是 <code>Allocator</code> 到处传的原因，在哪里创建资源，就在那里 defer destory 资源。就像这样（来自官方的示例）</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="zig"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">pub</span><span style="color:#D73A49;--shiki-dark:#F97583"> fn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> main</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">!void</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    const</span><span style="color:#E36209;--shiki-dark:#FFAB70"> soundio</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#E36209;--shiki-dark:#FFAB70"> c</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">soundio_create</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    defer</span><span style="color:#E36209;--shiki-dark:#FFAB70"> c</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">soundio_destroy</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">soundio</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    try</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> sio_err</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">c</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">soundio_connect</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">soundio</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">    c</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">soundio_flush_events</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">soundio</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    const</span><span style="color:#E36209;--shiki-dark:#FFAB70"> default_output_index</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#E36209;--shiki-dark:#FFAB70"> c</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">soundio_default_output_device_index</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">soundio</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">default_output_index</span><span style="color:#D73A49;--shiki-dark:#F97583"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">return</span><span style="color:#D73A49;--shiki-dark:#F97583"> error</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#E36209;--shiki-dark:#FFAB70">NoOutputDeviceFound</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    const</span><span style="color:#E36209;--shiki-dark:#FFAB70"> device</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#E36209;--shiki-dark:#FFAB70"> c</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">soundio_get_output_device</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">soundio</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">default_output_index</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">orelse</span><span style="color:#D73A49;--shiki-dark:#F97583"> return</span><span style="color:#D73A49;--shiki-dark:#F97583"> error</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#E36209;--shiki-dark:#FFAB70">OutOfMemory</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    defer</span><span style="color:#E36209;--shiki-dark:#FFAB70"> c</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">soundio_device_unref</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">device</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">    std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#E36209;--shiki-dark:#FFAB70">debug</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">print</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Output device: {s}</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, .</span><span style="color:#5a32a3;--shiki-dark:#b392f0">{</span><span style="color:#E36209;--shiki-dark:#FFAB70">device</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#E36209;--shiki-dark:#FFAB70">name</span><span style="color:#5a32a3;--shiki-dark:#b392f0">}</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    const</span><span style="color:#E36209;--shiki-dark:#FFAB70"> outstream</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#E36209;--shiki-dark:#FFAB70"> c</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">soundio_outstream_create</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">device</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">orelse</span><span style="color:#D73A49;--shiki-dark:#F97583"> return</span><span style="color:#D73A49;--shiki-dark:#F97583"> error</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#E36209;--shiki-dark:#FFAB70">OutOfMemory</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    defer</span><span style="color:#E36209;--shiki-dark:#FFAB70"> c</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">soundio_outstream_destroy</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">outstream</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">    outstream</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#E36209;--shiki-dark:#FFAB70">format</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#E36209;--shiki-dark:#FFAB70"> c</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#E36209;--shiki-dark:#FFAB70">SoundIoFormatFloat32NE</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">    outstream</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#E36209;--shiki-dark:#FFAB70">write_callback</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#E36209;--shiki-dark:#FFAB70"> write_callback</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    try</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> sio_err</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">c</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">soundio_outstream_open</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">outstream</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    try</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> sio_err</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">c</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">soundio_outstream_start</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">outstream</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    while</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#D73A49;--shiki-dark:#F97583">true</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#E36209;--shiki-dark:#FFAB70">c</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">soundio_wait_events</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">soundio</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span></code></pre>
<p lang="zh">注意到，defer 总是和资源的创建成对出现！zig 通过 defer 的设计让资源的释放变得一目了然，更不容易忘记释放。对比之下，C 经常需要使用大量的 goto 和宏，或者手动压栈来完成这样的操作，由于语法糖过于的少，导致语言丑陋不堪。</p>
<p lang="zh">当然，这也是不使用隐式控制流的思想的体现。这大概也是为什么 zig 没有选择 RAII</p>
<h3 id="编译期执行任意代码超酷的">编译期执行任意代码，超酷的</h3>
<p lang="zh">如果说 Zig 给我留下的最大的最大的印象一定是编译期执行任意代码了。甚至 zig 的泛型（伪）都是用 compiletime 搞的</p>
<p lang="zh">举个例子，让我们看看 zig 的标准库链表如何构造：</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="zig"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">pub</span><span style="color:#D73A49;--shiki-dark:#F97583"> fn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> DoublyLinkedList</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#D73A49;--shiki-dark:#F97583">comptime</span><span style="color:#E36209;--shiki-dark:#FFAB70"> T</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#D73A49;--shiki-dark:#F97583">type</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">type</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:rgba(255, 18, 18, 0.8);--shiki-dark:rgba(255, 18, 18, 0.8)">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#D73A49;--shiki-dark:#F97583"> struct</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:rgba(255, 18, 18, 0.8);--shiki-dark:rgba(255, 18, 18, 0.8)">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        const</span><span style="color:#E36209;--shiki-dark:#FFAB70"> Self</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> @This</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">        /// Node inside the linked list wrapping the actual data.</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        pub</span><span style="color:#D73A49;--shiki-dark:#F97583"> const</span><span style="color:#E36209;--shiki-dark:#FFAB70"> Node</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> struct</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#5a32a3;--shiki-dark:#b392f0">{</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">            prev</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#D73A49;--shiki-dark:#F97583">?*</span><span style="color:#E36209;--shiki-dark:#FFAB70">Node</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> null</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">            next</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#D73A49;--shiki-dark:#F97583">?*</span><span style="color:#E36209;--shiki-dark:#FFAB70">Node</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> null</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">            data</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#E36209;--shiki-dark:#FFAB70">T</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        </span><span style="color:#5a32a3;--shiki-dark:#b392f0">}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">        first</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#D73A49;--shiki-dark:#F97583">?*</span><span style="color:#E36209;--shiki-dark:#FFAB70">Node</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> null</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">        last</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#D73A49;--shiki-dark:#F97583">?*</span><span style="color:#E36209;--shiki-dark:#FFAB70">Node</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> null</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">        len</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#D73A49;--shiki-dark:#F97583">usize</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        ... </span><span style="color:#6A737D;--shiki-dark:#6A737D">// 后面是定义方法了</span></span></code></pre>
<p lang="zh">是的，这个链表直接以一个类型为参数，传入了一个函数里面，然后捏皮球一样捏出了对应类型的链表——神奇吧。</p>
<p lang="zh">这样的泛型当然已经算是大家都有的东西了。但是 zig 的编译期执行可不止这点。举个例子，为了实现跨平台的贪吃蛇，为了捕获键盘按下事件，不同的系统需要引入不同的库，做不同的预处理。如果是 C 的话，那就得定义一个编译期符号，然后用 <code>#ifdef</code> 来选择性编译代码，显得非常突出，非常丑陋。而 Zig，我是这样做的：</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="zig"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">pub</span><span style="color:#D73A49;--shiki-dark:#F97583"> fn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> main</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">anyerror!void</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    switch</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">builtin</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#E36209;--shiki-dark:#FFAB70">os</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#E36209;--shiki-dark:#FFAB70">tag</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#e36209;--shiki-dark:#ffab70">{</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        .</span><span style="color:#E36209;--shiki-dark:#FFAB70">windows</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#5a32a3;--shiki-dark:#b392f0">{</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">            // set utf-8</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">            _</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#E36209;--shiki-dark:#FFAB70"> std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#E36209;--shiki-dark:#FFAB70">os</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#E36209;--shiki-dark:#FFAB70">windows</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#E36209;--shiki-dark:#FFAB70">kernel32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">SetConsoleOutputCP</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">65001</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        </span><span style="color:#5a32a3;--shiki-dark:#b392f0">}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        .</span><span style="color:#E36209;--shiki-dark:#FFAB70">linux</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#5a32a3;--shiki-dark:#b392f0">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            const</span><span style="color:#E36209;--shiki-dark:#FFAB70"> c</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> @cImport</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">@cInclude</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"ncurses.h"</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            const</span><span style="color:#E36209;--shiki-dark:#FFAB70"> screen</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#E36209;--shiki-dark:#FFAB70"> c</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">initscr</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            defer</span><span style="color:#E36209;--shiki-dark:#FFAB70"> _</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#E36209;--shiki-dark:#FFAB70"> c</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">endwin</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">            _</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#E36209;--shiki-dark:#FFAB70"> c</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">raw</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">            _</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#E36209;--shiki-dark:#FFAB70"> c</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">keypad</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">screen</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">true</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">            _</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#E36209;--shiki-dark:#FFAB70"> c</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">noecho</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        </span><span style="color:#5a32a3;--shiki-dark:#b392f0">}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        else</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#5a32a3;--shiki-dark:#b392f0">{</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">            std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#E36209;--shiki-dark:#FFAB70">log</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">err</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Unsupported platform"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, .</span><span style="color:#e36209;--shiki-dark:#ffab70">{</span><span style="color:#e36209;--shiki-dark:#ffab70">}</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            return</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        </span><span style="color:#5a32a3;--shiki-dark:#b392f0">}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    </span><span style="color:#e36209;--shiki-dark:#ffab70">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">	// ... 程序代码</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span></code></pre>
<p lang="zh"><code>std.os.windows.kernel32.SetConsoleOutputCP</code> 这个函数在 Linux 上根本不存在？ <code>ncurses.h</code> 在 Windows 上没有？完全没关系！因为 builtin.os.tag 是编译期被 <code>build.zig</code> 填充的 compiletime struct，所以对应的 switch 语句自然也是 compiletime 的，编译器直接走到系统对应的分支，编译，链接，一点都不需要在乎其它分支。zig 将编译期处理的代码和运行时的代码统一了起来，完全使用相同的格式，这使得会了 zig 也就同时会了 compiletime zig，而不像 C++ 一样编译期模板和普通的 C++代码完全是两个天地。</p>
<p lang="zh">这使得 Zig 开发跨平台应用极其自然，非常简单，编译命令也保持完全一致，相比于虽然号称“一次编写处处运行”，实而脱离了平台的库以后寸步难行的 C 代码反而更容易写出跨平台的应用。</p>
<p lang="zh">当然这也有个意外的好处，zig 可以作为一个编译工具而使用，这在 zig 自己编译 zig 项目的时候尤其好用，<code>build.zig</code> 和你的 zig 代码是一个语法，一点也不用担心额外学一门标记法（目移 看向 CMake）</p>
<h3 id="当然还有需要打磨的地方">当然，还有需要打磨的地方</h3>
<p lang="zh">如果说 zig 有什么急需打磨的地方，或许是它到现在都还没有第一个正式版吧。zig 的标准库接口在过去几年里变了不少，以至于<del>GPT 没法生成复制粘贴就能跑的代码</del>。同时令人担忧的是，zig 语言的作者非常固执己见，比如他希望替换 LLVM 后端，就花了很长时间去弄它，哪怕社区很多人劝说也没用。zig 到现在拖了很久都是 0.13 版本，或许也只有勇于尝试的项目敢用它了。</p>
<p lang="zh">zig 还有一个让我很不满的地方是它不支持语法糖来创建闭包。当然你能用匿名结构体来创建闭包，但是主要是作者一人的意见——他不喜欢函数式的语法——而否决了闭包的提案。</p>
<h3 id="尾声">尾声</h3>
<p lang="zh">如果说 C 语言是一坨汇编的封装，那 Zig 才是我理想中的，应该在 C 语言位置上的语言。简洁、底层、现代，既能一目了然地看出对应的汇编，又不至于和 C 一样过于简陋缺少语法糖而必须写出非常丑陋的代码。</p>
<p lang="zh">它或许不太适合应用开发，毕竟太偏向底层，但它一定能带来比 C 更好的体验。如果下次遇到需要用 C 的项目，不妨试试 zig 吧。</p>
<hr>
<p lang="sk">本文以 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans">CC BY-NC-SA 4.0</a> 发布。</p>
<section data-footnotes="" class="footnotes"><h2 class="sr-only" id="footnote-label">脚注</h2>
<ol lang="zh">
<li id="user-content-fn-%E8%BF%99%E9%87%8C%E6%8C%87%E4%BB%A3%E4%B8%8D%E5%A5%BD%E5%A5%BD%E5%AD%A6%20c++%20%E6%8B%BF%20c%20%E8%AF%AD%E8%A8%80%E7%9A%84%E7%BB%8F%E9%AA%8C%E5%86%99%E4%BB%A3%E7%A0%81%E7%9A%84%E5%82%BB%E7%93%9C">
<p lang="zh">这里指代不好好学 C++ 拿 C 语言的经验写代码的傻瓜 <a href="#user-content-fnref-%E8%BF%99%E9%87%8C%E6%8C%87%E4%BB%A3%E4%B8%8D%E5%A5%BD%E5%A5%BD%E5%AD%A6%20c++%20%E6%8B%BF%20c%20%E8%AF%AD%E8%A8%80%E7%9A%84%E7%BB%8F%E9%AA%8C%E5%86%99%E4%BB%A3%E7%A0%81%E7%9A%84%E5%82%BB%E7%93%9C" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-%E4%B8%8D%E8%A6%81%E9%97%AE%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E6%8A%9B%E5%BC%83%20raii%20%E8%BF%99%E6%A0%B7%E7%9A%84%E5%A5%BD%E4%B8%9C%E8%A5%BF%E3%80%82%E8%BF%99%E5%B0%B1%E6%98%AF%E6%B4%BB%E8%B7%83%E4%BA%8E%E7%BC%96%E7%A8%8B%E8%AF%9D%E9%A2%98%E4%B8%8B%20c%20with%20classes%20%E4%BA%BA%EF%BC%8C%E4%BB%96%E4%BB%AC%E5%9D%9A%E4%BF%A1%20c%20with%20classes%20%E5%B0%B1%E8%83%BD%E6%BB%A1%E8%B6%B3%2099%25%20%E7%9A%84%E9%9C%80%E6%B1%82">
<p lang="zh">不要问我为什么要抛弃 RAII 这样的好东西。这就是活跃于编程话题下 C with classes 人，他们坚信 C with classes 就能满足 99% 的需求 <a href="#user-content-fnref-%E4%B8%8D%E8%A6%81%E9%97%AE%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E6%8A%9B%E5%BC%83%20raii%20%E8%BF%99%E6%A0%B7%E7%9A%84%E5%A5%BD%E4%B8%9C%E8%A5%BF%E3%80%82%E8%BF%99%E5%B0%B1%E6%98%AF%E6%B4%BB%E8%B7%83%E4%BA%8E%E7%BC%96%E7%A8%8B%E8%AF%9D%E9%A2%98%E4%B8%8B%20c%20with%20classes%20%E4%BA%BA%EF%BC%8C%E4%BB%96%E4%BB%AC%E5%9D%9A%E4%BF%A1%20c%20with%20classes%20%E5%B0%B1%E8%83%BD%E6%BB%A1%E8%B6%B3%2099%25%20%E7%9A%84%E9%9C%80%E6%B1%82" data-footnote-backref="" aria-label="Back to reference 2" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section> </div>
    <div class="divider"></div>
    <p class="post-meta flex flex-wrap items-center gap-2 text-base-content/60 undefined" data-astro-cid-qtyrxm4s> <span class="date flex gap-1 items-center flex-shrink-0 text-sm" data-astro-cid-qtyrxm4s> <svg width="1em" height="1em" data-icon="mingcute:calendar-2-line">   <symbol id="ai:mingcute:calendar-2-line" viewBox="0 0 24 24"><g fill="none" fill-rule="evenodd"><path d="m12.594 23.258l-.012.002l-.071.035l-.02.004l-.014-.004l-.071-.036q-.016-.004-.024.006l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.016-.018m.264-.113l-.014.002l-.184.093l-.01.01l-.003.011l.018.43l.005.012l.008.008l.201.092q.019.005.029-.008l.004-.014l-.034-.614q-.005-.019-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.003-.011l.018-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M16 3a1 1 0 0 1 1 1v1h2a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h2V4a1 1 0 0 1 2 0v1h6V4a1 1 0 0 1 1-1M8 7H5v2h14V7h-3zm-3 4v8h14v-8zm2 2a1 1 0 0 1 1-1h.01a1 1 0 1 1 0 2H8a1 1 0 0 1-1-1m1 2a1 1 0 1 0 0 2h.01a1 1 0 1 0 0-2zm3-2a1 1 0 0 1 1-1h.01a1 1 0 1 1 0 2H12a1 1 0 0 1-1-1m1 2a1 1 0 1 0 0 2h.01a1 1 0 1 0 0-2zm3-2a1 1 0 0 1 1-1h.01a1 1 0 1 1 0 2H16a1 1 0 0 1-1-1m1 2a1 1 0 1 0 0 2h.01a1 1 0 1 0 0-2z"/></g></symbol><use href="#ai:mingcute:calendar-2-line"></use>  </svg> <time datetime="2025-02-06T17:19:36.000Z"> 2025-02-06 </time> </span> <span class="categories items" data-astro-cid-qtyrxm4s>  </span> <span class="tags items" data-astro-cid-qtyrxm4s> <a class="item" href="/tags/Zig/" data-astro-cid-qtyrxm4s> <svg width="1em" height="1em" class="flex-shrink-0" data-astro-cid-qtyrxm4s="true" data-icon="mingcute:tag-line">   <symbol id="ai:mingcute:tag-line" viewBox="0 0 24 24"><g fill="none" fill-rule="evenodd"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M10.537 2.164a3 3 0 0 1 2.244.727l.15.14l7.822 7.823a3 3 0 0 1 .135 4.098l-.135.144l-5.657 5.657a3 3 0 0 1-4.098.135l-.144-.135L3.03 12.93a3 3 0 0 1-.878-2.188l.011-.205l.472-5.185a3 3 0 0 1 2.537-2.695l.179-.021zm.308 1.989l-.127.003l-5.185.472a1 1 0 0 0-.888.787l-.017.118l-.472 5.185a1 1 0 0 0 .206.703l.083.095l7.823 7.823a1 1 0 0 0 1.32.083l.094-.083l5.657-5.657a1 1 0 0 0 .083-1.32l-.083-.094l-7.823-7.823a1 1 0 0 0-.671-.292M7.317 7.318a3 3 0 1 1 4.243 4.243a3 3 0 0 1-4.243-4.243m2.829 1.414a1 1 0 1 0-1.415 1.414a1 1 0 0 0 1.415-1.414"/></g></symbol><use href="#ai:mingcute:tag-line"></use>  </svg> <span class="truncate" data-astro-cid-qtyrxm4s>Zig</span> </a><a class="item" href="/tags/Code/" data-astro-cid-qtyrxm4s> <svg width="1em" height="1em" viewBox="0 0 24 24" class="flex-shrink-0" data-astro-cid-qtyrxm4s="true" data-icon="mingcute:tag-line">   <use href="#ai:mingcute:tag-line"></use>  </svg> <span class="truncate" data-astro-cid-qtyrxm4s>Code</span> </a><a class="item" href="/tags/Programing Language/" data-astro-cid-qtyrxm4s> <svg width="1em" height="1em" viewBox="0 0 24 24" class="flex-shrink-0" data-astro-cid-qtyrxm4s="true" data-icon="mingcute:tag-line">   <use href="#ai:mingcute:tag-line"></use>  </svg> <span class="truncate" data-astro-cid-qtyrxm4s>Programing Language</span> </a> </span> </p> 
    <div class="mt-8"><div class="comments-container"> <div id="gitalk-mainEl" data-uid="blog:zig-first-experience"></div> </div> <script type="module" src="/_astro/GitalkComment.astro_astro_type_script_index_0_lang.yHboq2cn.js"></script> </div> </div> </article>  </main> <footer> <div class="text-center mb-4 markdown-body"> <p>
&copy; 2025 Linca. All rights reserved.
</p> <p>
开业 <span id="BLOG_DAYS" data-first-date="1538918349000">2543</span> 天里，写下了 54 篇博客，2 篇页面，8 篇杂记，352905 字符。
</p> <p>
Powered by
<a href="https://astro.build" target="_blank" rel="noopener noreferrer">
Astro
</a>
and
<a href="https://github.com/Lhcfl/astro-theme-krypton2" target="_blank" rel="noopener noreferrer">
Krypton 2
</a>.
</p> </div> </footer> <script type="module">document.addEventListener("astro:page-load",()=>{const t=document.getElementById("BLOG_DAYS");if(t){const e=Date.now()-Number(t.dataset.firstDate),n=Math.floor(e/(1e3*60*60*24));t.textContent=n.toString()}});</script> </div> </div> <div class="sidebar__outer-container
              hidden print:hidden!
              flex-grow-0 flex-shrink max-w-70 has-sidebar:flex-shrink-0
              md:block md:relative md:has-sidebar:w-50
              lg:flex-shrink-0 lg:has-sidebar:w-70
              xl:w-70
              max-md:show-toc:z-10 max-md:show-toc:block max-md:show-toc:fixed max-md:show-toc:bottom-2 max-md:show-toc:w-full max-md:show-toc:max-w-full
              max-md:[body.show-toc_&]:animate-fade-in-up max-md:[body.show-toc_&]:animate-duration-300 max-md:[body.show-toc_&]:animate-ease-in-out
              max-md:[body.removing-toc_&]:animate-fade-out-down max-md:[body.removing-toc_&]:animate-duration-300 max-md:[body.removing-toc_&]:animate-ease-in-out"> <div class="sidebar__inner-container
          sticky top-0 bg-surface pt-6
          md:px-0 md:h-screen
          max-md:show-toc:px-2 max-md:show-toc:pt-4 max-md:show-toc:border-t max-md:show-toc:border-base-300 overflow-y-auto overflow-x-visible">  <div class="hidden has-sidebar:block min-[55rem]:block"> <div id="page-toc"> <ul class="timeline w-full"> <li class="toc-item group flex items-center gap-2 transition" un-text="base-content/60 [&.active]:secondary [&.active-now]:secondary+30" un-p="x-2 y-1" un-hover="bg-secondary/10 text-secondary" data-slug="zig-核心"> <a href="#zig-核心" class="flex items-center gap-1 w-full"> <div class="flex-shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-2">Zig 核心</span> </a> </li><li class="toc-item group flex items-center gap-2 transition" un-text="base-content/60 [&.active]:secondary [&.active-now]:secondary+30" un-p="x-2 y-1" un-hover="bg-secondary/10 text-secondary" data-slug="没有隐式控制流"> <a href="#没有隐式控制流" class="flex items-center gap-1 w-full"> <div class="flex-shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-2">没有隐式控制流</span> </a> </li><li class="toc-item group flex items-center gap-2 transition" un-text="base-content/60 [&.active]:secondary [&.active-now]:secondary+30" un-p="x-2 y-1" un-hover="bg-secondary/10 text-secondary" data-slug="没有隐式内存分配"> <a href="#没有隐式内存分配" class="flex items-center gap-1 w-full"> <div class="flex-shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-2">没有隐式内存分配</span> </a> </li><li class="toc-item group flex items-center gap-2 transition" un-text="base-content/60 [&.active]:secondary [&.active-now]:secondary+30" un-p="x-2 y-1" un-hover="bg-secondary/10 text-secondary" data-slug="超强的-c-交互性"> <a href="#超强的-c-交互性" class="flex items-center gap-1 w-full"> <div class="flex-shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-2">超强的 C 交互性</span> </a> </li><li class="toc-item group flex items-center gap-2 transition" un-text="base-content/60 [&.active]:secondary [&.active-now]:secondary+30" un-p="x-2 y-1" un-hover="bg-secondary/10 text-secondary" data-slug="更好的错误处理"> <a href="#更好的错误处理" class="flex items-center gap-1 w-full"> <div class="flex-shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-2">更好的错误处理</span> </a> </li><li class="toc-item group flex items-center gap-2 transition" un-text="base-content/60 [&.active]:secondary [&.active-now]:secondary+30" un-p="x-2 y-1" un-hover="bg-secondary/10 text-secondary" data-slug="defer-关键字"> <a href="#defer-关键字" class="flex items-center gap-1 w-full"> <div class="flex-shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-2">defer 关键字</span> </a> </li><li class="toc-item group flex items-center gap-2 transition" un-text="base-content/60 [&.active]:secondary [&.active-now]:secondary+30" un-p="x-2 y-1" un-hover="bg-secondary/10 text-secondary" data-slug="编译期执行任意代码超酷的"> <a href="#编译期执行任意代码超酷的" class="flex items-center gap-1 w-full"> <div class="flex-shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-2">编译期执行任意代码，超酷的</span> </a> </li><li class="toc-item group flex items-center gap-2 transition" un-text="base-content/60 [&.active]:secondary [&.active-now]:secondary+30" un-p="x-2 y-1" un-hover="bg-secondary/10 text-secondary" data-slug="当然还有需要打磨的地方"> <a href="#当然还有需要打磨的地方" class="flex items-center gap-1 w-full"> <div class="flex-shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-2">当然，还有需要打磨的地方</span> </a> </li><li class="toc-item group flex items-center gap-2 transition" un-text="base-content/60 [&.active]:secondary [&.active-now]:secondary+30" un-p="x-2 y-1" un-hover="bg-secondary/10 text-secondary" data-slug="尾声"> <a href="#尾声" class="flex items-center gap-1 w-full"> <div class="flex-shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-2">尾声</span> </a> </li><li class="toc-item group flex items-center gap-2 transition" un-text="base-content/60 [&.active]:secondary [&.active-now]:secondary+30" un-p="x-2 y-1" un-hover="bg-secondary/10 text-secondary" data-slug="footnote-label"> <a href="#footnote-label" class="flex items-center gap-1 w-full"> <div class="flex-shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-0">脚注</span> </a> </li> </ul> </div> <script type="module">function c(i,l){let t=null,e=!1;function o(...s){e?t=s:(i.apply(this,s),e=!0,setTimeout(()=>{e=!1,t&&(o.apply(this,t),t=null)},l))}return o}function n(i){const l=document.getElementById("page-toc");if(!l)return;const t=l.querySelectorAll("li");if(t.forEach(e=>e.classList.remove("active","active-now")),i!=null)for(const e of t){if(e.dataset.slug===i){e.classList.add("active-now");break}e.classList.add("active")}}const r=c(()=>{const i=document.querySelector(".markdown-body.is-detailed");if(!i)return;const l=Array.from(i.querySelectorAll("h1,h2,h3,h4,h5,h6").values()),t=l.findIndex(e=>e.getBoundingClientRect().y>110);t===0?n(null):t==-1?n(l.at(-1)?.id):n(l.at(t-1)?.id)},200);document.addEventListener("scroll",r);</script> </div> </div> </div>  </div> <div class="float-buttons fixed bottom-4 right-4 flex flex-col gap-2 print:hidden! text-base-content" aria-hidden="true"> <div class="opacity-0 translate-x-20 transition [body.is-scrolled_&]:opacity-100 [body.is-scrolled_&]:translate-x-0"> <button onclick="window.scrollTo({ top: 0, behavior: 'smooth' })" class="rounded-full p-4 text-lg md:text-xl bg-surface border-base-300 border" aria-label="Scroll to top"> <div class="i-mingcute:arrow-up-line"></div> </button> </div> <div class="hidden has-sidebar:block md:hidden!"> <button onclick="document.body.classList.add('show-toc')" class="rounded-full p-4 text-lg md:text-xl bg-surface border-base-300 border" aria-label="Show TOC"> <div class="i-mingcute:list-check-fill"></div> </button> </div> </div> <script type="module">document.addEventListener("scroll",()=>{window.scrollY>100?document.body.classList.add("is-scrolled"):document.body.classList.remove("is-scrolled")});document.addEventListener("click",s=>{if(!document.body.classList.contains("show-toc"))return;let t=s.target;for(;t!=null;){if(t.classList.contains("float-buttons")||t.classList.contains("sidebar__inner-container"))return;t=t.parentElement}document.body.classList.remove("show-toc"),document.body.classList.add("removing-toc"),setTimeout(()=>{document.body.classList.remove("removing-toc")},280),s.stopPropagation()});</script> </body></html>