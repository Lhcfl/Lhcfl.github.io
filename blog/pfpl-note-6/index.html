<!DOCTYPE html><html lang="zh-CN"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/webp" href="/_astro/logo.zcK9pHo2_2eS7vq.webp"><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/rss+xml" title="Zero Calorie Drink Shop" href="https://lhcfl.github.io/rss.xml"><meta name="generator" content="Astro v5.10.0"><!-- Font --><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://chinese-fonts-cdn.deno.dev"><link rel="preconnect" href="https://ik.imagekit.io" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://lhcfl.github.io/blog/pfpl-note-6/"><!-- Primary Meta Tags --><title>PFPL 笔记 - VI Dynamic Types ⬝ Zero Calorie Drink Shop</title><meta name="title" content="PFPL 笔记 - VI Dynamic Types ⬝ Zero Calorie Drink Shop"><meta name="description" content="笔记 6
最详细的一集，因为我要讲解这部分（摊手
但是读得很开心！这章真是让我受益匪浅啊！
"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://lhcfl.github.io/blog/pfpl-note-6/"><meta property="og:title" content="PFPL 笔记 - VI Dynamic Types ⬝ Zero Calorie Drink Shop"><meta property="og:description" content="笔记 6
最详细的一集，因为我要讲解这部分（摊手
但是读得很开心！这章真是让我受益匪浅啊！
"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://lhcfl.github.io/blog/pfpl-note-6/"><meta property="twitter:title" content="PFPL 笔记 - VI Dynamic Types ⬝ Zero Calorie Drink Shop"><meta property="twitter:description" content="笔记 6
最详细的一集，因为我要讲解这部分（摊手
但是读得很开心！这章真是让我受益匪浅啊！
"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.AM2StPgK.js"></script><link rel="stylesheet" href="/_astro/_static_page_.DYt1UbNe.css">
<link rel="stylesheet" href="/_astro/_static_page_.DST4ihUU.css">
<link rel="stylesheet" href="/_astro/_static_page_.CGWgwbcx.css">
<style>@reference "../styles/tailwind.css";.items[data-astro-cid-qtyrxm4s]{display:flex;flex-wrap:wrap;gap:calc(var(--spacing) * 2);max-width:100%;text-overflow:ellipsis;overflow:hidden}.item[data-astro-cid-qtyrxm4s]{font-size:var(--text-sm-fontSize);line-height:var(--un-leading, var(--text-sm-lineHeight));display:flex;gap:calc(var(--spacing) * 1);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;align-items:center;position:relative}.item[data-astro-cid-qtyrxm4s]:after{background-color:color-mix(in srgb,var(--colors-primary) 50%,transparent);width:100%;height:.15em;--un-scale-x:0%;--un-scale-y:0%;scale:var(--un-scale-x) var(--un-scale-y);transition-property:all;transition-timing-function:var(--un-ease, var(--default-transition-timingFunction));transition-duration:var(--un-duration, var(--default-transition-duration));left:calc(var(--spacing) * 0);bottom:calc(var(--spacing) * 0);position:absolute;content:""}@supports (color: color-mix(in lab,red,red)){.item[data-astro-cid-qtyrxm4s]:after{background-color:color-mix(in oklab,var(--colors-primary) 50%,transparent)}}@property --un-bg-opacity{syntax:"<percentage>";inherits:false;initial-value:100%;}.item[data-astro-cid-qtyrxm4s]:hover:after{--un-scale-x:100%;--un-scale-y:100%;scale:var(--un-scale-x) var(--un-scale-y)}@property --un-scale-x{syntax:"*";inherits:false;initial-value:1;syntax:"*";inherits:false;initial-value:1;}@property --un-scale-y{syntax:"*";inherits:false;initial-value:1;syntax:"*";inherits:false;initial-value:1;}@property --un-scale-z{syntax:"*";inherits:false;initial-value:1;syntax:"*";inherits:false;initial-value:1;}
</style><script type="module" src="/_astro/page.sN3tJsal.js"></script></head> <body class="overflow-y-scroll has-sidebar"> <div class="app bg-surface text-content md:flex lg:justify-center max-w-full">  <header class="print:hidden flex sticky top-0 flex-[0_0_auto]" un-max-md="items-center justify-between w-full h-15 z-50 bg-surface px-2" un-max-lg="w-20" un-lg="w-70" un-md="flex-col h-screen text-lg p-4 flex-shrink-0 flex-grow-0" un-border="max-md:b md:r  base-300"> <a href="/" class="flex flex-col items-center gap-2 lg:mt-4"> <div class="nav-site-avatar avatar w-10 md:w-12 lg:hidden"> <img src="/_astro/logo.zcK9pHo2_2eS7vq.webp" alt="Zero Calorie Drink Shop" loading="eager" decoding="async" fetchpriority="auto" width="100" height="100"> </div> <div class="nav-site-avatar avatar max-lg:hidden w-40"> <img src="/_astro/logo.zcK9pHo2_16JEEU.webp" alt="Zero Calorie Drink Shop" loading="eager" decoding="async" fetchpriority="auto" width="512" height="512"> </div> <span class="nav-site-title text-lg font-bold max-lg:hidden">Zero Calorie Drink Shop</span> </a> <nav class="links flex items-center gap-2 text-lg" un-md="flex-col pt-6 text-2xl" un-lg="text-base"> <a href="/" role="button" class="header-link flex items-center justify-center gap-1 transition md:h-10 md:w-full md:hover:bg-primary/10 md:hover:text-primary" aria-label="Home" data-path-name="blog/pfpl-note-6/" data-href-base="/"> <svg width="1em" height="1em" data-icon="mingcute:home-3-line">   <symbol id="ai:mingcute:home-3-line" viewBox="0 0 24 24"><g fill="none"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M10.772 2.688a2 2 0 0 1 2.317-.099l.139.1l8.384 6.52c.721.561.37 1.692-.499 1.785l-.116.006H20v8a2 2 0 0 1-1.85 1.995L18 21H6a2 2 0 0 1-1.994-1.85L4 19v-8h-.997C2.09 11 1.671 9.892 2.3 9.285l.088-.076zM12 4.267L5.625 9.225c.229.185.375.468.375.785V19h3v-5a3 3 0 1 1 6 0v5h3v-8.99c0-.317.146-.6.375-.785zM12 13a1 1 0 0 0-1 1v5h2v-5a1 1 0 0 0-1-1"/></g></symbol><use href="#ai:mingcute:home-3-line"></use>  </svg> <span class="max-lg:hidden"> Home </span> </a><a href="/archives" role="button" class="header-link flex items-center justify-center gap-1 transition md:h-10 md:w-full md:hover:bg-primary/10 md:hover:text-primary" aria-label="Archives" data-path-name="blog/pfpl-note-6/" data-href-base="archives"> <svg width="1em" height="1em" data-icon="mingcute:archive-line">   <symbol id="ai:mingcute:archive-line" viewBox="0 0 24 24"><g fill="none" fill-rule="evenodd"><path d="m12.594 23.258l-.012.002l-.071.035l-.02.004l-.014-.004l-.071-.036q-.016-.004-.024.006l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.016-.018m.264-.113l-.014.002l-.184.093l-.01.01l-.003.011l.018.43l.005.012l.008.008l.201.092q.019.005.029-.008l.004-.014l-.034-.614q-.005-.019-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.003-.011l.018-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M16.586 3A2 2 0 0 1 18 3.586L20.414 6A2 2 0 0 1 21 7.414V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7.414A2 2 0 0 1 3.586 6L6 3.586A2 2 0 0 1 7.414 3zM19 9H5v10h14zm-7 1a1 1 0 0 1 1 1v3.186l.414-.414a1 1 0 1 1 1.414 1.414l-2.12 2.121a1 1 0 0 1-1.415 0l-2.121-2.121a1 1 0 1 1 1.414-1.414l.414.414V11a1 1 0 0 1 1-1m4.586-5H7.414l-2 2h13.172z"/></g></symbol><use href="#ai:mingcute:archive-line"></use>  </svg> <span class="max-lg:hidden"> Archives </span> </a><a href="/notes/1" role="button" class="header-link flex items-center justify-center gap-1 transition md:h-10 md:w-full md:hover:bg-primary/10 md:hover:text-primary" aria-label="Notes" data-path-name="blog/pfpl-note-6/" data-href-base="notes"> <svg width="1em" height="1em" data-icon="mingcute:notebook-line">   <symbol id="ai:mingcute:notebook-line" viewBox="0 0 24 24"><g fill="none"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M17 2c1.598 0 3 1.3 3 3v13c0 1.7-1.4 3-3 3H6c-1.054 0-2-.95-2-2V4c0-1.054.95-2 2-2zm0 2h-7v15h7c.513 0 1-.39 1-1V5c0-.513-.49-1-1-1M8 4H6v15h2z"/></g></symbol><use href="#ai:mingcute:notebook-line"></use>  </svg> <span class="max-lg:hidden"> Notes </span> </a><a href="/tags" role="button" class="header-link flex items-center justify-center gap-1 transition md:h-10 md:w-full md:hover:bg-primary/10 md:hover:text-primary" aria-label="Tags" data-path-name="blog/pfpl-note-6/" data-href-base="tags"> <svg width="1em" height="1em" data-icon="mingcute:tag-2-line">   <symbol id="ai:mingcute:tag-2-line" viewBox="0 0 24 24"><g fill="none"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M10.238 4.827a3 3 0 0 1 2.122.878l6.485 6.486a3 3 0 0 1 0 4.242l-4.243 4.243a3 3 0 0 1-4.242 0l-6.486-6.485a3 3 0 0 1-.878-2.122V7.327a2.5 2.5 0 0 1 2.5-2.5zm0 2H5.496a.5.5 0 0 0-.5.5v4.742a1 1 0 0 0 .292.707l6.486 6.486a1 1 0 0 0 1.414 0l4.243-4.243a1 1 0 0 0 0-1.414L10.945 7.12a1 1 0 0 0-.707-.293M7.531 9.362a1.5 1.5 0 1 1 2.121 2.122a1.5 1.5 0 0 1-2.121-2.122M11.652 2a3 3 0 0 1 2.122.878l7.192 7.193a1 1 0 0 1-1.414 1.414L12.36 4.29a1 1 0 0 0-.708-.29H7a1 1 0 0 1 0-2z"/></g></symbol><use href="#ai:mingcute:tag-2-line"></use>  </svg> <span class="max-lg:hidden"> Tags </span> </a><a href="/about" role="button" class="header-link flex items-center justify-center gap-1 transition md:h-10 md:w-full md:hover:bg-primary/10 md:hover:text-primary" aria-label="About" data-path-name="blog/pfpl-note-6/" data-href-base="about"> <svg width="1em" height="1em" data-icon="mingcute:user-3-line">   <symbol id="ai:mingcute:user-3-line" viewBox="0 0 24 24"><g fill="none" fill-rule="evenodd"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M12 13c2.396 0 4.575.694 6.178 1.672c.8.488 1.484 1.064 1.978 1.69c.486.615.844 1.351.844 2.138c0 .845-.411 1.511-1.003 1.986c-.56.45-1.299.748-2.084.956c-1.578.417-3.684.558-5.913.558s-4.335-.14-5.913-.558c-.785-.208-1.524-.506-2.084-.956C3.41 20.01 3 19.345 3 18.5c0-.787.358-1.523.844-2.139c.494-.625 1.177-1.2 1.978-1.69C7.425 13.695 9.605 13 12 13m0 2c-2.023 0-3.843.59-5.136 1.379c-.647.394-1.135.822-1.45 1.222c-.324.41-.414.72-.414.899c0 .122.037.251.255.426c.249.2.682.407 1.344.582C7.917 19.858 9.811 20 12 20c2.19 0 4.083-.143 5.4-.492c.663-.175 1.096-.382 1.345-.582c.218-.175.255-.304.255-.426c0-.18-.09-.489-.413-.899c-.316-.4-.804-.828-1.451-1.222C15.843 15.589 14.023 15 12 15m0-13a5 5 0 1 1 0 10a5 5 0 0 1 0-10m0 2a3 3 0 1 0 0 6a3 3 0 0 0 0-6"/></g></symbol><use href="#ai:mingcute:user-3-line"></use>  </svg> <span class="max-lg:hidden"> About </span> </a><a href="/links" role="button" class="header-link flex items-center justify-center gap-1 transition md:h-10 md:w-full md:hover:bg-primary/10 md:hover:text-primary" aria-label="Links" data-path-name="blog/pfpl-note-6/" data-href-base="links"> <svg width="1em" height="1em" data-icon="mingcute:link-3-line">   <symbol id="ai:mingcute:link-3-line" viewBox="0 0 24 24"><g fill="none" fill-rule="evenodd"><path d="m12.594 23.258l-.012.002l-.071.035l-.02.004l-.014-.004l-.071-.036q-.016-.004-.024.006l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.016-.018m.264-.113l-.014.002l-.184.093l-.01.01l-.003.011l.018.43l.005.012l.008.008l.201.092q.019.005.029-.008l.004-.014l-.034-.614q-.005-.019-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.003-.011l.018-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M1 10a5 5 0 0 1 5-5h6a5 5 0 0 1 0 10a1 1 0 1 1 0-2a3 3 0 1 0 0-6H6a3 3 0 0 0-.75 5.906a1 1 0 0 1-.5 1.936A5 5 0 0 1 1 10m11 1a3 3 0 1 0 0 6h6a3 3 0 0 0 .75-5.905a1 1 0 0 1 .5-1.937A5.002 5.002 0 0 1 18 19h-6a5 5 0 0 1 0-10a1 1 0 1 1 0 2"/></g></symbol><use href="#ai:mingcute:link-3-line"></use>  </svg> <span class="max-lg:hidden"> Links </span> </a><a href="/search" role="button" class="header-link flex items-center justify-center gap-1 transition md:h-10 md:w-full md:hover:bg-primary/10 md:hover:text-primary" aria-label="Search" data-path-name="blog/pfpl-note-6/" data-href-base="search"> <svg width="1em" height="1em" data-icon="mingcute:search-3-line">   <symbol id="ai:mingcute:search-3-line" viewBox="0 0 24 24"><g fill="none" fill-rule="evenodd"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M10.5 4a6.5 6.5 0 1 0 0 13a6.5 6.5 0 0 0 0-13M2 10.5a8.5 8.5 0 1 1 15.176 5.262l3.652 3.652a1 1 0 0 1-1.414 1.414l-3.652-3.652A8.5 8.5 0 0 1 2 10.5M9.5 7a1 1 0 0 1 1-1a4.5 4.5 0 0 1 4.5 4.5a1 1 0 1 1-2 0A2.5 2.5 0 0 0 10.5 8a1 1 0 0 1-1-1"/></g></symbol><use href="#ai:mingcute:search-3-line"></use>  </svg> <span class="max-lg:hidden"> Search </span> </a> </nav> <div class="navbar-end" un-md="flex-grow flex items-baseline-last justify-center"> <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();</script><script>(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t),11:t=>1/0*t},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="18tXJb" component-url="/_astro/DarkLightToggle.6qHju4aH.js" component-export="default" renderer-url="/_astro/client.svelte.DMhakGtm.js" props="{}" ssr client="load" opts="{&quot;name&quot;:&quot;DarkLightToggle&quot;,&quot;value&quot;:true}" await-children><!--[--><button class="i-mingcute:moon-stars-line" aria-label="toggle theme"></button><!--]--><!--astro:end--></astro-island> </div> </header> <div class="main-and-footer__outer-container
        max-w-full min-h-screen overflow-x-hidden
        flex flex-grow flex-shrink flex-basis-200 xl:flex-grow-0 at-md:justify-center"> <div class="flex flex-col w-full max-w-200"> <main class="flex-grow relative p-4 md:pt-6 undefined">  <article> <h1 class="page-title text-3xl font-bold">  <span>PFPL 笔记 - VI Dynamic Types</span>  </h1> <div> <div class="markdown-body is-detailed"> <p lang="zh">笔记 6
最详细的一集，因为我要讲解这部分（摊手
但是读得很开心！这章真是让我受益匪浅啊！</p>
<!-- more -->
<h2 id="chapter-17-the-untyped-lambda-calculus">Chapter 17 The Untyped Lambda Calculus</h2>
<p lang="zh">许多实际使用的编程语言宣称自己是无类型的（untyped），然而这只是一种假象。这些语言实际上是单一类型的(uni-typed)而非无类型。</p>
<p lang="sv">Lambda 演算，丘奇于 1930 年提出。它唯一的“特性”就是高阶函数（higher-order function），即：</p>
<ul lang="zh">
<li>
<p>一切都是函数，</p>
</li>
<li>
<p lang="zh">每个表达式都可以被应用于一个参数，而该参数本身也必须是一个函数，</p>
</li>
<li>
<p lang="zh">最终的结果仍然是一个函数。</p>
</li>
</ul>
<p><img  loading="lazy" decoding="async" fetchpriority="auto" width="912" height="202" src="/_astro/lambda_calculus.BUGcxDkz_2aPf11.webp" ></p>
<p lang="ca">See also: <a href="https://learnxinyminutes.com/zh-cn/lambda-calculus/">Learn Lambda Calculus in Y Minutes</a></p>
<h3 id="statics">Statics</h3>
<p lang="en">The statics of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">L</mi><mo stretchy="false">{</mo><mi>λ</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\mathcal L\{\lambda\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathcal">L</span><span class="mopen">{</span><span class="mord mathnormal">λ</span><span class="mclose">}</span></span></span></span> is defined by general hypothetical judgments of the form</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>x1 ok, x2 ok, ..., xn ok |- u ok</span></span></code></pre>
<p>stating that u is a well-formed expression involving the variables x1 ~ xn</p>
<p><img  loading="lazy" decoding="async" fetchpriority="auto" width="993" height="278" src="/_astro/statics_of_lambda_cal.i4dxFtEf_Z1iNrTA.webp" ></p>
<ul lang="zh">
<li>若 <code>x</code> 在环境 Γ 中已声明为合法，则 <code>x</code> 本身是合法的。</li>
<li>若 <code>u₁</code> 和 <code>u₂</code> 都是合法表达式，则它们的应用 <code>ap(u₁; u₂)</code> 也是合法的。</li>
<li>若在环境 Γ 下 <code>x ok</code> 则 <code>u ok</code> 则 <code>λ(x . u)</code> 也是合法的。</li>
</ul>
<h3 id="dynamics">Dynamics</h3>
<p lang="en">λ-演算的 dynamics 不是通过传统的 transition system 来定义，而是通过 equaitonally（至少 PFPL 里这样定义）</p>
<p lang="en">Definitional equality for <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span></span></span></span> is a judgment of the form <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Γ</mi><mo>⊢</mo><mi>u</mi><mo separator="true">,</mo><msup><mi>u</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">\Gamma \vdash u, u'</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">Γ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⊢</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9463em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">u</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>, where <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Γ</mi><mo>⊢</mo></mrow><annotation encoding="application/x-tex">\Gamma \vdash</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">Γ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⊢</span></span></span></span> <code>x1 ok,...,xn ok</code> for some n 0, and u and u’ are terms having at most the variables x1 … xn free. It is inductively defined by the following rules</p>
<ul>
<li>
<p>自反性</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mrow></mrow><mrow><mi mathvariant="normal">Γ</mi><mo separator="true">,</mo><mi>u</mi><mtext> ok</mtext><mo>⊢</mo><mi>u</mi><mo>≡</mo><mi>u</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\dfrac{}{\Gamma, u \text{ ok} \vdash u \equiv u}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.5574em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.677em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">Γ</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">u</span><span class="mord text"><span class="mord"> ok</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⊢</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">u</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>
</li>
<li>
<p>对称性</p>
</li>
</ul>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">Γ</mi><mo separator="true">,</mo><mi>u</mi><mtext> ok</mtext><mo>⊢</mo><mi>u</mi><mo>≡</mo><msup><mi>u</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><mrow><mi mathvariant="normal">Γ</mi><mo separator="true">,</mo><mi>u</mi><mtext> ok</mtext><mo>⊢</mo><msup><mi>u</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>≡</mo><mi>u</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\dfrac{\Gamma, u \text{ ok} \vdash u \equiv u'}{\Gamma, u \text{ ok} \vdash u' \equiv u}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.3093em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4289em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">Γ</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">u</span><span class="mord text"><span class="mord"> ok</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⊢</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6779em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">u</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">Γ</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">u</span><span class="mord text"><span class="mord"> ok</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⊢</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>
<ul>
<li>传递性</li>
</ul>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">Γ</mi><mo separator="true">,</mo><mi>u</mi><mtext> ok</mtext><mo>⊢</mo><mi>u</mi><mo>≡</mo><msup><mi>u</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mspace width="1em"></mspace><mi mathvariant="normal">Γ</mi><mo separator="true">,</mo><mi>u</mi><mtext> ok</mtext><mo>⊢</mo><msup><mi>u</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>≡</mo><msup><mi>u</mi><mrow><mo mathvariant="normal">′</mo><mo mathvariant="normal">′</mo></mrow></msup></mrow><mrow><mi mathvariant="normal">Γ</mi><mo separator="true">,</mo><mi>u</mi><mtext> ok</mtext><mo>⊢</mo><mi>u</mi><mo>≡</mo><msup><mi>u</mi><mrow><mo mathvariant="normal">′</mo><mo mathvariant="normal">′</mo></mrow></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">\dfrac
{\Gamma, u \text{ ok} \vdash u \equiv u' \quad \Gamma, u \text{ ok} \vdash u' \equiv u''}
{\Gamma, u \text{ ok} \vdash u \equiv u''}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.3093em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4289em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">Γ</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">u</span><span class="mord text"><span class="mord"> ok</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⊢</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6779em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′′</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">Γ</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">u</span><span class="mord text"><span class="mord"> ok</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⊢</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:1em;"></span><span class="mord">Γ</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">u</span><span class="mord text"><span class="mord"> ok</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⊢</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′′</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>
<ul>
<li>……</li>
</ul>
<p><img  loading="lazy" decoding="async" fetchpriority="auto" width="1016" height="278" src="/_astro/dynamics_of_lambda_cal.C8pwQkqQ_2esPxN.webp" ></p>
<p lang="en">We often write just <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mo>≡</mo><msup><mi>u</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">u \equiv u'</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4637em;"></span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span> when the variables involved need not be emphasized or are clear from context.</p>
<h3 id="definablity">Definablity</h3>
<p lang="zh">无类型 λ-演算的一个重要特性是它的<strong>表达能力</strong>。它是一个<strong>图灵完备（Turing-complete）</strong> 的语言，也就是说，它和任何已知的编程语言一样，都可以表达自然数上的所有可计算函数。</p>
<p>Chuch’s Law: 任何可计算的函数都有其 Lambda Calculus 等价表达</p>
<p lang="zh">作为例子，我们证明 lambda 演算至少和 PCF 一样强：</p>
<p lang="zh">我们可以用 lambda 的形式定义自然数，which 叫 丘奇数</p>
<h4 id="church-numerals">Church Numerals</h4>
<p>为了懒得打 latex 下面用 <code>\a -> b</code> 表示 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">\lambda(a)b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">λ</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mord mathnormal">b</span></span></span></span></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="haskell"><code><span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    0</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> \</span><span style="color:#24292E;--shiki-dark:#E1E4E8">b </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#D73A49;--shiki-dark:#F97583"> \</span><span style="color:#24292E;--shiki-dark:#E1E4E8">s </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> b</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">n </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> \</span><span style="color:#24292E;--shiki-dark:#E1E4E8">b </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#D73A49;--shiki-dark:#F97583"> \</span><span style="color:#24292E;--shiki-dark:#E1E4E8">s </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> s</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">n</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">b</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">s</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span></code></pre>
<p>表示原文的</p>
<p><img  loading="lazy" decoding="async" fetchpriority="auto" width="988" height="291" src="/_astro/church_numerals.kVBtpARA_ZHWW0D.webp" ></p>
<p lang="zh">注意到，b 可以解释为 blank，或者说初始值， 而 s 可以解释为 successor</p>
<p lang="zh">也就是说这里定义了 0 是用 blank 和 successor 两个组合子构造出的一个 lambda，</p>
<p>这样，运用 successor 到 n(b)(s) i.e. 用 b，s 实例化了的 n 就能得到 n + 1</p>
<p lang="zh">另外一个有趣的事情是，当我们得到 n 这个 丘奇数（它自己也是一个函数）的时候，显然 <code>n f g</code> 是 <code>g(g(g(... n个g...(f))))</code>，也就是说这个数字就能用来作为 n-fold</p>
<p>比如展开后</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="haskell"><code><span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> \</span><span style="color:#24292E;--shiki-dark:#E1E4E8">b </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#D73A49;--shiki-dark:#F97583"> \</span><span style="color:#24292E;--shiki-dark:#E1E4E8">s </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> s</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">b</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> \</span><span style="color:#24292E;--shiki-dark:#E1E4E8">b </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#D73A49;--shiki-dark:#F97583"> \</span><span style="color:#24292E;--shiki-dark:#E1E4E8">s </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> s</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">s</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">b</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> \</span><span style="color:#24292E;--shiki-dark:#E1E4E8">b </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#D73A49;--shiki-dark:#F97583"> \</span><span style="color:#24292E;--shiki-dark:#E1E4E8">s </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> s</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">s</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">s</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">b</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">...</span></span></code></pre>
<p lang="zh">那么自然数运算也就很好理解了</p>
<p><img  loading="lazy" decoding="async" fetchpriority="auto" width="1027" height="322" src="/_astro/church_num_op.Dr9SlAOV_ZCQxMd.webp" ></p>
<p>举例</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="haskell"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">succ </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> \</span><span style="color:#24292E;--shiki-dark:#E1E4E8">x </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#D73A49;--shiki-dark:#F97583"> \</span><span style="color:#24292E;--shiki-dark:#E1E4E8">b </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#D73A49;--shiki-dark:#F97583"> \</span><span style="color:#24292E;--shiki-dark:#E1E4E8">s </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> s</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">x</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">b</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">s</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span></code></pre>
<p>故</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="haskell"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">succ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#D73A49;--shiki-dark:#F97583">  =</span><span style="color:#D73A49;--shiki-dark:#F97583"> \</span><span style="color:#24292E;--shiki-dark:#E1E4E8">b </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#D73A49;--shiki-dark:#F97583"> \</span><span style="color:#24292E;--shiki-dark:#E1E4E8">s </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> s</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">b</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">s</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        =</span><span style="color:#D73A49;--shiki-dark:#F97583"> \</span><span style="color:#24292E;--shiki-dark:#E1E4E8">b </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#D73A49;--shiki-dark:#F97583"> \</span><span style="color:#24292E;--shiki-dark:#E1E4E8">s </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> s</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">b</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span></span></code></pre>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="haskell"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">plus </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> \</span><span style="color:#24292E;--shiki-dark:#E1E4E8">x </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#D73A49;--shiki-dark:#F97583"> \</span><span style="color:#24292E;--shiki-dark:#E1E4E8">y </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> y</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">x</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">succ</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span></code></pre>
<p lang="zh">可以理解为
plus x y 就是将 x 作为初始值，调用 y (x) succ 当然就是 “x + y”</p>
<p lang="zh">例如，展开 plus 1 2</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="haskell"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">succ</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#D73A49;--shiki-dark:#F97583">\</span><span style="color:#24292E;--shiki-dark:#E1E4E8">b </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#D73A49;--shiki-dark:#F97583"> \</span><span style="color:#24292E;--shiki-dark:#E1E4E8">s </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> s</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">b</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">succ</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> succ</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">s</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 3</span></span></code></pre>
<p>对于乘法</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="haskell"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">times </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> \</span><span style="color:#24292E;--shiki-dark:#E1E4E8">x </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#D73A49;--shiki-dark:#F97583"> \</span><span style="color:#24292E;--shiki-dark:#E1E4E8">y </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> y</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">plus</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">x</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span></code></pre>
<p lang="zh">则是将原先的 successor 换成了 plus(x) 后的新 y，显然这就是 y * x</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="haskell"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">times </span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">plus </span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#D73A49;--shiki-dark:#F97583">\</span><span style="color:#24292E;--shiki-dark:#E1E4E8">s </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> s</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">s</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">plus </span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> plus </span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">plus </span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 4</span></span></code></pre>
<details>
<summary>一些简单验算</summary>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="haskell"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">ghci</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> b </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">ghci</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> s x </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x</span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">ghci</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> zero </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> \</span><span style="color:#24292E;--shiki-dark:#E1E4E8">b </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#D73A49;--shiki-dark:#F97583"> \</span><span style="color:#24292E;--shiki-dark:#E1E4E8">s </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> b</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">ghci</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> succ </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> \</span><span style="color:#24292E;--shiki-dark:#E1E4E8">x </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#D73A49;--shiki-dark:#F97583"> \</span><span style="color:#24292E;--shiki-dark:#E1E4E8">b </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#D73A49;--shiki-dark:#F97583"> \</span><span style="color:#24292E;--shiki-dark:#E1E4E8">s </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> s</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">x</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">b</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">s</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">ghci</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ghci</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> succ zero b s</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">ghci</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> plus </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> \</span><span style="color:#24292E;--shiki-dark:#E1E4E8">x </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#D73A49;--shiki-dark:#F97583"> \</span><span style="color:#24292E;--shiki-dark:#E1E4E8">y </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> y</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">x</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">succ</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">ghci</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> one </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> succ zero</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">ghci</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> one b s</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">ghci</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> plus one one b s</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">ghci</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> two </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> succ one</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">ghci</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> plus one two b s</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span></span></code></pre>
</details>
<p lang="zh">要定义 <code>ifz(u; u0; x.u1)</code> 需要一些技巧，因为我们需要找到一个前驱函数 <code>pred</code></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="haskell"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">pred </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">pred </span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">n </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n</span></span></code></pre>
<p lang="zh">这并不是听起来那么容易 因为相当于我们需要能把一大坨的高阶函数里的 <code>s(n)</code> 的 <code>n</code> 拿出来，而且还需要考虑 0 的存在</p>
<p lang="zh">可以借鉴移位的思想，如果有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo><mo>→</mo><mo stretchy="false">(</mo><mi>n</mi><mo separator="true">,</mo><mi>n</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(n-1, n) \to (n, n+1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span> 的推导就能很容易拿到 n - 1</p>
<h4 id="church-pairs">Church Pairs</h4>
<p lang="zh">先定义丘奇风格的 pair</p>
<p lang="zh">(括号好多懒得打……不如把 <code>f(a)(b)</code> 写成 <code>f a b</code> 好了)</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="haskell"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">pair u1 u2 </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> \</span><span style="color:#24292E;--shiki-dark:#E1E4E8">f </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> f u1 u2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">left  u </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> u</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#D73A49;--shiki-dark:#F97583">\</span><span style="color:#24292E;--shiki-dark:#E1E4E8">x </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#D73A49;--shiki-dark:#F97583"> \</span><span style="color:#24292E;--shiki-dark:#E1E4E8">y </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">right u </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> u</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#D73A49;--shiki-dark:#F97583">\</span><span style="color:#24292E;--shiki-dark:#E1E4E8">x </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#D73A49;--shiki-dark:#F97583"> \</span><span style="color:#24292E;--shiki-dark:#E1E4E8">y </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> y</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span></code></pre>
<p><img  loading="lazy" decoding="async" fetchpriority="auto" width="940" height="229" src="/_astro/church_style_pair.CgwAkWC9_ZXJB47.webp" ></p>
<p lang="zh">然后，注意到我们之前定义的 Church Numeric 的 b 和 s 都是可以替换成任意的实例的！因此，只需要把 <code>&#x3C;0, 0></code> 作为 b 传入，就能获得一个带有 predecessor 的 Church numberic.</p>
<p><img  loading="lazy" decoding="async" fetchpriority="auto" width="960" height="402" src="/_astro/church_predecessor.BFwKffn7_Z17uA6I.webp" ></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="haskell"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">pred' </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> \</span><span style="color:#24292E;--shiki-dark:#E1E4E8">x </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x </span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#e36209;--shiki-dark:#ffab70">[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#e36209;--shiki-dark:#ffab70">]</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#D73A49;--shiki-dark:#F97583">\</span><span style="color:#24292E;--shiki-dark:#E1E4E8">y </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#e36209;--shiki-dark:#ffab70">[</span><span style="color:#24292E;--shiki-dark:#E1E4E8">right y, succ</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">right y</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">]</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">pred  </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> \</span><span style="color:#24292E;--shiki-dark:#E1E4E8">x </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> right </span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">pred' x</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span></code></pre>
<p lang="zh">这样我们就获取了需要的 pred 函数。这样，ifz 也很好定义了</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>ifz u, u0, x, u1 = u(u0)(\never -> [(pred u)/x] u1)</span></span></code></pre>
<p lang="es">现在我们还差 general recursion。一如既往地，lambda calculus 的函数是没有名字的，我们需要得到一个 fix 让 general recursion 存在</p>
<h4 id="y-组合子">Y 组合子</h4>
<p>最出名的 fix point combinator 是 Y 组合子</p>
<p><img  loading="lazy" decoding="async" fetchpriority="auto" width="916" height="309" src="/_astro/Ycombinator.CJfR0jk6_1nJYmm.webp" ></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="haskell"><code><span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">Y</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> \</span><span style="color:#005CC5;--shiki-dark:#79B8FF">F</span><span style="color:#D73A49;--shiki-dark:#F97583"> -</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#D73A49;--shiki-dark:#F97583">\</span><span style="color:#24292E;--shiki-dark:#E1E4E8">f </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> F</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">f</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">f</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#D73A49;--shiki-dark:#F97583">\</span><span style="color:#24292E;--shiki-dark:#E1E4E8">f </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> F</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">f</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">f</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span></code></pre>
<p>验算</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="haskell"><code><span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">Y</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">F</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#D73A49;--shiki-dark:#F97583">\</span><span style="color:#24292E;--shiki-dark:#E1E4E8">f </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> F</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">f</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">f</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#D73A49;--shiki-dark:#F97583">\</span><span style="color:#24292E;--shiki-dark:#E1E4E8">f </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> F</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">f</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">f</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> F</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">f</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">f</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">where</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> f </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> \</span><span style="color:#24292E;--shiki-dark:#E1E4E8">f </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> F</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">f f</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> F</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  </span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#D73A49;--shiki-dark:#F97583">\</span><span style="color:#24292E;--shiki-dark:#E1E4E8">f </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> F</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">f</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">f</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#D73A49;--shiki-dark:#F97583">\</span><span style="color:#24292E;--shiki-dark:#E1E4E8">f </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> F</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">f</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">f</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  </span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> F</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Y</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">F</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span></code></pre>
<p lang="zh">看到这里我非常的震撼，人们是如何构造出这样神奇的组合子的？原书接下来做了解释：</p>
<p lang="zh">让我们抛开内存和地址空间这些不谈。假如有一个函数</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> fib</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">x</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x </span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#D73A49;--shiki-dark:#F97583"> ?</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> fib</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">x </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> fib</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">x </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span></code></pre>
<p lang="zh">现在我们忘记函数可以有名字。为了还能实现递归，自然而然的，我们会尝试加一个参数，self 或者 this 之类的，这样这个函数就知道了自己是什么。</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> tmp</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">x</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x </span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#D73A49;--shiki-dark:#F97583"> ?</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> self</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">self, x </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> self</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">self, x </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> fib</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">x</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  reutnr </span><span style="color:#6F42C1;--shiki-dark:#B392F0">tmp</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">tmp, x</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span></code></pre>
<p lang="zh">注意到 <code>tmp(tmp, ...args)</code> 的存在！为了更好看出来，我们把它写成柯里化的 lambda 函数</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> tmp</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">self</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">x</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x </span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#D73A49;--shiki-dark:#F97583"> ?</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> self</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">self</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">x </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> self</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">self</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">x </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> fib_1</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">x</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> tmp</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">tmp</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">x</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// 然后 x 可以消掉</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> fib</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> tmp</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">tmp</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// fib</span></span></code></pre>
<p lang="zh">因此，对于任何一个我们需要递归的函数 <code>F = \self -> 函数体</code>, 构造</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="haskell"><code><span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">F'</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> \</span><span style="color:#24292E;--shiki-dark:#E1E4E8">f </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> F</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">f</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">f</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span></code></pre>
<p>能帮我们把每次 F 里的 self 换成 self(self)</p>
<p>此时观察到</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>F'(F') == F(F'(F'))</span></span></code></pre>
<p lang="zh"><code>F'(F')</code> 就是我们想要的 F 的不动点。现在把它展开，就得到了</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>(\f -> F(f(f)))(\f -> F(f(f)))</span></span></code></pre>
<p lang="zh">于是我们就得到了 Y 组合子，可以得到任意 F 的 fixed point</p>
<h3 id="scotts-theorem">Scott’s Theorem</h3>
<p>Scott 定理表明：</p>
<blockquote>
<p lang="zh">在无类型 λ-演算中，定义相等性是不可判定的，即不存在算法可以确定两个 λ-项是否相等。</p>
</blockquote>
<p><strong>inseparability</strong></p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="script">A</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">\mathcal A_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathcal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="script">A</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\mathcal A_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathcal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 是 insparability (不可区分的)，当且仅当没有一个决定性的属性 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">B</mi></mrow><annotation encoding="application/x-tex">\mathcal B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathcal" style="margin-right:0.03041em;">B</span></span></span></span> such that</p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="script">A</mi><mn>0</mn></msub><mtext> </mtext><mi>u</mi></mrow><annotation encoding="application/x-tex">\mathcal A_0 \ u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathcal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace"> </span><span class="mord mathnormal">u</span></span></span></span> implies <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">B</mi><mtext> </mtext><mi>u</mi></mrow><annotation encoding="application/x-tex">\mathcal B \ u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathcal" style="margin-right:0.03041em;">B</span><span class="mspace"> </span><span class="mord mathnormal">u</span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="script">A</mi><mn>1</mn></msub><mtext> </mtext><mi>u</mi></mrow><annotation encoding="application/x-tex">\mathcal A_1 \ u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathcal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace"> </span><span class="mord mathnormal">u</span></span></span></span> implies not the case that <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">B</mi><mtext> </mtext><mi>u</mi></mrow><annotation encoding="application/x-tex">\mathcal B \ u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathcal" style="margin-right:0.03041em;">B</span><span class="mspace"> </span><span class="mord mathnormal">u</span></span></span></span></li>
</ul>
<p lang="id"><strong>behavioral</strong></p>
<p lang="so"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">A</mi></mrow><annotation encoding="application/x-tex">\mathcal A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathcal">A</span></span></span></span> 是 behavioral (行为属性)，当且仅当 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mo>≡</mo><msup><mi>u</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">u \equiv u'</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4637em;"></span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span> 则 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">A</mi></mrow><annotation encoding="application/x-tex">\mathcal A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathcal">A</span></span></span></span> iff <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi mathvariant="script">u</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">\mathcal u'</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></p>
<p lang="zh">Scott 定理有两部分：</p>
<ul lang="zh">
<li><img  loading="lazy" decoding="async" fetchpriority="auto" width="881" height="173" src="/_astro/scott_theorem_1.BpvJFVJH_Z1yRYzH.webp" ></li>
<li>任何两个非平凡的属性 A 和 B 是不可区分的</li>
</ul>
<p lang="zh">（如果某个属性对所有 untyped terms 都成立，或者对任何 untyped terms 都不成立，则该属性被称为平凡的。）</p>
<p><img  loading="lazy" decoding="async" fetchpriority="auto" width="930" height="766" src="/_astro/lemma17-1.Lw-UvhrS_Z1pp5jH.webp" >
<img  loading="lazy" decoding="async" fetchpriority="auto" width="936" height="451" src="/_astro/lemma-17-2.Cdxf3mqa_Z1SmHuN.webp" ></p>
<p lang="zh">也就是说这里引入了一个构造 v 是 w(x) 的反面，同时根据 lemma 17.1 它又得能接受一个自身到自身，所以矛盾了</p>
<h4 id="这里放点我自己的思考不知道对不对">这里放点我自己的思考不知道对不对</h4>
<p lang="zh">我们应该也能用图灵机的停机问题的思想去证明 Scott 定理。（虽然维基百科说 Scott’s Theorem 比停机问题还早 XD）</p>
<blockquote>
<p lang="zh">在 1936 年邱奇利用 λ 演算给出了对于判定性问题（Entscheidungsproblem）的否定：关于两个 lambda 表达式是否等价的命题，无法由一个“通用的算法”判断，这是不可判定性能够证明的头一个问题，甚至还在停机问题之先。 ——<a href="https://zh.wikipedia.org/wiki/%CE%9B%E6%BC%94%E7%AE%97">维基百科</a></p>
</blockquote>
<p lang="zh">首先，Lambda 演算的停机问题也是不可判定的，可以直接照搬图灵机的证明</p>
<p lang="zh">定义 λ-演算的停机：给定一个 λ-项 M 如果经过有限步 β-归约后到达一个正常形式（normal-form），即不再能进行 β-约简，则称 M 停机。</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>如果存在 lambda 演算 Halt 可以判定一个 lambda 演算 F 在参数 args 的时候是否停机，比如</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Halt(F)(args) = 0 当F停机</span></span>
<span class="line"><span>Halt(F)(args) = 1 当F不停机</span></span>
<span class="line"><span></span></span>
<span class="line"><span>则我们可以构造一个 U</span></span>
<span class="line"><span>U = \P -> ifz(Halt(P)(P); Y(Y); 0)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>则考虑 Halt(U)(U)，</span></span>
<span class="line"><span>若 Halt(U)(U) = 0，则 U(U) 应当跑一个无限递归，矛盾</span></span>
<span class="line"><span>若 Halt(U)(U) = 1，则 U(U) 应当直接返回0，不停机，矛盾</span></span>
<span class="line"><span></span></span>
<span class="line"><span>所以不存在一个lambda演算 Halt 可以判定任意 lambda 演算 F 在参数 args 的时候是否停机。</span></span></code></pre>
<p lang="zh">利用停机问题不可判定性，</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>如果 lambda 演算 Equiv 能判定两个 lambda 演算是否相同 （相同返回0，不同返回1）</span></span>
<span class="line"><span>则构造</span></span>
<span class="line"><span></span></span>
<span class="line"><span>A = \f -> \args -> 0</span></span>
<span class="line"><span>B = \f -> \args -> ifz(f(args); 0; 0)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>（我们假定 f(args) 应该在停机的时候得到一个 church numeral）</span></span>
<span class="line"><span></span></span>
<span class="line"><span>那么A 和 B 相同当且仅当 f(args) 停机。Equiv 规约到停机问题，故不存在。</span></span></code></pre>
<h4 id="还有一些有趣的补充">还有一些有趣的补充</h4>
<blockquote>
<p lang="zh">无类型的 λ 演算系统被证明在用于逻辑系统的时候是不自洽的——在 1935 年斯蒂芬·科尔·克莱尼和 J. B. Rosser 举出了 Kleene-Rosser 悖论</p>
</blockquote>
<p>考虑 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo>=</mo><mi>λ</mi><mo stretchy="false">(</mo><mi>f</mi><mo stretchy="false">)</mo><mi mathvariant="normal">¬</mi><mi>f</mi><mo stretchy="false">(</mo><mi>f</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P = \lambda (f) \neg f(f)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">λ</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mclose">)</span><span class="mord">¬</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mclose">)</span></span></span></span> 则 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>P</mi><mo stretchy="false">)</mo><mo>=</mo><mi mathvariant="normal">¬</mi><mi>P</mi><mo stretchy="false">(</mo><mi>P</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(P) = \neg P(P)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">¬</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mclose">)</span></span></span></span> 所以我们可以找到一个等于其否定的项。</p>
<p lang="zh">这提醒我们，有必要清楚地区分哪些 lambda 项可以代表命题，哪些 lambda 不能，这导致了项的类型概念。</p>
<h3 id="untyped-meansuni-typed">Untyped MeansUni-Typed</h3>
<p lang="zh">无类型的 λ 演算可以被忠实地嵌入到具有递归类型的类型语言中。这意味着每个无类型 λ 项都可以表示为一个带类型的表达式，使得表示的执行对应于项自身的执行。</p>
<p lang="zh">这种嵌入并不是通过在 L 中编写一个解释器（这当然是可以实现的），而是通过直接将无类型 λ 项表示为具有递归类型的带类型表达式。</p>
<p lang="zh">关键观察是：无类型的 λ 演算实际上是单类型的 λ 演算。赋予其强大功能的并非类型缺失，而是它只有一个类型，即递归类型</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>D = μt.t → t</span></span></code></pre>
<p lang="zh">D 类型的值形式为 fold(e)，其中 e 是 D→D 类型的值——一个其定义域和值域均为 D 的函数。-任何这样的函数都可以“卷起”被视为 D 类型的值，而任何 D 类型的值都可以“展开”转换为函数。递归类型通常可以被视为类型同构方程的解，此处的方程是 D = D → D。这表明 D 是一个与其自身上的函数空间同构的类型，这在传统的集合论中是不可能的，但在基于计算的 λ 演算环境中是可行的。</p>
<p><img  loading="lazy" decoding="async" fetchpriority="auto" width="987" height="678" src="/_astro/lambda_into_lang.D3tls0ue_ZVm6qY.webp" ></p>
<p lang="zh">由此可见，所谓的无类型语言 L{ lambda } 尽管在术语上与类型语言相对立，实际上仍然是一种带类型的语言。无类型语言并非消除了类型，而是将无限集合的类型合并为一个递归类型。这使得静态类型检查变得 trivial，但代价是在值与递归类型之间进行强制转换时带来了显著的动态开销。</p>
<p lang="zh">在第 18 章中，我们将更进一步，允许许多不同类型的值（而不仅仅是函数），每种类型都是“主”递归类型的组成部分。这表明所谓的动态类型语言实际上是静态类型语言。因此，这一传统区别几乎不能被视为对立，因为动态语言不过是静态语言的一种特殊形式，强调了一个递归类型。</p>
<h2 id="chapter-18-dynamic-typing">Chapter 18 Dynamic Typing</h2>
<p lang="zh">17 章介绍了 untyped lambda calculus，其中所有 term 都同构于一个函数。因此，不会因为值的误用而发生运行时错误，因为所有参数都是函数。</p>
<p lang="zh">但一旦语言中允许不止一类值，这个特性就会失效。例如，如果我们将自然数作为 primitive 添加到无类型演算中（而不是通过 Church 编码定义它们），那么尝试将数字应用于参数或将函数添加到数字时可能会引发运行时错误。</p>
<p lang="zh">语言设计中的一种思想流派是将这种缺点转化为优点，即采用一种具有单一类型 (type), 多个值类 (value class) 的计算模型。这种语言被称为动态类型语言，与静态类型语言相对立。但这种所谓的对立是虚幻的：正如所谓的 untyped 演算实际上是 uni-typed 类型的一样，动态语言最终也只是静态语言的受限形式。这句话非常重要，值得重复：<strong>每种动态语言本质上都是静态语言，我们将自己限制在（不必要的）受限类型规则中以确保安全。</strong></p>
<h3 id="dynamically-typed-pcf">Dynamically Typed PCF</h3>
<p lang="en">Dynamically typed version of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">L</mi><mo stretchy="false">{</mo><mtext>nat</mtext><mo>⇀</mo><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\mathcal L \{\text{nat} \rightharpoonup \}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathcal">L</span><span class="mopen">{</span><span class="mord text"><span class="mord">nat</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⇀</span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mclose">}</span></span></span></span> called <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">L</mi><mo stretchy="false">{</mo><mi>d</mi><mi>y</mi><mi>n</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\mathcal L \{dyn\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathcal">L</span><span class="mopen">{</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal">n</span><span class="mclose">}</span></span></span></span></p>
<p><img  loading="lazy" decoding="async" fetchpriority="auto" width="933" height="342" src="/_astro/dynamically_typed_pcf.CA0lGBFw_2j8nQc.webp" ></p>
<p lang="fr">现在我们有两种 value： numbers 和 functions。succ 和 zero 不是值，在这里是一种算符，来产生 value.</p>
<p lang="en">递归虽然可以用 fixed point combinator 定义，但是我们这里把它定义成原型类型 (primitive) 来简化 chapter 18.3 中的分析。</p>
<p lang="zh">对于这些动态语言来说，具体语法往往具有欺骗性，因为它掩盖了抽象语法的一个重要细节：即每个值都标有一个在运行时发挥重要作用的分类器(classifier)（我们很快就会看到）。</p>
<p lang="zh">因此，尽管数字 n 的具体语法只是单纯地 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>n</mi><mo stretchy="true">‾</mo></mover></mrow><annotation encoding="application/x-tex">\overline n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6306em;"></span><span class="mord overline"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6306em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top:-3.5506em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span></span></span></span></span></span></span> ，但抽象语法表明该数字被标记为<strong>类别(class)</strong> num，以表明该值属于数字类别。这样做是为了将其与函数值区分开来，函数值具体具有形式 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mi>d</mi></mrow><annotation encoding="application/x-tex">\lambda (x) d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">λ</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mord mathnormal">d</span></span></span></span>，但其抽象语法 fun 表示要用标签 fun 对其进行分类，以将其与数字区分开来。</p>
<blockquote>
<p lang="zh">注：这里你可以认为 tag 是变量类别 class（而非类型，type）的 id</p>
</blockquote>
<p lang="zh">这种标记在任何动态语言中都是至关重要的，因此，在下文中密切关注抽象形式非常重要。</p>
<h4 id="statics-1">Statics</h4>
<p lang="zh">显然。而之前一样，只需要检验一下 expression 里面有没有自由变量就行。</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub><mtext> ok</mtext><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>x</mi><mi>n</mi></msub><mtext> ok</mtext><mo>⊢</mo><mi>d</mi><mtext> ok</mtext></mrow><annotation encoding="application/x-tex">x_1 \text{ ok}, ..., x_n \text{ ok} \vdash d \text{ ok}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord text"><span class="mord"> ok</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord text"><span class="mord"> ok</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⊢</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span><span class="mord text"><span class="mord"> ok</span></span></span></span></span></span>
<h4 id="dynamics-1">Dynamics</h4>
<p lang="zh">作为动态语言的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">L</mi><mo stretchy="false">{</mo><mi>d</mi><mi>y</mi><mi>n</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\mathcal L \{dyn\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathcal">L</span><span class="mopen">{</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal">n</span><span class="mclose">}</span></span></span></span> 需要检查之前 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">L</mi><mo stretchy="false">{</mo><mtext>nat</mtext><mo>⇀</mo><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\mathcal L \{\text{nat} \rightharpoonup \}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathcal">L</span><span class="mopen">{</span><span class="mord text"><span class="mord">nat</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⇀</span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mclose">}</span></span></span></span> 永远不可能发生的一些错误。比如，函数调用的时候需要判断一下那个被调用的是不是真的是一个函数。</p>
<p><img  loading="lazy" decoding="async" fetchpriority="auto" width="925" height="338" src="/_astro/dynamics_of_dynamic_pcf.CfOVX__E_xw5R.webp" ></p>
<p lang="en">注意后四条判断只有在 d val 的时候有意义。这些 affirmative class checking judgments 第二个参数代表的是 value 的底层结构，它本身不是 value。</p>
<p><img  loading="lazy" decoding="async" fetchpriority="auto" width="737" height="1353" src="/_astro/judgments_dynamic_pcf.DNX5i-yE_Z2cEg8m.webp" ></p>
<p><strong>Lemma 18.1</strong> (Class Checking) 如果 d val 则</p>
<ul>
<li>either d is_num for some n or d isnt_num;</li>
<li>either d is_fun x.d’ for some x and d’, or d isnt_fun</li>
</ul>
<p>证明显然。</p>
<p lang="en"><strong>Theorem 18.2</strong> (Progress): If d ok then either d val or d err, or there exists d’ such that <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo>↦</mo><msup><mi>d</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">d \mapsto d'</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7054em;vertical-align:-0.011em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">↦</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></p>
<p lang="nn"><strong>Theorem 18.3</strong> (Exclusivity): 对此语言中的任意 d ，下面恰有一个成立：d val, d err, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo>↦</mo><msup><mi>d</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">d \mapsto d'</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7054em;vertical-align:-0.011em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">↦</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span> for some d’</p>
<h3 id="variations-and-extensions">Variations and Extensions</h3>
<p lang="en">在之前的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">L</mi><mo stretchy="false">{</mo><mtext>nat</mtext><mo>⇀</mo><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\mathcal L \{\text{nat} \rightharpoonup \}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathcal">L</span><span class="mopen">{</span><span class="mord text"><span class="mord">nat</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⇀</span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mclose">}</span></span></span></span> 中我们使用 zero 和 succ 来定义 nat。在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">L</mi><mo stretchy="false">{</mo><mi>d</mi><mi>y</mi><mi>n</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\mathcal L \{dyn\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathcal">L</span><span class="mopen">{</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal">n</span><span class="mclose">}</span></span></span></span> 中，我们直接定义了 numberals。这样做是为了确保只有一个数字类，而不是 zero 和 succ 两个单独的 class。</p>
<p lang="zh">另一种方法是将 zero 和 succ(d) 视为两个单独 class 的值，并为它们分别引入 class checking 判断。这会使错误检查规则复杂化，并允许出现有问题的值，例如 <code>succ(lambda (x)d)</code>，但它允许我们避免使用 class of numbers。当以这种风格书写时，条件分支的 dynamics 如下所示：</p>
<p><img  loading="lazy" decoding="async" fetchpriority="auto" width="914" height="323" src="/_astro/variations_and_extensions_1.Dulgw5Mn_1E94FH.webp" ></p>
<p lang="zh">注意 successor class 的前驱不一定要是一个 number，虽然我们前面的公式不可能产生这种可能性。</p>
<p lang="zh">接下来结构化数据也是容易加入的。</p>
<p><img  loading="lazy" decoding="async" fetchpriority="auto" width="945" height="688" src="/_astro/variations_and_extensions_2.ub2m9zbY_GwUEM.webp" ></p>
<p lang="zh">注意上面这个函数，显然，你可以直接把任何值用在这两个函数上，无论它们是不是列表。如果 arg1 不是列表，会产生错误并终止，但是该函数不会遍历参数 arg2，所以 arg2 是任何值都可以。</p>
<p>有人会觉得，用 null 来分辨 pair 不是合适的，因为这语言包含不止这两种 classes。一种可能的手段是，完全放弃 pattern matching 想法，直接用 general 的 conditional branch 去分辨 null</p>
<p><img  loading="lazy" decoding="async" fetchpriority="auto" width="975" height="311" src="/_astro/variations_and_extensions_3.bXfm7Fm3_1rHIKo.webp" ></p>
<blockquote>
<p lang="zh">此处引入一个小插曲：为什么叫 cons 和 car 和 cdr 呢？<del>小编也很好奇</del></p>
<p lang="zh">这是来自 lisp 的习惯，在 1950s Lisp 最早被实现的时候，car 和 cdr 分别是两个寄存器：</p>
<ul lang="fr">
<li>car (“contents of the address part of register number”) “寄存器号地址部分的内容”</li>
<li>cdr (“contents of the decrement part of register number”), “寄存器号递减部分的内容”</li>
</ul>
<p lang="gl">而 cons 直接是 constructor 的缩写，指的是 list 的构造子</p>
</blockquote>
<p lang="zh">现在 append 可以用下面的公式给出：</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>fix a is \x -> \y -> cond(x; cons(car(x); a(cdr(x))(y)); y)</span></span></code></pre>
<details>
<summary>看不太清的话就是</summary>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="haskell"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">append x y </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> cond x </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  anyhow </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> cons </span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">car x</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">append </span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">cdr x</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> y</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  nil </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> y</span></span></code></pre>
</details>
<p lang="zh">这种 append 公式的行为与之前的公式没有什么不同；唯一的区别是，我们不再根据值是否为 nil 或 pair 来进行分派，而是根据值的谓词来进行区分，其中包括特殊情况的检查。</p>
<p lang="zh">还有另一种方式，即增强而非限制条件分支，让它包含语言中所有可能的值类别，比如在具有 <code>num</code>, <code>fun</code>, <code>null</code>, <code>pair</code> 的的语言中，条件将会有四个分支。这种方法的困难是，现实语言中会有许多数据类型，这样会非常笨重。</p>
<p lang="zh">此外，即使我们已经对值的类别进行了指派，与该类别的原始操作也需要进行运行时检查，例如，我们可以确定值 d 属于数字类，但没有办法将此信息传播到条件分支中。加法运算仍然必须检查 d 的类别，获取底层数字，并创建一个新的数字类值。这是动态语言的固有限制，它不允许处理除分类值之外的其他值</p>
<h3 id="critique-of-dynamic-typing---对动态类型的批判">Critique of Dynamic Typing - 对动态类型的批判</h3>
<p lang="zh">像 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">L</mi><mo stretchy="false">{</mo><mi>d</mi><mi>y</mi><mi>n</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\mathcal L \{dyn\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathcal">L</span><span class="mopen">{</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal">n</span><span class="mclose">}</span></span></span></span> 这样的语言的 safety theorem 经常被宣传为动态类型相比于静态类型的优势。与排除了某些类型错误的静态语言不同， <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">L</mi><mo stretchy="false">{</mo><mi>d</mi><mi>y</mi><mi>n</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\mathcal L \{dyn\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathcal">L</span><span class="mopen">{</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal">n</span><span class="mclose">}</span></span></span></span> 中的每一段抽象语法基本上都是格式良好的，因此，根据定理 18.2，具有定义良好的动态性。</p>
<p lang="zh">但这也可以看作是一个缺点，因为在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">L</mi><mo stretchy="false">{</mo><mi>d</mi><mi>y</mi><mi>n</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\mathcal L \{dyn\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathcal">L</span><span class="mopen">{</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal">n</span><span class="mclose">}</span></span></span></span> 中，本该通过类型检查在编译时排除的错误直到运行时才会显现。并且为了实现这一点， <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">L</mi><mo stretchy="false">{</mo><mi>d</mi><mi>y</mi><mi>n</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\mathcal L \{dyn\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathcal">L</span><span class="mopen">{</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal">n</span><span class="mclose">}</span></span></span></span> 的 dynamic 必须强制执行静态类型语言中不需要检查的条件。</p>
<p>考虑加法</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>\x -> fix p is \y -> ifz y { zero => x | succ(y') => succ(p(y'))}</span></span></code></pre>
<p lang="zh">注意到，fix pointer 把 p 绑定到了该函数，这意味着在递归调用中，ap(p) 的动态检查总是会成功，但是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">L</mi><mo stretchy="false">{</mo><mi>d</mi><mi>y</mi><mi>n</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\mathcal L \{dyn\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathcal">L</span><span class="mopen">{</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal">n</span><span class="mclose">}</span></span></span></span> 没有办法取消这种冗余检查，因为它没有能力表达 that “p 始终的将绑定到一个不变的 function”。</p>
<p lang="zh">其次，内部的 lambda-abstraction 的 apply 要么是 x，要么是 x 的递归的 successor。也就是说除了基本情况外后面的情况都可以保证通过 class check，但我们没有能力表达这一点，successor 只能每次都老老实实地进行 class check</p>
<p lang="zh">Classification 不是免费的——tag 需要存储空间，每次使用时都需要花时间将类与值分离，每次创建类时又需要花时间将类附加到值上。虽然分类的开销不是渐近显著的（它只会使程序变慢一个常数），但它仍然是不可忽略的，应该尽可能消除。但这在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">L</mi><mo stretchy="false">{</mo><mi>d</mi><mi>y</mi><mi>n</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\mathcal L \{dyn\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathcal">L</span><span class="mopen">{</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal">n</span><span class="mclose">}</span></span></span></span> 中是不可能的，因为它无法表达所需不变量所需的限制。</p>
<p lang="zh">为此，我们需要一个静态类型系统。</p>
<h2 id="chapter-19-hybrid-typing">Chapter 19 Hybrid Typing</h2>
<p lang="zh">混合语言是一种将静态类型和动态类型相结合的语言，它通过为静态类型语言添加一个独特的动态值类型 dyn 来丰富它。</p>
<p lang="zh">第 18 章中讨论的动态类型语言可以通过将动态类型程序视为 dyn 类型的静态类型程序来嵌入到混合语言中。这表明静态类型和动态类型并不相互对立，而是可以和谐共存。</p>
<p lang="zh">然而，混合语言的概念本身就是虚幻的，因为 dyn 类型实际上是一种特殊的递归类型。不需要任何特殊的机制来支持动态类型。相反，它们可以从更一般的递归类型概念中派生出来。此外，这表明<strong>动态类型只是静态类型的一种使用方式</strong>。因此，动态类型和静态类型之间的所谓对立是一种谬论。动态类型只是静态类型的一种特殊情况。</p>
<h3 id="a-hybrid-language">A Hybrid Language</h3>
<p><img  loading="lazy" decoding="async" fetchpriority="auto" width="944" height="331" src="/_astro/hybrid_language.B-HBolRS_1WviIc.webp" ></p>
<p>这里的 new 当然和 C++ 里的不一样，这里的 new 是添加一个 classifier 到 value，而 cast 是检查这个 classifier，然后返回对应的 value。</p>
<p><img  loading="lazy" decoding="async" fetchpriority="auto" width="962" height="988" src="/_astro/statics_and_dynamics_of_hybrid_language.D5cyZFiK_2lgOB1.webp" ></p>
<p>几个定理：</p>
<p><img  loading="lazy" decoding="async" fetchpriority="auto" width="947" height="615" src="/_astro/lemmas_and_theorems_of_hybrid_language.DVj1gOxp_slGzy.webp" ></p>
<p>有 sum type 和 recursive type 的语言里 dyn 不需要是一个 primitive。</p>
<p><img  loading="lazy" decoding="async" fetchpriority="auto" width="1000" height="459" src="/_astro/dyn_by_sum_and_recursive_type.DC-fp_ih_9SkEk.webp" ></p>
<h3 id="dynamic-as-static-typing">Dynamic as Static Typing</h3>
<p lang="en"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">L</mi><mo stretchy="false">{</mo><mi>d</mi><mi>y</mi><mi>n</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\mathcal L \{dyn\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathcal">L</span><span class="mopen">{</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal">n</span><span class="mclose">}</span></span></span></span> 可以嵌入到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">L</mi><mo stretchy="false">{</mo><mtext>nat dyn </mtext><mo>⇀</mo><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\mathcal L \{\text{nat dyn } \rightharpoonup\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathcal">L</span><span class="mopen">{</span><span class="mord text"><span class="mord">nat dyn </span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⇀</span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mclose">}</span></span></span></span> 中，只需要一个简单的翻译</p>
<p><img  loading="lazy" decoding="async" fetchpriority="auto" width="958" height="715" src="/_astro/dynamic_as_static_typing.BquTun9D_Z2hbGGR.webp" ></p>
<h3 id="optimization-of-dynamic-typing">Optimization of Dynamic Typing</h3>
<p lang="zh">考虑之前提到的那个加法函数。</p>
<p><img  loading="lazy" decoding="async" fetchpriority="auto" width="954" height="424" src="/_astro/optimization_of_dynamic_typing.BTtOSNYp_Z1XGiNT.webp" ></p>
<p lang="zh">我们之前已经指出它具有大量可以在静态类型版本中消除的开销。消除这些开销需要静态类型</p>
<blockquote>
<p lang="zh">由于动态语言只能表示一种类型的值，因此不可能在动态语言中表达优化后的形式。动态语言所声称的自由——即由于省略了类型而带来的灵活性——实际上对语言的表达能力施加了严重的限制，相比之下，具有动态值类型的静态语言则更具表现力。</p>
</blockquote>
<p lang="zh">首先，关于前文所说 p 绑定递归的低效性。我们只需要简单地把 p 的类型改成 <code>dyn -> dyn</code> 就能直接表达 p 是一个作用于动态值函数的不变量。</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>fun ! λ (x : dyn) fun ! fix p : dyn -> dyn is λ (y : dyn) e'(x,p,y')</span></span></code></pre>
<p>其中 <code>e'(x,p,y')</code> 是</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>ifz (y ? num) { zero ⇒ x | succ(y') ⇒ num ! (s(p(num! y') ? num)) }.</span></span></code></pre>
<p lang="zh">这样，循环内部的 p 就无须 tag check 了。</p>
<p lang="zh">接下来，观察到类型为 <code>dyn</code> 的参数 <code>y</code> 在每次循环迭代时都会被转换为一个数字，然后才会被测试是否为零。由于此函数是递归的，参数 <code>y</code> 在两种情况下会绑定到值：</p>
<ol lang="zh">
<li>在最初调用加法函数时。</li>
<li>在每次递归调用时。</li>
</ol>
<p lang="zh">但是，递归调用是在 <code>y</code> 的 predecessor 上进行的，而前驱一定是一个自然数。在调用点上，它被标记为 <code>num</code>，但在下一次迭代的条件检查中却会被移除。这表明，我们应该在循环外部就对 <code>y</code> 进行类型转换，避免在递归调用中对参数进行类型转换。</p>
<p lang="zh">这样做会改变函数的类型，从 <code>dyn -> dyn</code> 变为 <code>nat -> dyn</code>。因此，还需要进一步更改，以确保整个函数保持类型正确。</p>
<p lang="zh">继续观察。递归调用的结果会进行检查，以确保其类别是 <code>num</code>，然后对底层值进行递增，并将其标记为 <code>num</code>。如果递归调用的结果来自条件语句的这个分支，则显然类别检查是多余的，因为我们已经知道它必须具有 <code>num</code> 类别。但如果结果来自条件语句的另一个分支呢？在这种情况下，函数返回 <code>x</code>，但 <code>x</code> 不一定是 <code>num</code>，因为它是由函数的调用者提供的。然而，我们可以合理地认为，向加法函数传递非数值参数是一个错误。这可以通过将条件分支中的 <code>x</code> 替换为 <code>x ? num</code> 来强制执行。</p>
<p lang="zh">结合这些优化，我们得到内循环 <code>e''(x)</code> 的最终形式如下：</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>fix p : nat -> nat is λ (y : nat) ifz y { zero ⇒ x ? num | succ(y') ⇒ s(p(y')) }.</span></span></code></pre>
<p lang="zh">这个函数的类型是 nat -> nat，并且在应用于自然数时会以全速运行——所有的检查都已经从内部循环中移除。</p>
<p lang="zh">最后，回顾一下我们的整体目标：我们希望定义一个加法函数，该函数作用于 <code>dyn</code> 类型的值。因此，我们需要一个 <code>dyn -> dyn</code> 的值，而当前我们得到的是 <code>nat -> nat</code>。可以通过在前面预加一个 num 类型转换，并在后面加一个 num 类型的强制转换来获得所需的形式：</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>fun ! λ (x : dyn) fun ! λ (y : dyn) num ! (e''(x) (y ? num)).</span></span></code></pre>
<p lang="zh">最内层的 λ-抽象 通过组合类检查将 e”(x) 从 <code>nat -> nat</code> 转换为 <code>dyn -> dyn</code>，确保 <code>y</code> 在初始调用时是一个自然数，并将结果重新标记为 <code>dyn</code>。</p>
<p lang="zh">这些转换的结果是，计算的内部循环可以“全速”运行，不需要对函数或数字进行 tag check。而加法函数的最外层仍然保持为 <code>dyn</code> 类型的值，它封装了一个柯里化函数，接收两个 <code>dyn</code> 类型的参数。这种方式保留了所有对加法函数的调用的正确性，即传递和返回 <code>dyn</code> 类型的值，同时优化其执行过程。</p>
<p lang="zh">当然，我们还可以去除加法函数的类标签，将其类型从 <code>dyn</code> 更改为更具描述性的 <code>dyn -> dyn -> dyn</code>。但这要求调用者不能将加法视为 <code>dyn</code> 类型的值，而必须将其视为一个函数，该函数必须依次应用于两个 <code>dyn</code> 类型的值，并且它们的 class 必须是 num。如果程序员可以控制在哪里调用该函数，就可以进行这样的转换，并不会有什么问题。只有在可能存在程序员无法直接控制的外部 call 时，才有必要将加法函数封装为 <code>dyn</code> 类型的值。</p>
<p lang="zh">从这个原则出发，我们可以得出一个更广泛的结论：动态类型的作用仅限于系统的“边缘”，即那些涉及不受控制的调用的地方。在系统的内部，仅使用 dyn 类型没有任何好处，反而会带来相当大的弊端。</p>
<h3 id="static-versus-dynamic-typing">Static Versus Dynamic Typing</h3>
<p lang="zh">动态类型的支持者曾试图通过各种方式区分动态语言和静态语言。我们可以从当前的视角来重新审视这些所谓的区别。</p>
<ul lang="zh">
<li>
<p lang="zh"><strong>“动态语言将类型与值关联，而静态语言将类型与变量关联。“</strong><br>
但这种说法是错误的，源于将“类型”（types）与“类别”（classes）混淆的错误认识。动态语言实际上是通过标记（tagging）来将 class 与 value 关联，比如使用 <code>num</code> 和 <code>fun</code> 这样的标识符。这种分类方法本质上等同于在静态类型语言中使用递归和 sum types。因此，这并不是动态语言的一个独特特性。此外，静态语言不仅为变量分配类型，还为表达式分配类型。由于动态语言本质上是一种特殊的静态语言（仅包含单一类型），因此它们同样也为表达式分配类型。</p>
<p lang="zh">举一点现实语言的例子。比如 C 标准库的 qsort 为</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="c"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> qsort</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    void*</span><span style="color:#E36209;--shiki-dark:#FFAB70"> ptr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">size_t</span><span style="color:#E36209;--shiki-dark:#FFAB70"> count</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">size_t</span><span style="color:#E36209;--shiki-dark:#FFAB70"> size</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">comp</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#D73A49;--shiki-dark:#F97583"> void*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#D73A49;--shiki-dark:#F97583"> void*</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span></code></pre>
<p lang="zh">其实这里的 <code>void*</code> 就充当了某种 <code>dyn</code> 的作用。C++ 中也有更现代的 <code>std::any</code></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> &#x3C;any></span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> &#x3C;iostream></span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> main</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::any a </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::cout </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">type</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">name</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> ": "</span><span style="color:#D73A49;--shiki-dark:#F97583"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">any_cast</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">a</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> '</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  a </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 3.14</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::cout </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">type</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">name</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> ": "</span><span style="color:#D73A49;--shiki-dark:#F97583"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">any_cast</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">double</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">a</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> '</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  a </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::cout </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">type</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">name</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> ": "</span><span style="color:#D73A49;--shiki-dark:#F97583"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">any_cast</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">bool</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">a</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> '</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // Outputs:</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // double: 3.14</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // bool: true</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // bad any_cast</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span></code></pre>
</li>
<li>
<p lang="zh"><strong>“动态语言在运行时检查类型，而静态语言在编译时检查类型。“</strong><br>
这也是一个错误的说法。动态语言和静态语言在本质上都是静态类型的，只不过动态语言采用了一种退化的类型系统，即只有一个类型。如我们所见，动态语言确实会在运行时进行类别检查（class checks），但静态语言中如果允许 sum types，同样也需要执行类别检查。真正的区别仅在于类别检查的使用范围：在动态语言中，类别检查是始终必须的；而在静态语言中，类别检查只在必要时才会进行。</p>
</li>
<li>
<p lang="zh"><strong>“动态语言支持异构集合，而静态语言只支持同构集合。”</strong></p>
<p lang="zh">（这句话说的是，你可以在动态语言中构造 <code>[1, true, "foo", { bar: null }]</code> 这样元素类型不同的集合，而这些人认为静态语言中做不到这一点）</p>
<p lang="zh">这同样是一个错误的说法。静态语言中的 sum types 本来就是用于支持异构数据的，任何支持 sum type 的静态语言都可以表示异构数据结构。例如，考虑以下列表：</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>cons(num(1); cons(fun(λ(x)x); nil))</span></span></code></pre>
<p lang="zh">有人认为在静态语言中无法表示这样的列表，因为它的元素类型不同。然而，无论是在静态语言还是动态语言中，这种列表实际上都是类型同构（<em>type</em> homogeneous）的，只不过它的元素类别可能是异构（<em>class</em> heterogeneous）的。在上述列表中，所有元素的类型都是 <code>dyn</code>，但第一个元素的类别是 <code>num</code>，第二个元素的类别是 <code>fun</code>。</p>
<p lang="zh">在这里我们甚至也能给出一个现实生活的例子： <a href="https://crystal-lang.org/">Crystal 语言</a>。一个编译的、native 的静态语言。它支持以类型 itself 为 tag 的 sum type（或者被叫作 union type），所以你很容易写出</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="crystal"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">arr </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">[</span><span style="color:#005cc5;--shiki-dark:#79b8ff">]</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int32</span><span style="color:#D73A49;--shiki-dark:#F97583"> |</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> String</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">arr.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">push</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">arr.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">push</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"qwq"</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">puts</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> arr </span><span style="color:#6A737D;--shiki-dark:#6A737D"># 输出 [1, "qwq"]</span></span></code></pre>
<p lang="zh">这很好的打破了这句话。</p>
</li>
</ul>
<p lang="zh">所以，我们该如何看待动态语言和静态语言之间的这种所谓的区别呢？</p>
<p lang="zh">与其说它们是对立的，不如说动态语言实际上是静态语言的一种使用方式。每一种动态语言本质上都是一种静态语言，只不过它的类型系统极为有限（只有一个类型！）。然而，正如我们之前所看到的，类型对于程序的正确性和效率至关重要，它们不仅用于表达程序的不变性（invariants），还用于强制执行这些不变性。因此，动态语言的“自由”实际上是一种受限的自由，牺牲了类型信息所能提供的优势。</p>
<hr>
<p lang="sk">版权声明： CC BY-NC-SA 4.0</p> </div>
    <div class="divider"></div>
    <p class="post-meta flex flex-wrap items-center gap-2 text-base-content/60 undefined" data-astro-cid-qtyrxm4s> <span class="date flex gap-1 items-center flex-shrink-0 text-sm" data-astro-cid-qtyrxm4s> <svg width="1em" height="1em" data-icon="mingcute:calendar-2-line">   <symbol id="ai:mingcute:calendar-2-line" viewBox="0 0 24 24"><g fill="none" fill-rule="evenodd"><path d="m12.594 23.258l-.012.002l-.071.035l-.02.004l-.014-.004l-.071-.036q-.016-.004-.024.006l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.016-.018m.264-.113l-.014.002l-.184.093l-.01.01l-.003.011l.018.43l.005.012l.008.008l.201.092q.019.005.029-.008l.004-.014l-.034-.614q-.005-.019-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.003-.011l.018-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M16 3a1 1 0 0 1 1 1v1h2a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h2V4a1 1 0 0 1 2 0v1h6V4a1 1 0 0 1 1-1M8 7H5v2h14V7h-3zm-3 4v8h14v-8zm2 2a1 1 0 0 1 1-1h.01a1 1 0 1 1 0 2H8a1 1 0 0 1-1-1m1 2a1 1 0 1 0 0 2h.01a1 1 0 1 0 0-2zm3-2a1 1 0 0 1 1-1h.01a1 1 0 1 1 0 2H12a1 1 0 0 1-1-1m1 2a1 1 0 1 0 0 2h.01a1 1 0 1 0 0-2zm3-2a1 1 0 0 1 1-1h.01a1 1 0 1 1 0 2H16a1 1 0 0 1-1-1m1 2a1 1 0 1 0 0 2h.01a1 1 0 1 0 0-2z"/></g></symbol><use href="#ai:mingcute:calendar-2-line"></use>  </svg> <time datetime="2025-03-22T15:43:39.000Z"> 2025-03-22 </time> </span> <span class="categories items" data-astro-cid-qtyrxm4s> <a class="item" href="/categories/Practical Foundations for Programming Languages/" data-astro-cid-qtyrxm4s> <svg width="1em" height="1em" class="flex-shrink-0" data-astro-cid-qtyrxm4s="true" data-icon="mingcute:folder-2-line">   <symbol id="ai:mingcute:folder-2-line" viewBox="0 0 24 24"><g fill="none"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M9.52 3a2 2 0 0 1 1.442.614l.12.137L12.48 5.5H20a2 2 0 0 1 1.995 1.85L22 7.5V19a2 2 0 0 1-1.85 1.995L20 21H4a2 2 0 0 1-1.995-1.85L2 19V5a2 2 0 0 1 1.85-1.995L4 3zM20 11H4v8h16zM9.52 5H4v4h16V7.5h-7.52a2 2 0 0 1-1.442-.614l-.12-.137z"/></g></symbol><use href="#ai:mingcute:folder-2-line"></use>  </svg> <span class="truncate" data-astro-cid-qtyrxm4s>Practical Foundations for Programming Languages</span> </a> </span> <span class="tags items" data-astro-cid-qtyrxm4s>  </span> </p> 
    <div class="mt-8"><div class="comments-container"> <div id="gitalk-mainEl" data-uid="blog:pfpl-note-6"></div> </div> <script type="module" src="/_astro/GitalkComment.astro_astro_type_script_index_0_lang.yHboq2cn.js"></script> </div> </div> </article>  </main> <footer> <div class="text-center mb-4 markdown-body"> <p>
&copy; 2025 Linca. All rights reserved.
</p> <p>
开业 <span id="BLOG_DAYS" data-first-date="1538918349000">2543</span> 天里，写下了 54 篇博客，2 篇页面，8 篇杂记，352905 字符。
</p> <p>
Powered by
<a href="https://astro.build" target="_blank" rel="noopener noreferrer">
Astro
</a>
and
<a href="https://github.com/Lhcfl/astro-theme-krypton2" target="_blank" rel="noopener noreferrer">
Krypton 2
</a>.
</p> </div> </footer> <script type="module">document.addEventListener("astro:page-load",()=>{const t=document.getElementById("BLOG_DAYS");if(t){const e=Date.now()-Number(t.dataset.firstDate),n=Math.floor(e/(1e3*60*60*24));t.textContent=n.toString()}});</script> </div> </div> <div class="sidebar__outer-container
              hidden print:hidden!
              flex-grow-0 flex-shrink max-w-70 has-sidebar:flex-shrink-0
              md:block md:relative md:has-sidebar:w-50
              lg:flex-shrink-0 lg:has-sidebar:w-70
              xl:w-70
              max-md:show-toc:z-10 max-md:show-toc:block max-md:show-toc:fixed max-md:show-toc:bottom-2 max-md:show-toc:w-full max-md:show-toc:max-w-full
              max-md:[body.show-toc_&]:animate-fade-in-up max-md:[body.show-toc_&]:animate-duration-300 max-md:[body.show-toc_&]:animate-ease-in-out
              max-md:[body.removing-toc_&]:animate-fade-out-down max-md:[body.removing-toc_&]:animate-duration-300 max-md:[body.removing-toc_&]:animate-ease-in-out"> <div class="sidebar__inner-container
          sticky top-0 bg-surface pt-6
          md:px-0 md:h-screen
          max-md:show-toc:px-2 max-md:show-toc:pt-4 max-md:show-toc:border-t max-md:show-toc:border-base-300 overflow-y-auto overflow-x-visible">  <div class="hidden has-sidebar:block min-[55rem]:block"> <div id="page-toc"> <ul class="timeline w-full"> <li class="toc-item group flex items-center gap-2 transition" un-text="base-content/60 [&.active]:secondary [&.active-now]:secondary+30" un-p="x-2 y-1" un-hover="bg-secondary/10 text-secondary" data-slug="chapter-17-the-untyped-lambda-calculus"> <a href="#chapter-17-the-untyped-lambda-calculus" class="flex items-center gap-1 w-full"> <div class="flex-shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-0">Chapter 17 The Untyped Lambda Calculus</span> </a> </li><li class="toc-item group flex items-center gap-2 transition" un-text="base-content/60 [&.active]:secondary [&.active-now]:secondary+30" un-p="x-2 y-1" un-hover="bg-secondary/10 text-secondary" data-slug="statics"> <a href="#statics" class="flex items-center gap-1 w-full"> <div class="flex-shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-2">Statics</span> </a> </li><li class="toc-item group flex items-center gap-2 transition" un-text="base-content/60 [&.active]:secondary [&.active-now]:secondary+30" un-p="x-2 y-1" un-hover="bg-secondary/10 text-secondary" data-slug="dynamics"> <a href="#dynamics" class="flex items-center gap-1 w-full"> <div class="flex-shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-2">Dynamics</span> </a> </li><li class="toc-item group flex items-center gap-2 transition" un-text="base-content/60 [&.active]:secondary [&.active-now]:secondary+30" un-p="x-2 y-1" un-hover="bg-secondary/10 text-secondary" data-slug="definablity"> <a href="#definablity" class="flex items-center gap-1 w-full"> <div class="flex-shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-2">Definablity</span> </a> </li><li class="toc-item group flex items-center gap-2 transition" un-text="base-content/60 [&.active]:secondary [&.active-now]:secondary+30" un-p="x-2 y-1" un-hover="bg-secondary/10 text-secondary" data-slug="church-numerals"> <a href="#church-numerals" class="flex items-center gap-1 w-full"> <div class="flex-shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-4">Church Numerals</span> </a> </li><li class="toc-item group flex items-center gap-2 transition" un-text="base-content/60 [&.active]:secondary [&.active-now]:secondary+30" un-p="x-2 y-1" un-hover="bg-secondary/10 text-secondary" data-slug="church-pairs"> <a href="#church-pairs" class="flex items-center gap-1 w-full"> <div class="flex-shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-4">Church Pairs</span> </a> </li><li class="toc-item group flex items-center gap-2 transition" un-text="base-content/60 [&.active]:secondary [&.active-now]:secondary+30" un-p="x-2 y-1" un-hover="bg-secondary/10 text-secondary" data-slug="y-组合子"> <a href="#y-组合子" class="flex items-center gap-1 w-full"> <div class="flex-shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-4">Y 组合子</span> </a> </li><li class="toc-item group flex items-center gap-2 transition" un-text="base-content/60 [&.active]:secondary [&.active-now]:secondary+30" un-p="x-2 y-1" un-hover="bg-secondary/10 text-secondary" data-slug="scotts-theorem"> <a href="#scotts-theorem" class="flex items-center gap-1 w-full"> <div class="flex-shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-2">Scott’s Theorem</span> </a> </li><li class="toc-item group flex items-center gap-2 transition" un-text="base-content/60 [&.active]:secondary [&.active-now]:secondary+30" un-p="x-2 y-1" un-hover="bg-secondary/10 text-secondary" data-slug="这里放点我自己的思考不知道对不对"> <a href="#这里放点我自己的思考不知道对不对" class="flex items-center gap-1 w-full"> <div class="flex-shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-4">这里放点我自己的思考不知道对不对</span> </a> </li><li class="toc-item group flex items-center gap-2 transition" un-text="base-content/60 [&.active]:secondary [&.active-now]:secondary+30" un-p="x-2 y-1" un-hover="bg-secondary/10 text-secondary" data-slug="还有一些有趣的补充"> <a href="#还有一些有趣的补充" class="flex items-center gap-1 w-full"> <div class="flex-shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-4">还有一些有趣的补充</span> </a> </li><li class="toc-item group flex items-center gap-2 transition" un-text="base-content/60 [&.active]:secondary [&.active-now]:secondary+30" un-p="x-2 y-1" un-hover="bg-secondary/10 text-secondary" data-slug="untyped-meansuni-typed"> <a href="#untyped-meansuni-typed" class="flex items-center gap-1 w-full"> <div class="flex-shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-2">Untyped MeansUni-Typed</span> </a> </li><li class="toc-item group flex items-center gap-2 transition" un-text="base-content/60 [&.active]:secondary [&.active-now]:secondary+30" un-p="x-2 y-1" un-hover="bg-secondary/10 text-secondary" data-slug="chapter-18-dynamic-typing"> <a href="#chapter-18-dynamic-typing" class="flex items-center gap-1 w-full"> <div class="flex-shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-0">Chapter 18 Dynamic Typing</span> </a> </li><li class="toc-item group flex items-center gap-2 transition" un-text="base-content/60 [&.active]:secondary [&.active-now]:secondary+30" un-p="x-2 y-1" un-hover="bg-secondary/10 text-secondary" data-slug="dynamically-typed-pcf"> <a href="#dynamically-typed-pcf" class="flex items-center gap-1 w-full"> <div class="flex-shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-2">Dynamically Typed PCF</span> </a> </li><li class="toc-item group flex items-center gap-2 transition" un-text="base-content/60 [&.active]:secondary [&.active-now]:secondary+30" un-p="x-2 y-1" un-hover="bg-secondary/10 text-secondary" data-slug="statics-1"> <a href="#statics-1" class="flex items-center gap-1 w-full"> <div class="flex-shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-4">Statics</span> </a> </li><li class="toc-item group flex items-center gap-2 transition" un-text="base-content/60 [&.active]:secondary [&.active-now]:secondary+30" un-p="x-2 y-1" un-hover="bg-secondary/10 text-secondary" data-slug="dynamics-1"> <a href="#dynamics-1" class="flex items-center gap-1 w-full"> <div class="flex-shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-4">Dynamics</span> </a> </li><li class="toc-item group flex items-center gap-2 transition" un-text="base-content/60 [&.active]:secondary [&.active-now]:secondary+30" un-p="x-2 y-1" un-hover="bg-secondary/10 text-secondary" data-slug="variations-and-extensions"> <a href="#variations-and-extensions" class="flex items-center gap-1 w-full"> <div class="flex-shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-2">Variations and Extensions</span> </a> </li><li class="toc-item group flex items-center gap-2 transition" un-text="base-content/60 [&.active]:secondary [&.active-now]:secondary+30" un-p="x-2 y-1" un-hover="bg-secondary/10 text-secondary" data-slug="critique-of-dynamic-typing---对动态类型的批判"> <a href="#critique-of-dynamic-typing---对动态类型的批判" class="flex items-center gap-1 w-full"> <div class="flex-shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-2">Critique of Dynamic Typing - 对动态类型的批判</span> </a> </li><li class="toc-item group flex items-center gap-2 transition" un-text="base-content/60 [&.active]:secondary [&.active-now]:secondary+30" un-p="x-2 y-1" un-hover="bg-secondary/10 text-secondary" data-slug="chapter-19-hybrid-typing"> <a href="#chapter-19-hybrid-typing" class="flex items-center gap-1 w-full"> <div class="flex-shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-0">Chapter 19 Hybrid Typing</span> </a> </li><li class="toc-item group flex items-center gap-2 transition" un-text="base-content/60 [&.active]:secondary [&.active-now]:secondary+30" un-p="x-2 y-1" un-hover="bg-secondary/10 text-secondary" data-slug="a-hybrid-language"> <a href="#a-hybrid-language" class="flex items-center gap-1 w-full"> <div class="flex-shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-2">A Hybrid Language</span> </a> </li><li class="toc-item group flex items-center gap-2 transition" un-text="base-content/60 [&.active]:secondary [&.active-now]:secondary+30" un-p="x-2 y-1" un-hover="bg-secondary/10 text-secondary" data-slug="dynamic-as-static-typing"> <a href="#dynamic-as-static-typing" class="flex items-center gap-1 w-full"> <div class="flex-shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-2">Dynamic as Static Typing</span> </a> </li><li class="toc-item group flex items-center gap-2 transition" un-text="base-content/60 [&.active]:secondary [&.active-now]:secondary+30" un-p="x-2 y-1" un-hover="bg-secondary/10 text-secondary" data-slug="optimization-of-dynamic-typing"> <a href="#optimization-of-dynamic-typing" class="flex items-center gap-1 w-full"> <div class="flex-shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-2">Optimization of Dynamic Typing</span> </a> </li><li class="toc-item group flex items-center gap-2 transition" un-text="base-content/60 [&.active]:secondary [&.active-now]:secondary+30" un-p="x-2 y-1" un-hover="bg-secondary/10 text-secondary" data-slug="static-versus-dynamic-typing"> <a href="#static-versus-dynamic-typing" class="flex items-center gap-1 w-full"> <div class="flex-shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-2">Static Versus Dynamic Typing</span> </a> </li> </ul> </div> <script type="module">function c(i,l){let t=null,e=!1;function o(...s){e?t=s:(i.apply(this,s),e=!0,setTimeout(()=>{e=!1,t&&(o.apply(this,t),t=null)},l))}return o}function n(i){const l=document.getElementById("page-toc");if(!l)return;const t=l.querySelectorAll("li");if(t.forEach(e=>e.classList.remove("active","active-now")),i!=null)for(const e of t){if(e.dataset.slug===i){e.classList.add("active-now");break}e.classList.add("active")}}const r=c(()=>{const i=document.querySelector(".markdown-body.is-detailed");if(!i)return;const l=Array.from(i.querySelectorAll("h1,h2,h3,h4,h5,h6").values()),t=l.findIndex(e=>e.getBoundingClientRect().y>110);t===0?n(null):t==-1?n(l.at(-1)?.id):n(l.at(t-1)?.id)},200);document.addEventListener("scroll",r);</script> </div> </div> </div>  </div> <div class="float-buttons fixed bottom-4 right-4 flex flex-col gap-2 print:hidden! text-base-content" aria-hidden="true"> <div class="opacity-0 translate-x-20 transition [body.is-scrolled_&]:opacity-100 [body.is-scrolled_&]:translate-x-0"> <button onclick="window.scrollTo({ top: 0, behavior: 'smooth' })" class="rounded-full p-4 text-lg md:text-xl bg-surface border-base-300 border" aria-label="Scroll to top"> <div class="i-mingcute:arrow-up-line"></div> </button> </div> <div class="hidden has-sidebar:block md:hidden!"> <button onclick="document.body.classList.add('show-toc')" class="rounded-full p-4 text-lg md:text-xl bg-surface border-base-300 border" aria-label="Show TOC"> <div class="i-mingcute:list-check-fill"></div> </button> </div> </div> <script type="module">document.addEventListener("scroll",()=>{window.scrollY>100?document.body.classList.add("is-scrolled"):document.body.classList.remove("is-scrolled")});document.addEventListener("click",s=>{if(!document.body.classList.contains("show-toc"))return;let t=s.target;for(;t!=null;){if(t.classList.contains("float-buttons")||t.classList.contains("sidebar__inner-container"))return;t=t.parentElement}document.body.classList.remove("show-toc"),document.body.classList.add("removing-toc"),setTimeout(()=>{document.body.classList.remove("removing-toc")},280),s.stopPropagation()});</script> </body></html>