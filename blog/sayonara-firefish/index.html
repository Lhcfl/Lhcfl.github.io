<!DOCTYPE html><html lang="zh-CN"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/webp" href="/_astro/logo.zcK9pHo2_CGMl6.webp"><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/rss+xml" title="Zero Calorie Drink Shop" href="https://lhcfl.github.io/rss.xml"><meta name="generator" content="Astro v5.18.0"><!-- Font --><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://chinese-fonts-cdn.deno.dev"><link rel="preconnect" href="https://ik.imagekit.io" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://lhcfl.github.io/blog/sayonara-firefish/"><!-- Primary Meta Tags --><title>再见 Firefish (Firefish 迁移 Sharkey 指北) ⬝ Zero Calorie Drink Shop</title><meta name="title" content="再见 Firefish (Firefish 迁移 Sharkey 指北) ⬝ Zero Calorie Drink Shop"><meta name="description" content="我是去年的 11 月知道的 Firefish。它是我当时找到的最美丽的联邦宇宙软件，相比于死板的 Mastodon，过于倾向于日语又太娱乐的 Misskey，它同时兼具美观大方与功能丰富。管理员可以自由配置最大帖子长度，Nodejs 的后端也让它比 Ruby on Rails 编写的 Mastodon 对性能要求更低。我欣然安装上了它，并把它作为自己的主要联邦宇宙软件。
可惜，当时我还不知道它的状态已经岌岌可危。就在当时，原有的主要贡献者大多已经离开，panos 和 namekuji 离开了这摊烂摊子开启了新项目 Catodon。数个月后，Firefish 的 maintainer Kainoa 就直接撒手不管，在没有事先告知的情况下将 maintainer 更改给 naskya。naskya 非常负责且具有热爱，在伊的代理下 Firefish 回光返照了一段时间 —— 我也是那个时候尝试了为 Firefish 进行贡献。
可惜 maintainer 的名头为伊带来了巨大的压力与恶心的网络骚扰者。 naskya 的身体和精神状态都无法负担这样的项目，不到一年之后，Firefish 再次被抛弃。这次，大约再也没人能救 Firefish 了。
"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://lhcfl.github.io/blog/sayonara-firefish/"><meta property="og:title" content="再见 Firefish (Firefish 迁移 Sharkey 指北) ⬝ Zero Calorie Drink Shop"><meta property="og:description" content="我是去年的 11 月知道的 Firefish。它是我当时找到的最美丽的联邦宇宙软件，相比于死板的 Mastodon，过于倾向于日语又太娱乐的 Misskey，它同时兼具美观大方与功能丰富。管理员可以自由配置最大帖子长度，Nodejs 的后端也让它比 Ruby on Rails 编写的 Mastodon 对性能要求更低。我欣然安装上了它，并把它作为自己的主要联邦宇宙软件。
可惜，当时我还不知道它的状态已经岌岌可危。就在当时，原有的主要贡献者大多已经离开，panos 和 namekuji 离开了这摊烂摊子开启了新项目 Catodon。数个月后，Firefish 的 maintainer Kainoa 就直接撒手不管，在没有事先告知的情况下将 maintainer 更改给 naskya。naskya 非常负责且具有热爱，在伊的代理下 Firefish 回光返照了一段时间 —— 我也是那个时候尝试了为 Firefish 进行贡献。
可惜 maintainer 的名头为伊带来了巨大的压力与恶心的网络骚扰者。 naskya 的身体和精神状态都无法负担这样的项目，不到一年之后，Firefish 再次被抛弃。这次，大约再也没人能救 Firefish 了。
"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://lhcfl.github.io/blog/sayonara-firefish/"><meta property="twitter:title" content="再见 Firefish (Firefish 迁移 Sharkey 指北) ⬝ Zero Calorie Drink Shop"><meta property="twitter:description" content="我是去年的 11 月知道的 Firefish。它是我当时找到的最美丽的联邦宇宙软件，相比于死板的 Mastodon，过于倾向于日语又太娱乐的 Misskey，它同时兼具美观大方与功能丰富。管理员可以自由配置最大帖子长度，Nodejs 的后端也让它比 Ruby on Rails 编写的 Mastodon 对性能要求更低。我欣然安装上了它，并把它作为自己的主要联邦宇宙软件。
可惜，当时我还不知道它的状态已经岌岌可危。就在当时，原有的主要贡献者大多已经离开，panos 和 namekuji 离开了这摊烂摊子开启了新项目 Catodon。数个月后，Firefish 的 maintainer Kainoa 就直接撒手不管，在没有事先告知的情况下将 maintainer 更改给 naskya。naskya 非常负责且具有热爱，在伊的代理下 Firefish 回光返照了一段时间 —— 我也是那个时候尝试了为 Firefish 进行贡献。
可惜 maintainer 的名头为伊带来了巨大的压力与恶心的网络骚扰者。 naskya 的身体和精神状态都无法负担这样的项目，不到一年之后，Firefish 再次被抛弃。这次，大约再也没人能救 Firefish 了。
"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.Bk5rygI5.js"></script><link rel="stylesheet" href="/_astro/_static_page_.D_hEsS3a.css">
<link rel="stylesheet" href="/_astro/_static_page_.CVCZMPgC.css">
<link rel="stylesheet" href="/_astro/_static_page_.DUMM9sSp.css"><script type="module" src="/_astro/page.B5CPI74E.js"></script></head> <body class="overflow-y-scroll has-sidebar"> <div class="app bg-surface text-content md:flex lg:justify-center max-w-full">  <header class="flex-[0_0_auto] print:hidden flex sticky top-0 font-sans max-md:items-center max-md:justify-between max-md:w-full max-md:h-15 max-md:z-50 max-md:bg-surface max-md:px-2 max-lg:w-20 md:flex-col md:h-screen md:text-lg md:p-4 md:shrink-0 md:grow-0 max-md:border-b md:border-r border-base-300"> <a href="/" class="flex flex-col items-center gap-2 lg:mt-4"> <div class="nav-site-avatar avatar w-10 md:w-12 lg:hidden"> <img src="/_astro/logo.zcK9pHo2_CGMl6.webp" alt="Zero Calorie Drink Shop" loading="eager" decoding="async" fetchpriority="auto" width="100" height="100"> </div> <div class="nav-site-avatar avatar max-lg:hidden w-40"> <img src="/_astro/logo.zcK9pHo2_ZuqEup.webp" alt="Zero Calorie Drink Shop" loading="eager" decoding="async" fetchpriority="auto" width="512" height="512"> </div> <span class="nav-site-title text-lg font-bold max-lg:hidden">Zero Calorie Drink Shop</span> </a> <nav class="links flex items-center gap-2 text-lg md:flex-col md:pt-6 md:text-2xl lg:text-base"> <a href="/" role="button" class="header-link flex items-center justify-center gap-1 transition md:h-10 md:w-full md:hover:bg-primary/10 md:hover:text-primary" aria-label="Home" data-path-name="blog/sayonara-firefish/" data-href-base="/"> <svg width="1em" height="1em" data-icon="mingcute:home-3-line">   <symbol id="ai:mingcute:home-3-line" viewBox="0 0 24 24"><g fill="none"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M10.772 2.688a2 2 0 0 1 2.317-.099l.139.1l8.384 6.52c.721.561.37 1.692-.499 1.785l-.116.006H20v8a2 2 0 0 1-1.85 1.995L18 21H6a2 2 0 0 1-1.994-1.85L4 19v-8h-.997C2.09 11 1.671 9.892 2.3 9.285l.088-.076zM12 4.267L5.625 9.225c.229.185.375.468.375.785V19h3v-5a3 3 0 1 1 6 0v5h3v-8.99c0-.317.146-.6.375-.785zM12 13a1 1 0 0 0-1 1v5h2v-5a1 1 0 0 0-1-1"/></g></symbol><use href="#ai:mingcute:home-3-line"></use>  </svg> <span class="max-lg:hidden"> Home </span> </a><a href="/archives" role="button" class="header-link flex items-center justify-center gap-1 transition md:h-10 md:w-full md:hover:bg-primary/10 md:hover:text-primary" aria-label="Archives" data-path-name="blog/sayonara-firefish/" data-href-base="archives"> <svg width="1em" height="1em" data-icon="mingcute:archive-line">   <symbol id="ai:mingcute:archive-line" viewBox="0 0 24 24"><g fill="none" fill-rule="evenodd"><path d="m12.594 23.258l-.012.002l-.071.035l-.02.004l-.014-.004l-.071-.036q-.016-.004-.024.006l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.016-.018m.264-.113l-.014.002l-.184.093l-.01.01l-.003.011l.018.43l.005.012l.008.008l.201.092q.019.005.029-.008l.004-.014l-.034-.614q-.005-.019-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.003-.011l.018-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M16.586 3A2 2 0 0 1 18 3.586L20.414 6A2 2 0 0 1 21 7.414V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7.414A2 2 0 0 1 3.586 6L6 3.586A2 2 0 0 1 7.414 3zM19 9H5v10h14zm-7 1a1 1 0 0 1 1 1v3.186l.414-.414a1 1 0 1 1 1.414 1.414l-2.12 2.121a1 1 0 0 1-1.415 0l-2.121-2.121a1 1 0 1 1 1.414-1.414l.414.414V11a1 1 0 0 1 1-1m4.586-5H7.414l-2 2h13.172z"/></g></symbol><use href="#ai:mingcute:archive-line"></use>  </svg> <span class="max-lg:hidden"> Archives </span> </a><a href="/notes/1" role="button" class="header-link flex items-center justify-center gap-1 transition md:h-10 md:w-full md:hover:bg-primary/10 md:hover:text-primary" aria-label="Notes" data-path-name="blog/sayonara-firefish/" data-href-base="notes"> <svg width="1em" height="1em" data-icon="mingcute:notebook-line">   <symbol id="ai:mingcute:notebook-line" viewBox="0 0 24 24"><g fill="none"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M17 2c1.598 0 3 1.3 3 3v13c0 1.7-1.4 3-3 3H6c-1.054 0-2-.95-2-2V4c0-1.054.95-2 2-2zm0 2h-7v15h7c.513 0 1-.39 1-1V5c0-.513-.49-1-1-1M8 4H6v15h2z"/></g></symbol><use href="#ai:mingcute:notebook-line"></use>  </svg> <span class="max-lg:hidden"> Notes </span> </a><a href="/tags" role="button" class="header-link flex items-center justify-center gap-1 transition md:h-10 md:w-full md:hover:bg-primary/10 md:hover:text-primary" aria-label="Tags" data-path-name="blog/sayonara-firefish/" data-href-base="tags"> <svg width="1em" height="1em" data-icon="mingcute:tag-2-line">   <symbol id="ai:mingcute:tag-2-line" viewBox="0 0 24 24"><g fill="none"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M10.238 4.827a3 3 0 0 1 2.122.878l6.485 6.486a3 3 0 0 1 0 4.242l-4.243 4.243a3 3 0 0 1-4.242 0l-6.486-6.485a3 3 0 0 1-.878-2.122V7.327a2.5 2.5 0 0 1 2.5-2.5zm0 2H5.496a.5.5 0 0 0-.5.5v4.742a1 1 0 0 0 .292.707l6.486 6.486a1 1 0 0 0 1.414 0l4.243-4.243a1 1 0 0 0 0-1.414L10.945 7.12a1 1 0 0 0-.707-.293M7.531 9.362a1.5 1.5 0 1 1 2.121 2.122a1.5 1.5 0 0 1-2.121-2.122M11.652 2a3 3 0 0 1 2.122.878l7.192 7.193a1 1 0 0 1-1.414 1.414L12.36 4.29a1 1 0 0 0-.708-.29H7a1 1 0 0 1 0-2z"/></g></symbol><use href="#ai:mingcute:tag-2-line"></use>  </svg> <span class="max-lg:hidden"> Tags </span> </a><a href="/about" role="button" class="header-link flex items-center justify-center gap-1 transition md:h-10 md:w-full md:hover:bg-primary/10 md:hover:text-primary" aria-label="About" data-path-name="blog/sayonara-firefish/" data-href-base="about"> <svg width="1em" height="1em" data-icon="mingcute:user-3-line">   <symbol id="ai:mingcute:user-3-line" viewBox="0 0 24 24"><g fill="none" fill-rule="evenodd"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M12 13c2.396 0 4.575.694 6.178 1.672c.8.488 1.484 1.064 1.978 1.69c.486.615.844 1.351.844 2.138c0 .845-.411 1.511-1.003 1.986c-.56.45-1.299.748-2.084.956c-1.578.417-3.684.558-5.913.558s-4.335-.14-5.913-.558c-.785-.208-1.524-.506-2.084-.956C3.41 20.01 3 19.345 3 18.5c0-.787.358-1.523.844-2.139c.494-.625 1.177-1.2 1.978-1.69C7.425 13.695 9.605 13 12 13m0 2c-2.023 0-3.843.59-5.136 1.379c-.647.394-1.135.822-1.45 1.222c-.324.41-.414.72-.414.899c0 .122.037.251.255.426c.249.2.682.407 1.344.582C7.917 19.858 9.811 20 12 20c2.19 0 4.083-.143 5.4-.492c.663-.175 1.096-.382 1.345-.582c.218-.175.255-.304.255-.426c0-.18-.09-.489-.413-.899c-.316-.4-.804-.828-1.451-1.222C15.843 15.589 14.023 15 12 15m0-13a5 5 0 1 1 0 10a5 5 0 0 1 0-10m0 2a3 3 0 1 0 0 6a3 3 0 0 0 0-6"/></g></symbol><use href="#ai:mingcute:user-3-line"></use>  </svg> <span class="max-lg:hidden"> About </span> </a><a href="/links" role="button" class="header-link flex items-center justify-center gap-1 transition md:h-10 md:w-full md:hover:bg-primary/10 md:hover:text-primary" aria-label="Friends" data-path-name="blog/sayonara-firefish/" data-href-base="links"> <svg width="1em" height="1em" data-icon="mingcute:link-3-line">   <symbol id="ai:mingcute:link-3-line" viewBox="0 0 24 24"><g fill="none" fill-rule="evenodd"><path d="m12.594 23.258l-.012.002l-.071.035l-.02.004l-.014-.004l-.071-.036q-.016-.004-.024.006l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.016-.018m.264-.113l-.014.002l-.184.093l-.01.01l-.003.011l.018.43l.005.012l.008.008l.201.092q.019.005.029-.008l.004-.014l-.034-.614q-.005-.019-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.003-.011l.018-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M1 10a5 5 0 0 1 5-5h6a5 5 0 0 1 0 10a1 1 0 1 1 0-2a3 3 0 1 0 0-6H6a3 3 0 0 0-.75 5.906a1 1 0 0 1-.5 1.936A5 5 0 0 1 1 10m11 1a3 3 0 1 0 0 6h6a3 3 0 0 0 .75-5.905a1 1 0 0 1 .5-1.937A5.002 5.002 0 0 1 18 19h-6a5 5 0 0 1 0-10a1 1 0 1 1 0 2"/></g></symbol><use href="#ai:mingcute:link-3-line"></use>  </svg> <span class="max-lg:hidden"> Friends </span> </a><a href="/search" role="button" class="header-link flex items-center justify-center gap-1 transition md:h-10 md:w-full md:hover:bg-primary/10 md:hover:text-primary" aria-label="Search" data-path-name="blog/sayonara-firefish/" data-href-base="search"> <svg width="1em" height="1em" data-icon="mingcute:search-3-line">   <symbol id="ai:mingcute:search-3-line" viewBox="0 0 24 24"><g fill="none" fill-rule="evenodd"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M10.5 4a6.5 6.5 0 1 0 0 13a6.5 6.5 0 0 0 0-13M2 10.5a8.5 8.5 0 1 1 15.176 5.262l3.652 3.652a1 1 0 0 1-1.414 1.414l-3.652-3.652A8.5 8.5 0 0 1 2 10.5M9.5 7a1 1 0 0 1 1-1a4.5 4.5 0 0 1 4.5 4.5a1 1 0 1 1-2 0A2.5 2.5 0 0 0 10.5 8a1 1 0 0 1-1-1"/></g></symbol><use href="#ai:mingcute:search-3-line"></use>  </svg> <span class="max-lg:hidden"> Search </span> </a> </nav> <div class="navbar-end md:flex-grow md:flex md:items-baseline-last md:justify-center"> <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();</script><script>(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t),11:t=>1/0*t},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="18tXJb" component-url="/_astro/DarkLightToggle.DYSrvQvV.js" component-export="default" renderer-url="/_astro/client.svelte.DN8iM4l6.js" props="{}" ssr client="load" opts="{&quot;name&quot;:&quot;DarkLightToggle&quot;,&quot;value&quot;:true}" await-children><!--[--><button class="i-mingcute:moon-stars-line" aria-label="toggle theme"></button><!--]--><!--astro:end--></astro-island> </div> </header> <div class="main-and-footer__outer-container max-w-full min-h-screen overflow-x-hidden flex flex-grow flex-shrink flex-basis-180 xl:grow-0 at-md:justify-center"> <div class="flex flex-col w-full max-w-180"> <main class="grow relative p-4 md:pt-6 undefined">  <article> <h1 class="page-title text-3xl font-bold"> <span class="inline-flex items-center gap-1">   <span>再见 Firefish (Firefish 迁移 Sharkey 指北)</span>  </span> </h1> <div> <div class="markdown-body is-detailed"> <p lang="zh">我是去年的 11 月知道的 <a href="https://web.archive.org/web/20240102075130/https://joinfirefish.org/">Firefish</a>。它是我当时找到的最美丽的联邦宇宙软件，相比于死板的 <a href="https://joinmastodon.org/">Mastodon</a>，过于倾向于日语又太娱乐的 <a href="https://misskey-hub.net/en/">Misskey</a>，它同时兼具美观大方与功能丰富。管理员可以自由配置最大帖子长度，Nodejs 的后端也让它比 Ruby on Rails 编写的 Mastodon 对性能要求更低。我欣然安装上了它，并把它作为自己的主要联邦宇宙软件。</p>
<p lang="zh">可惜，当时我还不知道它的状态已经岌岌可危。就在当时，原有的主要贡献者大多已经离开，panos 和 namekuji 离开了这摊烂摊子开启了新项目 <a href="https://codeberg.org/catodon/catodon">Catodon</a>。数个月后，Firefish 的 maintainer Kainoa 就直接撒手不管，在没有事先告知的情况下将 maintainer 更改给 naskya。naskya 非常负责且具有热爱，在伊的代理下 Firefish 回光返照了一段时间 —— 我也是那个时候尝试了为 Firefish 进行贡献。</p>
<p lang="zh">可惜 maintainer 的名头为伊带来了巨大的压力与恶心的网络骚扰者。 naskya 的身体和精神状态都无法负担这样的项目，不到一年之后，<a href="https://info.firefish.dev/notes/9xsukr38m3komd63">Firefish 再次被抛弃</a>。这次，大约再也没人能救 Firefish 了。</p>
<!-- more -->
<h2 id="goodbye-firefish">Goodbye Firefish</h2>
<p lang="zh">我很难不把 Kainoa 的行为称为一种残忍，他将一团糟的 Firefish 项目丢给毫无准备的 naskya ，此时伊甚至还没有过什么编程经验。但 naskya 的确是一个非常负责的人。伊接手 Firefish 的时候就知道自己的身体和精神状态糟糕，但还是努力维护了 Firefish 一段时间。</p>
<p lang="pt">naskya 留给 Firefish 最后的体面。 伊维护了 Firefish 代码库中的 <a href="https://firefish.dev/firefish/firefish/-/blob/develop/docs/downgrade.sql?ref_type=heads">downgrade.sql</a> （/docs/downgrade.sql），这份文件提供了 Firefish 从当前版本降级到 Firefish 1.05 rc-1 的能力，也为迁移提供了可能。没有这份文件，目前运营 Firefish 的服务器很可能都会再也无法迁移到其他版本。</p>
<p lang="zh">这篇笔记也将告诉你如何用这份文件迁移你的 Firefish 到 <a href="https://activitypub.software/TransFem-org/Sharkey/">Sharkey</a>.</p>
<p>Sharkey 是基于 Misskey 的另一个 Fork，其功能与 Firefish 相似。</p>
<p lang="zh">本笔记适用于 Firefish 1.05 （即 v20240206 ）以上。如果您的 Firefish 版本低于 1.05，可以直接按照其他软件的官方说明迁移。<del>您完全不升级的吗？那还迁移什么呢？</del></p>
<h2 id="准备工作">准备工作</h2>
<p lang="zh"><strong>在接下来的操作前，请务必备份你的数据库。</strong> 迁移前请务必备份你的数据库，因为这是一个非常非常危险的操作，一旦失误会弄坏你的数据库。</p>
<p lang="zh"><strong>请先在本地测试环境中按该笔记进行操作，再在生产环境操作。</strong> 原因同上。</p>
<p lang="zh">本教程基于 Manual 安装而非 Docker 安装，如果你使用的是 Docker 安装，关于数据库的操作很可能有区别。抱歉我无法提供这方面的帮助，请自行将下面的命令翻译为 Docker 上的数据库操作。</p>
<h3 id="备份">备份</h3>
<p lang="zh"><strong>如果你要正式开始迁移工作，请务必在备份前停止 Firefish。</strong> 但如果你只是现在本地环境中进行测试，就不必了。</p>
<p lang="zh">使用 pg_dump 将你的数据库进行备份。命令大约如下：</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">pg_dump</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> {your_database_name}</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -f</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> {backupname}.sql</span></span></code></pre>
<p lang="zh">例如，如果你的数据库名是 firefish，可以这样：</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">pg_dump</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> firefish</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -f</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> firefish_20240906.sql</span></span></code></pre>
<p lang="zh">对于整篇笔记，我们假定您的数据库名是 <code>firefish</code> 。数据库用户名也是 <code>firefish</code>， 密码是 <code>firefish_pswd</code>。请在下文自行替换对应名称。</p>
<p lang="ro">数据库的用户名和密码可以在 Firefish 目录下的 <code>.config/default.yml</code> 找到</p>
<p lang="zh">你可以考虑在导出 sql 的时候不导出权限和用户名，这样可以方便迁移到其他用户和其他数据库名上。否则，如果你不是原地迁移。后面的迁移可能会遇到权限问题。如果遇到了这样的问题，你可以看看 <a href="#%E9%99%84%E5%BD%95%EF%BC%9A%E6%9D%83%E9%99%90%E9%94%99%E8%AF%AF%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95">附录：权限错误与解决方法</a> 。</p>
<ul lang="zh">
<li><code>--no-owner</code>：不导出对象所有者信息。</li>
<li><code>--no-privileges</code> 或 <code>--no-acl</code>：不导出对象的权限（访问控制列表）。</li>
</ul>
<h3 id="还原">还原</h3>
<p lang="zh">如果您在本地测试环境，或者其他服务器中尝试接下来的步骤，您现在已经可以将您的备份文件下载到对应环境了。</p>
<p lang="zh">或者，如果您的 Firefish 还在使用 Postgres 12 甚至以下，数据库的版本已经过旧，您可以趁机升级一下数据库版本。</p>
<p lang="zh">您接下来可以使用这样的命令恢复数据库：</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">psql</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> postgres</span></span></code></pre>
<p lang="sl">进入 postgres。</p>
<p lang="zh">如果你是还原备份，此时已经存在 <code>firefish</code> 数据库，请把它删掉：</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">DROP</span><span style="color:#D73A49;--shiki-dark:#F97583"> DATABASE</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> firefish;</span></span></code></pre>
<p>此后，执行：</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">CREATE</span><span style="color:#D73A49;--shiki-dark:#F97583"> DATABASE</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> firefish</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">exit</span></span></code></pre>
<p>创建 firefish 数据库。</p>
<p lang="zh">现在，执行这样的命令：</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">psql</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -U</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> {your_username}</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -d</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> {your_database}</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -f</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> {your_backup}.sql</span></span></code></pre>
<p>例如，对 <code>firefish</code> 用户还原 <code>firefish</code> 数据库，你可以：</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">psql</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -U</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> firefish</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -d</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> firefish</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -f</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> path/to/backup.sql</span></span></code></pre>
<h2 id="降级">降级</h2>
<p lang="zh">该内容来自 <a href="https://firefish.dev/firefish/firefish/-/blob/develop/docs/downgrade.md?ref_type=heads">Firefish 官方降级文档</a>，有使用自己经验的修改。</p>
<p lang="zh"><strong>不要升级你现在使用的 Firefish 版本。在 firefish 软件的根目录原地进行此操作：</strong></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">psql</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> --file=docs/downgrade.sql</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> --user=your_user_name</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> --dbname=your_database_name</span></span></code></pre>
<p>例如，本案例中是</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">psql</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> --file=docs/downgrade.sql</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> --user=firefish</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> --dbname=firefish</span></span></code></pre>
<p lang="en">If you get the <code>FATAL: Peer authentication failed</code> error, you also need to provide the <code>--host</code> option (you will be asked the password):</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">psql</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> --file=docs/downgrade.sql</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> --user=your_user_name</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> --dbname=your_database_name</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> --host=127.0.0.1</span></span></code></pre>
<p lang="zh">因为你是要迁移到 Sharkey，成功执行到这里后就不必按官方降级文档的继续了。到这里，你可以对 Firefish say bye-bye 了，后面不再需要用到它。</p>
<h3 id="安装-sharkey-仓库">安装 Sharkey 仓库</h3>
<p lang="zh">选你中意的位置，跳过新建用户的步骤（因为你的 Firefish 已经有用户了！）安装 Sharkey 直到 initialize 数据库的步骤：</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">git</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> clone</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> --recurse-submodules</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -b</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> stable</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> https://activitypub.software/TransFem-org/Sharkey.git</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">cd</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> Sharkey</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">pnpm</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> install</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> --frozen-lockfile</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">cp</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> .config/example.yml</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> .config/default.yml</span></span></code></pre>
<p lang="ro">编辑 <code>.config/default.yml</code> 使其与你的 Firefish 使用<strong>相同的数据库</strong></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>vim .config/default.yml</span></span></code></pre>
<p>Build</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">pnpm</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> run</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> build</span></span></code></pre>
<p lang="zh">接下来按照<a href="https://docs.joinsharkey.org/docs/install/migrate/">迁移说明</a>进行操作，这里为了 Manual install 做了修改：</p>
<p>psql 到你的 firefish 数据库，执行这样的 SQL:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- start a transaction, so we won't leave the db in a halfway state if</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- things go wrong</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">BEGIN</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- we need to add back some columns that Firefish removed, but that</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- Sharkey migrations expect</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "user_profile"</span><span style="color:#D73A49;--shiki-dark:#F97583"> ADD</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "integrations"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> JSONB </span><span style="color:#D73A49;--shiki-dark:#F97583">NOT NULL</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> '{}'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "meta"</span><span style="color:#D73A49;--shiki-dark:#F97583"> ADD</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "twitterConsumerSecret"</span><span style="color:#D73A49;--shiki-dark:#F97583"> VARCHAR</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">128</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "meta"</span><span style="color:#D73A49;--shiki-dark:#F97583"> ADD</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "twitterConsumerKey"</span><span style="color:#D73A49;--shiki-dark:#F97583"> VARCHAR</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">128</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "meta"</span><span style="color:#D73A49;--shiki-dark:#F97583"> ADD</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "enableTwitterIntegration"</span><span style="color:#D73A49;--shiki-dark:#F97583"> BOOLEAN</span><span style="color:#D73A49;--shiki-dark:#F97583"> NOT NULL</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> false;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "meta"</span><span style="color:#D73A49;--shiki-dark:#F97583"> ADD</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "enableGithubIntegration"</span><span style="color:#D73A49;--shiki-dark:#F97583"> BOOLEAN</span><span style="color:#D73A49;--shiki-dark:#F97583"> NOT NULL</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> false;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "meta"</span><span style="color:#D73A49;--shiki-dark:#F97583"> ADD</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "githubClientId"</span><span style="color:#D73A49;--shiki-dark:#F97583"> VARCHAR</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">128</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "meta"</span><span style="color:#D73A49;--shiki-dark:#F97583"> ADD</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "githubClientSecret"</span><span style="color:#D73A49;--shiki-dark:#F97583"> VARCHAR</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">128</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "meta"</span><span style="color:#D73A49;--shiki-dark:#F97583"> ADD</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "enableDiscordIntegration"</span><span style="color:#D73A49;--shiki-dark:#F97583"> BOOLEAN</span><span style="color:#D73A49;--shiki-dark:#F97583"> NOT NULL</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> false;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "meta"</span><span style="color:#D73A49;--shiki-dark:#F97583"> ADD</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "discordClientId"</span><span style="color:#D73A49;--shiki-dark:#F97583"> VARCHAR</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">128</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "meta"</span><span style="color:#D73A49;--shiki-dark:#F97583"> ADD</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "discordClientSecret"</span><span style="color:#D73A49;--shiki-dark:#F97583"> VARCHAR</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">128</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- also an extra table, for the same reasons</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">CREATE</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> antenna_note</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- Misskey used to have a Reversi game, Firefish dropped the tables,</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- now Misskey uses them again</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">CREATE</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> "</span><span style="color:#6F42C1;--shiki-dark:#B392F0">reversi_game</span><span style="color:#24292E;--shiki-dark:#E1E4E8">" </span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"id"</span><span style="color:#D73A49;--shiki-dark:#F97583"> character varying</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">32</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">NOT NULL</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"createdAt"</span><span style="color:#D73A49;--shiki-dark:#F97583"> TIMESTAMP WITH TIME ZONE</span><span style="color:#D73A49;--shiki-dark:#F97583"> NOT NULL</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"startedAt"</span><span style="color:#D73A49;--shiki-dark:#F97583"> TIMESTAMP WITH TIME ZONE</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"user1Id"</span><span style="color:#D73A49;--shiki-dark:#F97583"> character varying</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">32</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">NOT NULL</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"user2Id"</span><span style="color:#D73A49;--shiki-dark:#F97583"> character varying</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">32</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">NOT NULL</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"user1Accepted"</span><span style="color:#D73A49;--shiki-dark:#F97583"> boolean</span><span style="color:#D73A49;--shiki-dark:#F97583"> NOT NULL</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> false, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"user2Accepted"</span><span style="color:#D73A49;--shiki-dark:#F97583"> boolean</span><span style="color:#D73A49;--shiki-dark:#F97583"> NOT NULL</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> false, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"black"</span><span style="color:#D73A49;--shiki-dark:#F97583"> integer</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"isStarted"</span><span style="color:#D73A49;--shiki-dark:#F97583"> boolean</span><span style="color:#D73A49;--shiki-dark:#F97583"> NOT NULL</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> false, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"isEnded"</span><span style="color:#D73A49;--shiki-dark:#F97583"> boolean</span><span style="color:#D73A49;--shiki-dark:#F97583"> NOT NULL</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> false, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"winnerId"</span><span style="color:#D73A49;--shiki-dark:#F97583"> character varying</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">32</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"surrendered"</span><span style="color:#D73A49;--shiki-dark:#F97583"> character varying</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">32</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"logs"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> jsonb </span><span style="color:#D73A49;--shiki-dark:#F97583">NOT NULL</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> '[]'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"map"</span><span style="color:#D73A49;--shiki-dark:#F97583"> character varying</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">64</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">array</span><span style="color:#D73A49;--shiki-dark:#F97583"> NOT NULL</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"bw"</span><span style="color:#D73A49;--shiki-dark:#F97583"> character varying</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">32</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">NOT NULL</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"isLlotheo"</span><span style="color:#D73A49;--shiki-dark:#F97583"> boolean</span><span style="color:#D73A49;--shiki-dark:#F97583"> NOT NULL</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> false, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"canPutEverywhere"</span><span style="color:#D73A49;--shiki-dark:#F97583"> boolean</span><span style="color:#D73A49;--shiki-dark:#F97583"> NOT NULL</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> false, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"loopedBoard"</span><span style="color:#D73A49;--shiki-dark:#F97583"> boolean</span><span style="color:#D73A49;--shiki-dark:#F97583"> NOT NULL</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> false, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"form1"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> jsonb </span><span style="color:#D73A49;--shiki-dark:#F97583">DEFAULT</span><span style="color:#D73A49;--shiki-dark:#F97583"> null</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"form2"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> jsonb </span><span style="color:#D73A49;--shiki-dark:#F97583">DEFAULT</span><span style="color:#D73A49;--shiki-dark:#F97583"> null</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"crc32"</span><span style="color:#D73A49;--shiki-dark:#F97583"> character varying</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">32</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">CONSTRAINT</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "PK_76b30eeba71b1193ad7c5311c3f"</span><span style="color:#D73A49;--shiki-dark:#F97583"> PRIMARY KEY</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"id"</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">CREATE</span><span style="color:#D73A49;--shiki-dark:#F97583"> INDEX</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> "</span><span style="color:#6F42C1;--shiki-dark:#B392F0">IDX_b46ec40746efceac604142be1c</span><span style="color:#24292E;--shiki-dark:#E1E4E8">" </span><span style="color:#D73A49;--shiki-dark:#F97583">ON</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "reversi_game"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"createdAt"</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">CREATE</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> "</span><span style="color:#6F42C1;--shiki-dark:#B392F0">reversi_matching</span><span style="color:#24292E;--shiki-dark:#E1E4E8">" </span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"id"</span><span style="color:#D73A49;--shiki-dark:#F97583"> character varying</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">32</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">NOT NULL</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"createdAt"</span><span style="color:#D73A49;--shiki-dark:#F97583"> TIMESTAMP WITH TIME ZONE</span><span style="color:#D73A49;--shiki-dark:#F97583"> NOT NULL</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"parentId"</span><span style="color:#D73A49;--shiki-dark:#F97583"> character varying</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">32</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">NOT NULL</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"childId"</span><span style="color:#D73A49;--shiki-dark:#F97583"> character varying</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">32</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">NOT NULL</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">CONSTRAINT</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "PK_880bd0afbab232f21c8b9d146cf"</span><span style="color:#D73A49;--shiki-dark:#F97583"> PRIMARY KEY</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"id"</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">CREATE</span><span style="color:#D73A49;--shiki-dark:#F97583"> INDEX</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> "</span><span style="color:#6F42C1;--shiki-dark:#B392F0">IDX_b604d92d6c7aec38627f6eaf16</span><span style="color:#24292E;--shiki-dark:#E1E4E8">" </span><span style="color:#D73A49;--shiki-dark:#F97583">ON</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "reversi_matching"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"createdAt"</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">CREATE</span><span style="color:#D73A49;--shiki-dark:#F97583"> INDEX</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> "</span><span style="color:#6F42C1;--shiki-dark:#B392F0">IDX_3b25402709dd9882048c2bbade</span><span style="color:#24292E;--shiki-dark:#E1E4E8">" </span><span style="color:#D73A49;--shiki-dark:#F97583">ON</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "reversi_matching"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"parentId"</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">CREATE</span><span style="color:#D73A49;--shiki-dark:#F97583"> INDEX</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> "</span><span style="color:#6F42C1;--shiki-dark:#B392F0">IDX_e247b23a3c9b45f89ec1299d06</span><span style="color:#24292E;--shiki-dark:#E1E4E8">" </span><span style="color:#D73A49;--shiki-dark:#F97583">ON</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "reversi_matching"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"childId"</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- move aside some FireFish columns; Sharkey migrations will</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- re-create them; we don't `DROP` them because we want to keep the data</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "user"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> RENAME COLUMN </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"movedToUri"</span><span style="color:#D73A49;--shiki-dark:#F97583"> TO</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "ff_movedToUri"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "user"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> RENAME COLUMN </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"alsoKnownAs"</span><span style="color:#D73A49;--shiki-dark:#F97583"> TO</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "ff_alsoKnownAs"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "user"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> RENAME COLUMN </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"isIndexable"</span><span style="color:#D73A49;--shiki-dark:#F97583"> TO</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "ff_isIndexable"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "user"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> RENAME COLUMN </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"speakAsCat"</span><span style="color:#D73A49;--shiki-dark:#F97583"> TO</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "ff_speakAsCat"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "user_profile"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> RENAME COLUMN </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"preventAiLearning"</span><span style="color:#D73A49;--shiki-dark:#F97583"> TO</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "ff_preventAiLearning"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "meta"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> RENAME COLUMN </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"silencedHosts"</span><span style="color:#D73A49;--shiki-dark:#F97583"> TO</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "ff_silencedHosts"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- this column was added by both Firefish and Misskey, but with</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- different names, let's fix it</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "meta"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> RENAME COLUMN </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"ToSUrl"</span><span style="color:#D73A49;--shiki-dark:#F97583"> TO</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "termsOfServiceUrl"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- update antenna types, this is only needed on some instances but</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- recommend to run anyway</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">--</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- this *removes* any antennas of types not supported by Sharkey!</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">CREATE</span><span style="color:#D73A49;--shiki-dark:#F97583"> TYPE</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> public</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.new_antenna_src_enum </span><span style="color:#D73A49;--shiki-dark:#F97583">AS</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ENUM </span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'home'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'all'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'list'</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> antenna </span><span style="color:#D73A49;--shiki-dark:#F97583">ADD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN new_src </span><span style="color:#005CC5;--shiki-dark:#79B8FF">public</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">new_antenna_src_enum</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">DELETE</span><span style="color:#D73A49;--shiki-dark:#F97583"> FROM</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> antenna </span><span style="color:#D73A49;--shiki-dark:#F97583">WHERE</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> src </span><span style="color:#D73A49;--shiki-dark:#F97583">NOT</span><span style="color:#D73A49;--shiki-dark:#F97583"> IN</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'home'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'all'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'list'</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> antenna </span><span style="color:#D73A49;--shiki-dark:#F97583">DROP</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN src;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> antenna RENAME COLUMN new_src </span><span style="color:#D73A49;--shiki-dark:#F97583">TO</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> src;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">DROP</span><span style="color:#D73A49;--shiki-dark:#F97583"> TYPE</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> public</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">antenna_src_enum</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TYPE</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> new_antenna_src_enum RENAME </span><span style="color:#D73A49;--shiki-dark:#F97583">TO</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> antenna_src_enum;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- optional but recommended: delete all empty moderation log entries</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">DELETE</span><span style="color:#D73A49;--shiki-dark:#F97583"> FROM</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> moderation_log </span><span style="color:#D73A49;--shiki-dark:#F97583">WHERE</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> info </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> '{}'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- only needed on some instances, run this if</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- `\dT+ user_profile_mutingnotificationtypes_enum`</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- does not show `note` in the "elements" section</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TYPE</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "public"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"user_profile_mutingnotificationtypes_enum"</span><span style="color:#D73A49;--shiki-dark:#F97583"> ADD</span><span style="color:#D73A49;--shiki-dark:#F97583"> VALUE</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'note'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span></code></pre>
<p lang="zh">如果有任何报错信息，请停止迁移！除非你真的知道自己在干什么，不要乱动数据库。去 Sharkey 提供的 <a href="https://matrix.to/#/#sharkey-support:shourai.de">Matrix</a> or <a href="https://discord.gg/8hF6pMVWja">Discord</a> 求助。</p>
<p lang="zh">如果没有报错，你就可以接着输入</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">COMMIT</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span></code></pre>
<p>提交这些变更。</p>
<p lang="en">好了，现在你可以启动 Sharkey 的 migrations 了。在 Sharkey 的目录：</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>pnpm run migrate</span></span>
<span class="line"><span>pnpm run start</span></span></code></pre>
<p lang="zh">如果两条命令都没有报错的完成了，并且 Sharkey 说它正在监听端口， Ctrl+C 关闭 Sharkey。现在，还要对数据库进行一些小小的按摩（？）</p>
<p>仍然是</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">psql</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> firefish</span></span></code></pre>
<p>到你的数据库：</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">BEGIN</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- all existing users are approved, because Firefish doesn't have a</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- concept of approvals</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">UPDATE</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "user"</span><span style="color:#D73A49;--shiki-dark:#F97583"> SET</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> approved </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> true;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- now we put back the data we moved aside</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">UPDATE</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "user"</span><span style="color:#D73A49;--shiki-dark:#F97583"> SET</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "movedToUri"</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "ff_movedToUri"</span><span style="color:#D73A49;--shiki-dark:#F97583"> WHERE</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "ff_movedToUri"</span><span style="color:#D73A49;--shiki-dark:#F97583"> IS NOT NULL</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">UPDATE</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "user"</span><span style="color:#D73A49;--shiki-dark:#F97583"> SET</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "alsoKnownAs"</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "ff_alsoKnownAs"</span><span style="color:#D73A49;--shiki-dark:#F97583"> WHERE</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "ff_alsoKnownAs"</span><span style="color:#D73A49;--shiki-dark:#F97583"> IS NOT NULL</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">UPDATE</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "user"</span><span style="color:#D73A49;--shiki-dark:#F97583"> SET</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "noindex"</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> NOT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">COALESCE</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"ff_isIndexable"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, true</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">UPDATE</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "user"</span><span style="color:#D73A49;--shiki-dark:#F97583"> SET</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "speakAsCat"</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> COALESCE</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"ff_speakAsCat"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, false</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">UPDATE</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "user_profile"</span><span style="color:#D73A49;--shiki-dark:#F97583"> SET</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "preventAiLearning"</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> COALESCE</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"ff_preventAiLearning"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, true</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">UPDATE</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "meta"</span><span style="color:#D73A49;--shiki-dark:#F97583"> SET</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "silencedHosts"</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> COALESCE</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"ff_silencedHosts"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'{}'</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "user"</span><span style="color:#D73A49;--shiki-dark:#F97583"> DROP</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"ff_movedToUri"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "user"</span><span style="color:#D73A49;--shiki-dark:#F97583"> DROP</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"ff_alsoKnownAs"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "user"</span><span style="color:#D73A49;--shiki-dark:#F97583"> DROP</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"ff_isIndexable"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "user"</span><span style="color:#D73A49;--shiki-dark:#F97583"> DROP</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"ff_speakAsCat"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "user_profile"</span><span style="color:#D73A49;--shiki-dark:#F97583"> DROP</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"ff_preventAiLearning"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "meta"</span><span style="color:#D73A49;--shiki-dark:#F97583"> DROP</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"ff_silencedHosts"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span></code></pre>
<p lang="zh">如果没有报错，你就可以接着输入</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">COMMIT</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span></code></pre>
<p>提交这些变更。</p>
<p lang="zh">现在，Sharkey 的迁移已经完成了。你可以继续 Sharkey 的启动，比如<a href="https://docs.joinsharkey.org/docs/install/fresh/#with-systemd">配置 Systemd 项目</a>。如果你之前配了 S3, 请去管理面板查看一下这些设置项，因为可能会迁移出类似这样的 URL： <code>https://https://yourdomain.com</code>, 你可以修复它。</p>
<h2 id="附录权限错误与解决方法">附录：权限错误与解决方法</h2>
<p lang="zh">通常发生于备份文件的用户名、数据库名、权限和你的数据库内的设置不一致的时候。</p>
<p lang="zh">以下 SQL 全部需要 <code>psql firefish</code> （或对应的数据库名）后使用。需要将 <code>your_user</code> 替换成你的用户名。</p>
<h3 id="error-对表-xxx-权限不够">error: 对表 xxx 权限不够</h3>
<p lang="zh">直接把 firefish 数据库内的所有表格权限授予给你的用户：</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">GRANT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ALL PRIVILEGES </span><span style="color:#D73A49;--shiki-dark:#F97583">ON</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ALL TABLES </span><span style="color:#D73A49;--shiki-dark:#F97583">IN</span><span style="color:#D73A49;--shiki-dark:#F97583"> SCHEMA</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> public </span><span style="color:#D73A49;--shiki-dark:#F97583">TO</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> your_user;</span></span></code></pre>
<p lang="zh">然后将所有表格的 owner 设置成你的用户</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">DO $$</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">DECLARE</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  r RECORD;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">BEGIN</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  FOR</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> r </span><span style="color:#D73A49;--shiki-dark:#F97583">IN</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    SELECT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> table_schema, table_name</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    FROM</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> information_schema</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">tables</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    WHERE</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> table_schema </span><span style="color:#D73A49;--shiki-dark:#F97583">NOT</span><span style="color:#D73A49;--shiki-dark:#F97583"> IN</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'pg_catalog'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'information_schema'</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">AND</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> table_type </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'BASE TABLE'</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  LOOP</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    EXECUTE</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'ALTER TABLE '</span><span style="color:#D73A49;--shiki-dark:#F97583"> ||</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> r</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">table_schema</span><span style="color:#D73A49;--shiki-dark:#F97583"> ||</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> '.'</span><span style="color:#D73A49;--shiki-dark:#F97583"> ||</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> r</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">table_name</span><span style="color:#D73A49;--shiki-dark:#F97583"> ||</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> ' OWNER TO your_user'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  END</span><span style="color:#D73A49;--shiki-dark:#F97583"> LOOP</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">END</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">$$;</span></span></code></pre>
<h3 id="必须是类型-notification_type_enum-的属主">必须是类型 notification_type_enum 的属主</h3>
<p lang="zh">同样，将数据库中所有自定义类型的所有者更改为你的用户</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">DO $$</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">DECLARE</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  r RECORD;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">BEGIN</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  FOR</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> r </span><span style="color:#D73A49;--shiki-dark:#F97583">IN</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    SELECT</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> n</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">nspname</span><span style="color:#D73A49;--shiki-dark:#F97583"> AS</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> schema_name, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">t</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">typname</span><span style="color:#D73A49;--shiki-dark:#F97583"> AS</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> type_name</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    FROM</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> pg_type t</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    JOIN</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> pg_namespace n </span><span style="color:#D73A49;--shiki-dark:#F97583">ON</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> n</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">oid</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> t</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">typnamespace</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    WHERE</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> t</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">typowner</span><span style="color:#D73A49;--shiki-dark:#F97583"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#D73A49;--shiki-dark:#F97583">SELECT</span><span style="color:#D73A49;--shiki-dark:#F97583"> oid</span><span style="color:#D73A49;--shiki-dark:#F97583"> FROM</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> pg_roles </span><span style="color:#D73A49;--shiki-dark:#F97583">WHERE</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> rolname </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'firefish'</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      AND</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> n</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">nspname</span><span style="color:#D73A49;--shiki-dark:#F97583"> NOT</span><span style="color:#D73A49;--shiki-dark:#F97583"> IN</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'pg_catalog'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'information_schema'</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      AND</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> t</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">typtype</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'e'</span><span style="color:#6A737D;--shiki-dark:#6A737D">  -- 仅针对枚举类型（自定义类型）</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  LOOP</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    EXECUTE</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'ALTER TYPE '</span><span style="color:#D73A49;--shiki-dark:#F97583"> ||</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> r</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">schema_name</span><span style="color:#D73A49;--shiki-dark:#F97583"> ||</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> '.'</span><span style="color:#D73A49;--shiki-dark:#F97583"> ||</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> r</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">type_name</span><span style="color:#D73A49;--shiki-dark:#F97583"> ||</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> ' OWNER TO your_user'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  END</span><span style="color:#D73A49;--shiki-dark:#F97583"> LOOP</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">END</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">$$;</span></span></code></pre>
<h2 id="附录作者修订">附录：作者修订</h2>
<h3 id="用户数和帖子数一直显示-0">用户数和帖子数一直显示 0</h3>
<p lang="zh">迁移后，有概率出现用户数和帖子数一直显示 0 的问题。这时可以进入后台作业队列，如果发现像这样的错误：</p>
<p><img  loading="lazy" decoding="async" fetchpriority="auto" width="1115" height="468" src="/_astro/null_value_in_chart_sharkey_20240908030955.53v0QcdK_2sdp4K.webp" ></p>
<p lang="zh">可以去 psql 进入数据库。尝试输入：</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">\d __chart__federation</span></span></code></pre>
<p>它理应返回</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                                              数据表 </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"public.__chart__federation"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">               栏位               |        类型         | 校对规则 |  可空的  |                      预设</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">----------------------------------+---------------------+----------+----------+-------------------------------------------------</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8"> id                               | </span><span style="color:#D73A49;--shiki-dark:#F97583">integer</span><span style="color:#24292E;--shiki-dark:#E1E4E8">             |          | </span><span style="color:#D73A49;--shiki-dark:#F97583">not null</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> | nextval</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'__chart__federation_id_seq'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::regclass</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583"> date</span><span style="color:#24292E;--shiki-dark:#E1E4E8">                             | </span><span style="color:#D73A49;--shiki-dark:#F97583">integer</span><span style="color:#24292E;--shiki-dark:#E1E4E8">             |          | </span><span style="color:#D73A49;--shiki-dark:#F97583">not null</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> |</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8"> unique_temp___deliveredInstances | </span><span style="color:#D73A49;--shiki-dark:#F97583">character</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> varying</span><span style="color:#005cc5;--shiki-dark:#79b8ff">[</span><span style="color:#005cc5;--shiki-dark:#79b8ff">]</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> |          | </span><span style="color:#D73A49;--shiki-dark:#F97583">not null</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> | </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'{}'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#D73A49;--shiki-dark:#F97583">character</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> varying</span><span style="color:#005cc5;--shiki-dark:#79b8ff">[</span><span style="color:#005cc5;--shiki-dark:#79b8ff">]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8"> ___deliveredInstances            | </span><span style="color:#D73A49;--shiki-dark:#F97583">smallint</span><span style="color:#24292E;--shiki-dark:#E1E4E8">            |          | </span><span style="color:#D73A49;--shiki-dark:#F97583">not null</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> | </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'0'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#D73A49;--shiki-dark:#F97583">smallint</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8"> unique_temp___inboxInstances     | </span><span style="color:#D73A49;--shiki-dark:#F97583">character</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> varying</span><span style="color:#005cc5;--shiki-dark:#79b8ff">[</span><span style="color:#005cc5;--shiki-dark:#79b8ff">]</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> |          | </span><span style="color:#D73A49;--shiki-dark:#F97583">not null</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> | </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'{}'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#D73A49;--shiki-dark:#F97583">character</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> varying</span><span style="color:#005cc5;--shiki-dark:#79b8ff">[</span><span style="color:#005cc5;--shiki-dark:#79b8ff">]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8"> ___inboxInstances                | </span><span style="color:#D73A49;--shiki-dark:#F97583">smallint</span><span style="color:#24292E;--shiki-dark:#E1E4E8">            |          | </span><span style="color:#D73A49;--shiki-dark:#F97583">not null</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> | </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'0'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#D73A49;--shiki-dark:#F97583">smallint</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8"> unique_temp___stalled            | </span><span style="color:#D73A49;--shiki-dark:#F97583">character</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> varying</span><span style="color:#005cc5;--shiki-dark:#79b8ff">[</span><span style="color:#005cc5;--shiki-dark:#79b8ff">]</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> |          | </span><span style="color:#D73A49;--shiki-dark:#F97583">not null</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> | </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'{}'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#D73A49;--shiki-dark:#F97583">character</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> varying</span><span style="color:#005cc5;--shiki-dark:#79b8ff">[</span><span style="color:#005cc5;--shiki-dark:#79b8ff">]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8"> ___stalled                       | </span><span style="color:#D73A49;--shiki-dark:#F97583">smallint</span><span style="color:#24292E;--shiki-dark:#E1E4E8">            |          | </span><span style="color:#D73A49;--shiki-dark:#F97583">not null</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> | </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'0'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#D73A49;--shiki-dark:#F97583">smallint</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8"> ___sub                           | </span><span style="color:#D73A49;--shiki-dark:#F97583">smallint</span><span style="color:#24292E;--shiki-dark:#E1E4E8">            |          | </span><span style="color:#D73A49;--shiki-dark:#F97583">not null</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> | </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'0'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#D73A49;--shiki-dark:#F97583">smallint</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8"> ___pub                           | </span><span style="color:#D73A49;--shiki-dark:#F97583">smallint</span><span style="color:#24292E;--shiki-dark:#E1E4E8">            |          | </span><span style="color:#D73A49;--shiki-dark:#F97583">not null</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> | </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'0'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#D73A49;--shiki-dark:#F97583">smallint</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8"> ___pubsub                        | </span><span style="color:#D73A49;--shiki-dark:#F97583">smallint</span><span style="color:#24292E;--shiki-dark:#E1E4E8">            |          | </span><span style="color:#D73A49;--shiki-dark:#F97583">not null</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> | </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'0'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#D73A49;--shiki-dark:#F97583">smallint</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8"> ___subActive                     | </span><span style="color:#D73A49;--shiki-dark:#F97583">smallint</span><span style="color:#24292E;--shiki-dark:#E1E4E8">            |          | </span><span style="color:#D73A49;--shiki-dark:#F97583">not null</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> | </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'0'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#D73A49;--shiki-dark:#F97583">smallint</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8"> ___pubActive                     | </span><span style="color:#D73A49;--shiki-dark:#F97583">smallint</span><span style="color:#24292E;--shiki-dark:#E1E4E8">            |          | </span><span style="color:#D73A49;--shiki-dark:#F97583">not null</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> | </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'0'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#D73A49;--shiki-dark:#F97583">smallint</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">索引：</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "PK_b39dcd31a0fe1a7757e348e85fd"</span><span style="color:#D73A49;--shiki-dark:#F97583"> PRIMARY KEY</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, btree </span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">id</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "IDX_36cb699c49580d4e6c2e6159f9"</span><span style="color:#D73A49;--shiki-dark:#F97583"> UNIQUE</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, btree </span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#D73A49;--shiki-dark:#F97583">date</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "UQ_36cb699c49580d4e6c2e6159f97"</span><span style="color:#D73A49;--shiki-dark:#F97583"> UNIQUE</span><span style="color:#D73A49;--shiki-dark:#F97583"> CONSTRAINT</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, btree </span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#D73A49;--shiki-dark:#F97583">date</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span></code></pre>
<p lang="da">注意预设中的 <code>nextval('__chart__federation_id_seq'::regclass)</code></p>
<p lang="zh">你很可能在迁移中丢失了该预设。因此，你可以<strong>在 Sharkey 已经可以运行后</strong>尝试执行：</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">BEGIN</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> public</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">__chart__active_users</span><span style="color:#D73A49;--shiki-dark:#F97583"> ALTER</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN id </span><span style="color:#D73A49;--shiki-dark:#F97583">SET</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> nextval</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'__chart__active_users_id_seq'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::regclass</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> public</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">__chart__ap_request</span><span style="color:#D73A49;--shiki-dark:#F97583"> ALTER</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN id </span><span style="color:#D73A49;--shiki-dark:#F97583">SET</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> nextval</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'__chart__ap_request_id_seq'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::regclass</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> public</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">__chart__drive</span><span style="color:#D73A49;--shiki-dark:#F97583"> ALTER</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN id </span><span style="color:#D73A49;--shiki-dark:#F97583">SET</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> nextval</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'__chart__drive_id_seq'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::regclass</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> public</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">__chart__federation</span><span style="color:#D73A49;--shiki-dark:#F97583"> ALTER</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN id </span><span style="color:#D73A49;--shiki-dark:#F97583">SET</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> nextval</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'__chart__federation_id_seq'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::regclass</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> public</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">__chart__hashtag</span><span style="color:#D73A49;--shiki-dark:#F97583"> ALTER</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN id </span><span style="color:#D73A49;--shiki-dark:#F97583">SET</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> nextval</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'__chart__hashtag_id_seq'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::regclass</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> public</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">__chart__instance</span><span style="color:#D73A49;--shiki-dark:#F97583"> ALTER</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN id </span><span style="color:#D73A49;--shiki-dark:#F97583">SET</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> nextval</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'__chart__instance_id_seq'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::regclass</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> public</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">__chart__network</span><span style="color:#D73A49;--shiki-dark:#F97583"> ALTER</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN id </span><span style="color:#D73A49;--shiki-dark:#F97583">SET</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> nextval</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'__chart__network_id_seq'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::regclass</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> public</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">__chart__notes</span><span style="color:#D73A49;--shiki-dark:#F97583"> ALTER</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN id </span><span style="color:#D73A49;--shiki-dark:#F97583">SET</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> nextval</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'__chart__notes_id_seq'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::regclass</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> public</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">__chart__per_user_drive</span><span style="color:#D73A49;--shiki-dark:#F97583"> ALTER</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN id </span><span style="color:#D73A49;--shiki-dark:#F97583">SET</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> nextval</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'__chart__per_user_drive_id_seq'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::regclass</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> public</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">__chart__per_user_following</span><span style="color:#D73A49;--shiki-dark:#F97583"> ALTER</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN id </span><span style="color:#D73A49;--shiki-dark:#F97583">SET</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> nextval</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'__chart__per_user_following_id_seq'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::regclass</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> public</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">__chart__per_user_notes</span><span style="color:#D73A49;--shiki-dark:#F97583"> ALTER</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN id </span><span style="color:#D73A49;--shiki-dark:#F97583">SET</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> nextval</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'__chart__per_user_notes_id_seq'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::regclass</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> public</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">__chart__per_user_pv</span><span style="color:#D73A49;--shiki-dark:#F97583"> ALTER</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN id </span><span style="color:#D73A49;--shiki-dark:#F97583">SET</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> nextval</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'__chart__per_user_pv_id_seq'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::regclass</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> public</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">__chart__per_user_reaction</span><span style="color:#D73A49;--shiki-dark:#F97583"> ALTER</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN id </span><span style="color:#D73A49;--shiki-dark:#F97583">SET</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> nextval</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'__chart__per_user_reaction_id_seq'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::regclass</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> public</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">__chart__test</span><span style="color:#D73A49;--shiki-dark:#F97583"> ALTER</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN id </span><span style="color:#D73A49;--shiki-dark:#F97583">SET</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> nextval</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'__chart__test_id_seq'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::regclass</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> public</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">__chart__test_grouped</span><span style="color:#D73A49;--shiki-dark:#F97583"> ALTER</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN id </span><span style="color:#D73A49;--shiki-dark:#F97583">SET</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> nextval</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'__chart__test_grouped_id_seq'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::regclass</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> public</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">__chart__test_unique</span><span style="color:#D73A49;--shiki-dark:#F97583"> ALTER</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN id </span><span style="color:#D73A49;--shiki-dark:#F97583">SET</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> nextval</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'__chart__test_unique_id_seq'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::regclass</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> public</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">__chart__users</span><span style="color:#D73A49;--shiki-dark:#F97583"> ALTER</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN id </span><span style="color:#D73A49;--shiki-dark:#F97583">SET</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> nextval</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'__chart__users_id_seq'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::regclass</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> public</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">__chart_day__active_users</span><span style="color:#D73A49;--shiki-dark:#F97583"> ALTER</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN id </span><span style="color:#D73A49;--shiki-dark:#F97583">SET</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> nextval</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'__chart_day__active_users_id_seq'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::regclass</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> public</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">__chart_day__ap_request</span><span style="color:#D73A49;--shiki-dark:#F97583"> ALTER</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN id </span><span style="color:#D73A49;--shiki-dark:#F97583">SET</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> nextval</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'__chart_day__ap_request_id_seq'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::regclass</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> public</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">__chart_day__drive</span><span style="color:#D73A49;--shiki-dark:#F97583"> ALTER</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN id </span><span style="color:#D73A49;--shiki-dark:#F97583">SET</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> nextval</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'__chart_day__drive_id_seq'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::regclass</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> public</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">__chart_day__federation</span><span style="color:#D73A49;--shiki-dark:#F97583"> ALTER</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN id </span><span style="color:#D73A49;--shiki-dark:#F97583">SET</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> nextval</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'__chart_day__federation_id_seq'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::regclass</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> public</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">__chart_day__hashtag</span><span style="color:#D73A49;--shiki-dark:#F97583"> ALTER</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN id </span><span style="color:#D73A49;--shiki-dark:#F97583">SET</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> nextval</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'__chart_day__hashtag_id_seq'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::regclass</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> public</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">__chart_day__instance</span><span style="color:#D73A49;--shiki-dark:#F97583"> ALTER</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN id </span><span style="color:#D73A49;--shiki-dark:#F97583">SET</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> nextval</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'__chart_day__instance_id_seq'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::regclass</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> public</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">__chart_day__network</span><span style="color:#D73A49;--shiki-dark:#F97583"> ALTER</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN id </span><span style="color:#D73A49;--shiki-dark:#F97583">SET</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> nextval</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'__chart_day__network_id_seq'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::regclass</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> public</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">__chart_day__notes</span><span style="color:#D73A49;--shiki-dark:#F97583"> ALTER</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN id </span><span style="color:#D73A49;--shiki-dark:#F97583">SET</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> nextval</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'__chart_day__notes_id_seq'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::regclass</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> public</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">__chart_day__per_user_drive</span><span style="color:#D73A49;--shiki-dark:#F97583"> ALTER</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN id </span><span style="color:#D73A49;--shiki-dark:#F97583">SET</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> nextval</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'__chart_day__per_user_drive_id_seq'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::regclass</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> public</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">__chart_day__per_user_following</span><span style="color:#D73A49;--shiki-dark:#F97583"> ALTER</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN id </span><span style="color:#D73A49;--shiki-dark:#F97583">SET</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> nextval</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'__chart_day__per_user_following_id_seq'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::regclass</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> public</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">__chart_day__per_user_notes</span><span style="color:#D73A49;--shiki-dark:#F97583"> ALTER</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN id </span><span style="color:#D73A49;--shiki-dark:#F97583">SET</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> nextval</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'__chart_day__per_user_notes_id_seq'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::regclass</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> public</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">__chart_day__per_user_pv</span><span style="color:#D73A49;--shiki-dark:#F97583"> ALTER</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN id </span><span style="color:#D73A49;--shiki-dark:#F97583">SET</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> nextval</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'__chart_day__per_user_pv_id_seq'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::regclass</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> public</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">__chart_day__per_user_reaction</span><span style="color:#D73A49;--shiki-dark:#F97583"> ALTER</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN id </span><span style="color:#D73A49;--shiki-dark:#F97583">SET</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> nextval</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'__chart_day__per_user_reaction_id_seq'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::regclass</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ALTER</span><span style="color:#D73A49;--shiki-dark:#F97583"> TABLE</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> public</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">__chart_day__users</span><span style="color:#D73A49;--shiki-dark:#F97583"> ALTER</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> COLUMN id </span><span style="color:#D73A49;--shiki-dark:#F97583">SET</span><span style="color:#D73A49;--shiki-dark:#F97583"> DEFAULT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> nextval</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'__chart_day__users_id_seq'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::regclass</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span></code></pre>
<p lang="zh">为所有的表格重新设置预设。
如果没有错误提示，则可以 <code>COMMIT;</code> 提交这些更改。等待一天，帖子数和用户数就会重新显示了。</p>
<p><img  loading="lazy" decoding="async" fetchpriority="auto" width="742" height="186" src="/_astro/stats_example_20240908031653.DuAqxcdv_1lQcwn.webp" ></p> </div>
    <div class="divider"></div>
    <p class="post-meta flex flex-wrap items-center gap-2 text-base-content/60"> <span class="date flex gap-1 items-center shrink-0 text-sm"> <svg width="1em" height="1em" data-icon="mingcute:calendar-2-line">   <symbol id="ai:mingcute:calendar-2-line" viewBox="0 0 24 24"><g fill="none" fill-rule="evenodd"><path d="m12.594 23.258l-.012.002l-.071.035l-.02.004l-.014-.004l-.071-.036q-.016-.004-.024.006l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.016-.018m.264-.113l-.014.002l-.184.093l-.01.01l-.003.011l.018.43l.005.012l.008.008l.201.092q.019.005.029-.008l.004-.014l-.034-.614q-.005-.019-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.003-.011l.018-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M16 3a1 1 0 0 1 1 1v1h2a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h2V4a1 1 0 0 1 2 0v1h6V4a1 1 0 0 1 1-1M8 7H5v2h14V7h-3zm-3 4v8h14v-8zm2 2a1 1 0 0 1 1-1h.01a1 1 0 1 1 0 2H8a1 1 0 0 1-1-1m1 2a1 1 0 1 0 0 2h.01a1 1 0 1 0 0-2zm3-2a1 1 0 0 1 1-1h.01a1 1 0 1 1 0 2H12a1 1 0 0 1-1-1m1 2a1 1 0 1 0 0 2h.01a1 1 0 1 0 0-2zm3-2a1 1 0 0 1 1-1h.01a1 1 0 1 1 0 2H16a1 1 0 0 1-1-1m1 2a1 1 0 1 0 0 2h.01a1 1 0 1 0 0-2z"/></g></symbol><use href="#ai:mingcute:calendar-2-line"></use>  </svg> <time datetime="2024-09-05T22:42:23.000Z"> 2024/09/05 </time> </span> <span class="flex flex-wrap max-w-full overflow-hidden text-ellipsis gap-2"> <a class="tag text-sm flex items-center gap-1 smooth-underline truncate" href="/tags/Fediverse/"> <svg width="1em" height="1em" class="shrink-0" data-icon="mingcute:tag-line">   <symbol id="ai:mingcute:tag-line" viewBox="0 0 24 24"><g fill="none" fill-rule="evenodd"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M10.537 2.164a3 3 0 0 1 2.244.727l.15.14l7.822 7.823a3 3 0 0 1 .135 4.098l-.135.144l-5.657 5.657a3 3 0 0 1-4.098.135l-.144-.135L3.03 12.93a3 3 0 0 1-.878-2.188l.011-.205l.472-5.185a3 3 0 0 1 2.537-2.695l.179-.021zm.308 1.989l-.127.003l-5.185.472a1 1 0 0 0-.888.787l-.017.118l-.472 5.185a1 1 0 0 0 .206.703l.083.095l7.823 7.823a1 1 0 0 0 1.32.083l.094-.083l5.657-5.657a1 1 0 0 0 .083-1.32l-.083-.094l-7.823-7.823a1 1 0 0 0-.671-.292M7.317 7.318a3 3 0 1 1 4.243 4.243a3 3 0 0 1-4.243-4.243m2.829 1.414a1 1 0 1 0-1.415 1.414a1 1 0 0 0 1.415-1.414"/></g></symbol><use href="#ai:mingcute:tag-line"></use>  </svg> <span class="truncate">Fediverse</span> </a><a class="tag text-sm flex items-center gap-1 smooth-underline truncate" href="/tags/Misskey/"> <svg width="1em" height="1em" viewBox="0 0 24 24" class="shrink-0" data-icon="mingcute:tag-line">   <use href="#ai:mingcute:tag-line"></use>  </svg> <span class="truncate">Misskey</span> </a><a class="tag text-sm flex items-center gap-1 smooth-underline truncate" href="/tags/Code/"> <svg width="1em" height="1em" viewBox="0 0 24 24" class="shrink-0" data-icon="mingcute:tag-line">   <use href="#ai:mingcute:tag-line"></use>  </svg> <span class="truncate">Code</span> </a><a class="tag text-sm flex items-center gap-1 smooth-underline truncate" href="/tags/Backend/"> <svg width="1em" height="1em" viewBox="0 0 24 24" class="shrink-0" data-icon="mingcute:tag-line">   <use href="#ai:mingcute:tag-line"></use>  </svg> <span class="truncate">Backend</span> </a> </span> </p>
    <div class="mt-8 border-t border-t-base-300 pt-4"><div class="comments-container"> <div id="gitalk-mainEl" data-uid="blog:sayonara-firefish"></div> </div> <script type="module" src="/_astro/GitalkComment.astro_astro_type_script_index_0_lang.C8Q7p-gl.js"></script> </div> </div> </article>  </main> <footer> <div class="text-center mb-4 markdown-body font-sans text-xs!"> <p>
&copy; 2026 Linca. All rights reserved.
</p> <p>
开业 <span id="BLOG_DAYS" data-first-date="1538918349000">2700</span> 天里，写下了 56 篇博客，2 篇页面，9 篇杂记，357221 字符。
</p> <p>
Powered by
<a href="https://astro.build" target="_blank" rel="noopener noreferrer">
Astro
</a>
and
<a href="https://github.com/Lhcfl/astro-theme-krypton2" target="_blank" rel="noopener noreferrer">
Krypton 2
</a>.
</p> </div> </footer> <script type="module">document.addEventListener("astro:page-load",()=>{const t=document.getElementById("BLOG_DAYS");if(t){const e=Date.now()-Number(t.dataset.firstDate),n=Math.floor(e/(1e3*60*60*24));t.textContent=n.toString()}});</script> </div> </div> <div class="sidebar__outer-container hidden print:hidden! grow-0 shrink max-w-70 has-sidebar:shrink-0 md:block md:relative md:has-sidebar:w-50 lg:shrink-0 lg:has-sidebar:w-70 animate-duration-300! animate-ease-in-out! xl:w-70 uno-e8c0g7"> <div class="sidebar__inner-container sticky top-0 bg-surface pt-6 md:px-0 md:h-screen max-md:show-toc:px-2 max-md:show-toc:pt-4 max-md:show-toc:border-t max-md:show-toc:border-base-300 overflow-y-auto overflow-x-visible">  <div class="hidden has-sidebar:block min-[55rem]:block"> <div id="page-toc"> <ul class="timeline w-full font-sans"> <li class="toc-item group flex items-center gap-2 transition text-base-content/60 [&#38;.active]:text-secondary [&#38;.active-now]:text-secondary+30 px-2 py-1 hover:bg-secondary/10 hover:text-secondary" data-slug="goodbye-firefish"> <a href="#goodbye-firefish" class="flex items-center gap-1 w-full"> <div class="shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-0">Goodbye Firefish</span> </a> </li><li class="toc-item group flex items-center gap-2 transition text-base-content/60 [&#38;.active]:text-secondary [&#38;.active-now]:text-secondary+30 px-2 py-1 hover:bg-secondary/10 hover:text-secondary" data-slug="准备工作"> <a href="#准备工作" class="flex items-center gap-1 w-full"> <div class="shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-0">准备工作</span> </a> </li><li class="toc-item group flex items-center gap-2 transition text-base-content/60 [&#38;.active]:text-secondary [&#38;.active-now]:text-secondary+30 px-2 py-1 hover:bg-secondary/10 hover:text-secondary" data-slug="备份"> <a href="#备份" class="flex items-center gap-1 w-full"> <div class="shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-2">备份</span> </a> </li><li class="toc-item group flex items-center gap-2 transition text-base-content/60 [&#38;.active]:text-secondary [&#38;.active-now]:text-secondary+30 px-2 py-1 hover:bg-secondary/10 hover:text-secondary" data-slug="还原"> <a href="#还原" class="flex items-center gap-1 w-full"> <div class="shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-2">还原</span> </a> </li><li class="toc-item group flex items-center gap-2 transition text-base-content/60 [&#38;.active]:text-secondary [&#38;.active-now]:text-secondary+30 px-2 py-1 hover:bg-secondary/10 hover:text-secondary" data-slug="降级"> <a href="#降级" class="flex items-center gap-1 w-full"> <div class="shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-0">降级</span> </a> </li><li class="toc-item group flex items-center gap-2 transition text-base-content/60 [&#38;.active]:text-secondary [&#38;.active-now]:text-secondary+30 px-2 py-1 hover:bg-secondary/10 hover:text-secondary" data-slug="安装-sharkey-仓库"> <a href="#安装-sharkey-仓库" class="flex items-center gap-1 w-full"> <div class="shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-2">安装 Sharkey 仓库</span> </a> </li><li class="toc-item group flex items-center gap-2 transition text-base-content/60 [&#38;.active]:text-secondary [&#38;.active-now]:text-secondary+30 px-2 py-1 hover:bg-secondary/10 hover:text-secondary" data-slug="附录权限错误与解决方法"> <a href="#附录权限错误与解决方法" class="flex items-center gap-1 w-full"> <div class="shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-0">附录：权限错误与解决方法</span> </a> </li><li class="toc-item group flex items-center gap-2 transition text-base-content/60 [&#38;.active]:text-secondary [&#38;.active-now]:text-secondary+30 px-2 py-1 hover:bg-secondary/10 hover:text-secondary" data-slug="error-对表-xxx-权限不够"> <a href="#error-对表-xxx-权限不够" class="flex items-center gap-1 w-full"> <div class="shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-2">error: 对表 xxx 权限不够</span> </a> </li><li class="toc-item group flex items-center gap-2 transition text-base-content/60 [&#38;.active]:text-secondary [&#38;.active-now]:text-secondary+30 px-2 py-1 hover:bg-secondary/10 hover:text-secondary" data-slug="必须是类型-notification_type_enum-的属主"> <a href="#必须是类型-notification_type_enum-的属主" class="flex items-center gap-1 w-full"> <div class="shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-2">必须是类型 notification_type_enum 的属主</span> </a> </li><li class="toc-item group flex items-center gap-2 transition text-base-content/60 [&#38;.active]:text-secondary [&#38;.active-now]:text-secondary+30 px-2 py-1 hover:bg-secondary/10 hover:text-secondary" data-slug="附录作者修订"> <a href="#附录作者修订" class="flex items-center gap-1 w-full"> <div class="shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-0">附录：作者修订</span> </a> </li><li class="toc-item group flex items-center gap-2 transition text-base-content/60 [&#38;.active]:text-secondary [&#38;.active-now]:text-secondary+30 px-2 py-1 hover:bg-secondary/10 hover:text-secondary" data-slug="用户数和帖子数一直显示-0"> <a href="#用户数和帖子数一直显示-0" class="flex items-center gap-1 w-full"> <div class="shrink-0 i-mingcute-add-circle-line group-[.active]:i-mingcute-check-circle-fill group-[.active-now]:i-mingcute-arrow-right-circle-fill"></div> <span class="ml-2">用户数和帖子数一直显示 0</span> </a> </li> </ul> </div> <script type="module">function c(i,l){let t=null,e=!1;function o(...s){e?t=s:(i.apply(this,s),e=!0,setTimeout(()=>{e=!1,t&&(o.apply(this,t),t=null)},l))}return o}function n(i){const l=document.getElementById("page-toc");if(!l)return;const t=l.querySelectorAll("li");if(t.forEach(e=>e.classList.remove("active","active-now")),i!=null)for(const e of t){if(e.dataset.slug===i){e.classList.add("active-now");break}e.classList.add("active")}}const r=c(()=>{const i=document.querySelector(".markdown-body.is-detailed");if(!i)return;const l=Array.from(i.querySelectorAll("h1,h2,h3,h4,h5,h6").values()),t=l.findIndex(e=>e.getBoundingClientRect().y>110);t===0?n(null):t==-1?n(l.at(-1)?.id):n(l.at(t-1)?.id)},200);document.addEventListener("scroll",r);</script> </div> </div> </div>  </div> <div class="float-buttons fixed bottom-4 right-4 flex flex-col gap-2 print:hidden! text-base-content" aria-hidden="true"> <div class="opacity-0 translate-x-20 transition [body.is-scrolled_&]:opacity-100 [body.is-scrolled_&]:translate-x-0"> <button onclick="window.scrollTo({ top: 0, behavior: 'smooth' })" class="rounded-full p-4 text-lg md:text-xl bg-surface border-base-300 border" aria-label="Scroll to top"> <div class="i-mingcute:arrow-up-line"></div> </button> </div> <div class="hidden has-sidebar:block md:hidden!"> <button onclick="document.body.classList.add('show-toc')" class="rounded-full p-4 text-lg md:text-xl bg-surface border-base-300 border" aria-label="Show TOC"> <div class="i-mingcute:list-check-fill"></div> </button> </div> </div> <script type="module">document.addEventListener("scroll",()=>{window.scrollY>100?document.body.classList.add("is-scrolled"):document.body.classList.remove("is-scrolled")});document.addEventListener("click",s=>{if(!document.body.classList.contains("show-toc"))return;let t=s.target;for(;t!=null;){if(t.classList.contains("float-buttons")||t.classList.contains("sidebar__inner-container"))return;t=t.parentElement}document.body.classList.remove("show-toc"),document.body.classList.add("removing-toc"),setTimeout(()=>{document.body.classList.remove("removing-toc")},280),s.stopPropagation()});</script> </body></html>