<!DOCTYPE html><html lang="zh-CN"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/webp" href="/_astro/logo.zcK9pHo2_2eS7vq.webp"><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/rss+xml" title="Zero Calorie Drink Shop" href="https://lhcfl.github.io/rss.xml"><meta name="generator" content="Astro v5.10.0"><!-- Font --><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://chinese-fonts-cdn.deno.dev"><link rel="preconnect" href="https://ik.imagekit.io" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://lhcfl.github.io/blog/gleam-intro/"><!-- Primary Meta Tags --><title>仿生电子锈会梦到自己变成纯函数式吗：gleam 语言初见 ⬝ Zero Calorie Drink Shop</title><meta name="title" content="仿生电子锈会梦到自己变成纯函数式吗：gleam 语言初见 ⬝ Zero Calorie Drink Shop"><meta name="description" content="Gleam is a friendly language for building type-safe systems that scale! —— https://gleam.run/
虽然我倒不觉得纯函数式语言能有多 friendly……
"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://lhcfl.github.io/blog/gleam-intro/"><meta property="og:title" content="仿生电子锈会梦到自己变成纯函数式吗：gleam 语言初见 ⬝ Zero Calorie Drink Shop"><meta property="og:description" content="Gleam is a friendly language for building type-safe systems that scale! —— https://gleam.run/
虽然我倒不觉得纯函数式语言能有多 friendly……
"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://lhcfl.github.io/blog/gleam-intro/"><meta property="twitter:title" content="仿生电子锈会梦到自己变成纯函数式吗：gleam 语言初见 ⬝ Zero Calorie Drink Shop"><meta property="twitter:description" content="Gleam is a friendly language for building type-safe systems that scale! —— https://gleam.run/
虽然我倒不觉得纯函数式语言能有多 friendly……
"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.AM2StPgK.js"></script><link rel="stylesheet" href="/_astro/_static_page_.DYt1UbNe.css">
<link rel="stylesheet" href="/_astro/_static_page_.DST4ihUU.css">
<link rel="stylesheet" href="/_astro/_static_page_.CGWgwbcx.css">
<style>@reference "../styles/tailwind.css";.items[data-astro-cid-qtyrxm4s]{display:flex;flex-wrap:wrap;gap:calc(var(--spacing) * 2);max-width:100%;text-overflow:ellipsis;overflow:hidden}.item[data-astro-cid-qtyrxm4s]{font-size:var(--text-sm-fontSize);line-height:var(--un-leading, var(--text-sm-lineHeight));display:flex;gap:calc(var(--spacing) * 1);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;align-items:center;position:relative}.item[data-astro-cid-qtyrxm4s]:after{background-color:color-mix(in srgb,var(--colors-primary) 50%,transparent);width:100%;height:.15em;--un-scale-x:0%;--un-scale-y:0%;scale:var(--un-scale-x) var(--un-scale-y);transition-property:all;transition-timing-function:var(--un-ease, var(--default-transition-timingFunction));transition-duration:var(--un-duration, var(--default-transition-duration));left:calc(var(--spacing) * 0);bottom:calc(var(--spacing) * 0);position:absolute;content:""}@supports (color: color-mix(in lab,red,red)){.item[data-astro-cid-qtyrxm4s]:after{background-color:color-mix(in oklab,var(--colors-primary) 50%,transparent)}}@property --un-bg-opacity{syntax:"<percentage>";inherits:false;initial-value:100%;}.item[data-astro-cid-qtyrxm4s]:hover:after{--un-scale-x:100%;--un-scale-y:100%;scale:var(--un-scale-x) var(--un-scale-y)}@property --un-scale-x{syntax:"*";inherits:false;initial-value:1;syntax:"*";inherits:false;initial-value:1;}@property --un-scale-y{syntax:"*";inherits:false;initial-value:1;syntax:"*";inherits:false;initial-value:1;}@property --un-scale-z{syntax:"*";inherits:false;initial-value:1;syntax:"*";inherits:false;initial-value:1;}
</style><script type="module" src="/_astro/page.sN3tJsal.js"></script></head> <body class="overflow-y-scroll"> <div class="app bg-surface text-content md:flex lg:justify-center max-w-full">  <header class="print:hidden flex sticky top-0 flex-[0_0_auto]" un-max-md="items-center justify-between w-full h-15 z-50 bg-surface px-2" un-max-lg="w-20" un-lg="w-70" un-md="flex-col h-screen text-lg p-4 flex-shrink-0 flex-grow-0" un-border="max-md:b md:r  base-300"> <a href="/" class="flex flex-col items-center gap-2 lg:mt-4"> <div class="nav-site-avatar avatar w-10 md:w-12 lg:hidden"> <img src="/_astro/logo.zcK9pHo2_2eS7vq.webp" alt="Zero Calorie Drink Shop" loading="eager" decoding="async" fetchpriority="auto" width="100" height="100"> </div> <div class="nav-site-avatar avatar max-lg:hidden w-40"> <img src="/_astro/logo.zcK9pHo2_16JEEU.webp" alt="Zero Calorie Drink Shop" loading="eager" decoding="async" fetchpriority="auto" width="512" height="512"> </div> <span class="nav-site-title text-lg font-bold max-lg:hidden">Zero Calorie Drink Shop</span> </a> <nav class="links flex items-center gap-2 text-lg" un-md="flex-col pt-6 text-2xl" un-lg="text-base"> <a href="/" role="button" class="header-link flex items-center justify-center gap-1 transition md:h-10 md:w-full md:hover:bg-primary/10 md:hover:text-primary" aria-label="Home" data-path-name="blog/gleam-intro/" data-href-base="/"> <svg width="1em" height="1em" data-icon="mingcute:home-3-line">   <symbol id="ai:mingcute:home-3-line" viewBox="0 0 24 24"><g fill="none"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M10.772 2.688a2 2 0 0 1 2.317-.099l.139.1l8.384 6.52c.721.561.37 1.692-.499 1.785l-.116.006H20v8a2 2 0 0 1-1.85 1.995L18 21H6a2 2 0 0 1-1.994-1.85L4 19v-8h-.997C2.09 11 1.671 9.892 2.3 9.285l.088-.076zM12 4.267L5.625 9.225c.229.185.375.468.375.785V19h3v-5a3 3 0 1 1 6 0v5h3v-8.99c0-.317.146-.6.375-.785zM12 13a1 1 0 0 0-1 1v5h2v-5a1 1 0 0 0-1-1"/></g></symbol><use href="#ai:mingcute:home-3-line"></use>  </svg> <span class="max-lg:hidden"> Home </span> </a><a href="/archives" role="button" class="header-link flex items-center justify-center gap-1 transition md:h-10 md:w-full md:hover:bg-primary/10 md:hover:text-primary" aria-label="Archives" data-path-name="blog/gleam-intro/" data-href-base="archives"> <svg width="1em" height="1em" data-icon="mingcute:archive-line">   <symbol id="ai:mingcute:archive-line" viewBox="0 0 24 24"><g fill="none" fill-rule="evenodd"><path d="m12.594 23.258l-.012.002l-.071.035l-.02.004l-.014-.004l-.071-.036q-.016-.004-.024.006l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.016-.018m.264-.113l-.014.002l-.184.093l-.01.01l-.003.011l.018.43l.005.012l.008.008l.201.092q.019.005.029-.008l.004-.014l-.034-.614q-.005-.019-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.003-.011l.018-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M16.586 3A2 2 0 0 1 18 3.586L20.414 6A2 2 0 0 1 21 7.414V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7.414A2 2 0 0 1 3.586 6L6 3.586A2 2 0 0 1 7.414 3zM19 9H5v10h14zm-7 1a1 1 0 0 1 1 1v3.186l.414-.414a1 1 0 1 1 1.414 1.414l-2.12 2.121a1 1 0 0 1-1.415 0l-2.121-2.121a1 1 0 1 1 1.414-1.414l.414.414V11a1 1 0 0 1 1-1m4.586-5H7.414l-2 2h13.172z"/></g></symbol><use href="#ai:mingcute:archive-line"></use>  </svg> <span class="max-lg:hidden"> Archives </span> </a><a href="/notes/1" role="button" class="header-link flex items-center justify-center gap-1 transition md:h-10 md:w-full md:hover:bg-primary/10 md:hover:text-primary" aria-label="Notes" data-path-name="blog/gleam-intro/" data-href-base="notes"> <svg width="1em" height="1em" data-icon="mingcute:notebook-line">   <symbol id="ai:mingcute:notebook-line" viewBox="0 0 24 24"><g fill="none"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M17 2c1.598 0 3 1.3 3 3v13c0 1.7-1.4 3-3 3H6c-1.054 0-2-.95-2-2V4c0-1.054.95-2 2-2zm0 2h-7v15h7c.513 0 1-.39 1-1V5c0-.513-.49-1-1-1M8 4H6v15h2z"/></g></symbol><use href="#ai:mingcute:notebook-line"></use>  </svg> <span class="max-lg:hidden"> Notes </span> </a><a href="/tags" role="button" class="header-link flex items-center justify-center gap-1 transition md:h-10 md:w-full md:hover:bg-primary/10 md:hover:text-primary" aria-label="Tags" data-path-name="blog/gleam-intro/" data-href-base="tags"> <svg width="1em" height="1em" data-icon="mingcute:tag-2-line">   <symbol id="ai:mingcute:tag-2-line" viewBox="0 0 24 24"><g fill="none"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M10.238 4.827a3 3 0 0 1 2.122.878l6.485 6.486a3 3 0 0 1 0 4.242l-4.243 4.243a3 3 0 0 1-4.242 0l-6.486-6.485a3 3 0 0 1-.878-2.122V7.327a2.5 2.5 0 0 1 2.5-2.5zm0 2H5.496a.5.5 0 0 0-.5.5v4.742a1 1 0 0 0 .292.707l6.486 6.486a1 1 0 0 0 1.414 0l4.243-4.243a1 1 0 0 0 0-1.414L10.945 7.12a1 1 0 0 0-.707-.293M7.531 9.362a1.5 1.5 0 1 1 2.121 2.122a1.5 1.5 0 0 1-2.121-2.122M11.652 2a3 3 0 0 1 2.122.878l7.192 7.193a1 1 0 0 1-1.414 1.414L12.36 4.29a1 1 0 0 0-.708-.29H7a1 1 0 0 1 0-2z"/></g></symbol><use href="#ai:mingcute:tag-2-line"></use>  </svg> <span class="max-lg:hidden"> Tags </span> </a><a href="/about" role="button" class="header-link flex items-center justify-center gap-1 transition md:h-10 md:w-full md:hover:bg-primary/10 md:hover:text-primary" aria-label="About" data-path-name="blog/gleam-intro/" data-href-base="about"> <svg width="1em" height="1em" data-icon="mingcute:user-3-line">   <symbol id="ai:mingcute:user-3-line" viewBox="0 0 24 24"><g fill="none" fill-rule="evenodd"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M12 13c2.396 0 4.575.694 6.178 1.672c.8.488 1.484 1.064 1.978 1.69c.486.615.844 1.351.844 2.138c0 .845-.411 1.511-1.003 1.986c-.56.45-1.299.748-2.084.956c-1.578.417-3.684.558-5.913.558s-4.335-.14-5.913-.558c-.785-.208-1.524-.506-2.084-.956C3.41 20.01 3 19.345 3 18.5c0-.787.358-1.523.844-2.139c.494-.625 1.177-1.2 1.978-1.69C7.425 13.695 9.605 13 12 13m0 2c-2.023 0-3.843.59-5.136 1.379c-.647.394-1.135.822-1.45 1.222c-.324.41-.414.72-.414.899c0 .122.037.251.255.426c.249.2.682.407 1.344.582C7.917 19.858 9.811 20 12 20c2.19 0 4.083-.143 5.4-.492c.663-.175 1.096-.382 1.345-.582c.218-.175.255-.304.255-.426c0-.18-.09-.489-.413-.899c-.316-.4-.804-.828-1.451-1.222C15.843 15.589 14.023 15 12 15m0-13a5 5 0 1 1 0 10a5 5 0 0 1 0-10m0 2a3 3 0 1 0 0 6a3 3 0 0 0 0-6"/></g></symbol><use href="#ai:mingcute:user-3-line"></use>  </svg> <span class="max-lg:hidden"> About </span> </a><a href="/links" role="button" class="header-link flex items-center justify-center gap-1 transition md:h-10 md:w-full md:hover:bg-primary/10 md:hover:text-primary" aria-label="Links" data-path-name="blog/gleam-intro/" data-href-base="links"> <svg width="1em" height="1em" data-icon="mingcute:link-3-line">   <symbol id="ai:mingcute:link-3-line" viewBox="0 0 24 24"><g fill="none" fill-rule="evenodd"><path d="m12.594 23.258l-.012.002l-.071.035l-.02.004l-.014-.004l-.071-.036q-.016-.004-.024.006l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.016-.018m.264-.113l-.014.002l-.184.093l-.01.01l-.003.011l.018.43l.005.012l.008.008l.201.092q.019.005.029-.008l.004-.014l-.034-.614q-.005-.019-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.003-.011l.018-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M1 10a5 5 0 0 1 5-5h6a5 5 0 0 1 0 10a1 1 0 1 1 0-2a3 3 0 1 0 0-6H6a3 3 0 0 0-.75 5.906a1 1 0 0 1-.5 1.936A5 5 0 0 1 1 10m11 1a3 3 0 1 0 0 6h6a3 3 0 0 0 .75-5.905a1 1 0 0 1 .5-1.937A5.002 5.002 0 0 1 18 19h-6a5 5 0 0 1 0-10a1 1 0 1 1 0 2"/></g></symbol><use href="#ai:mingcute:link-3-line"></use>  </svg> <span class="max-lg:hidden"> Links </span> </a><a href="/search" role="button" class="header-link flex items-center justify-center gap-1 transition md:h-10 md:w-full md:hover:bg-primary/10 md:hover:text-primary" aria-label="Search" data-path-name="blog/gleam-intro/" data-href-base="search"> <svg width="1em" height="1em" data-icon="mingcute:search-3-line">   <symbol id="ai:mingcute:search-3-line" viewBox="0 0 24 24"><g fill="none" fill-rule="evenodd"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M10.5 4a6.5 6.5 0 1 0 0 13a6.5 6.5 0 0 0 0-13M2 10.5a8.5 8.5 0 1 1 15.176 5.262l3.652 3.652a1 1 0 0 1-1.414 1.414l-3.652-3.652A8.5 8.5 0 0 1 2 10.5M9.5 7a1 1 0 0 1 1-1a4.5 4.5 0 0 1 4.5 4.5a1 1 0 1 1-2 0A2.5 2.5 0 0 0 10.5 8a1 1 0 0 1-1-1"/></g></symbol><use href="#ai:mingcute:search-3-line"></use>  </svg> <span class="max-lg:hidden"> Search </span> </a> </nav> <div class="navbar-end" un-md="flex-grow flex items-baseline-last justify-center"> <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();</script><script>(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t),11:t=>1/0*t},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="18tXJb" component-url="/_astro/DarkLightToggle.6qHju4aH.js" component-export="default" renderer-url="/_astro/client.svelte.DMhakGtm.js" props="{}" ssr client="load" opts="{&quot;name&quot;:&quot;DarkLightToggle&quot;,&quot;value&quot;:true}" await-children><!--[--><button class="i-mingcute:moon-stars-line" aria-label="toggle theme"></button><!--]--><!--astro:end--></astro-island> </div> </header> <div class="main-and-footer__outer-container
        max-w-full min-h-screen overflow-x-hidden
        flex flex-grow flex-shrink flex-basis-200 xl:flex-grow-0 at-md:justify-center"> <div class="flex flex-col w-full max-w-200"> <main class="flex-grow relative p-4 md:pt-6 undefined">  <article> <h1 class="page-title text-3xl font-bold">  <span>仿生电子锈会梦到自己变成纯函数式吗：gleam 语言初见</span>  </h1> <div> <div class="markdown-body is-detailed"> <p><em>Gleam is a friendly language for building type-safe systems that scale!</em> —— <a href="https://gleam.run/">https://gleam.run/</a></p>
<p lang="zh">虽然我倒不觉得纯函数式语言能有多 friendly……</p>
<!-- more -->
<p lang="zh">事情的起因是刷到知乎提问如何评价 gleam 语言，然后有人说在 rust 和 go 之间应该有一门中间态的语言 balabala</p>
<p lang="zh">于是就跑过去看了，最开始看语法如此像 rust，再加上安利的描述，还以为是 GC 的过程式语言加点函数式糖，直到看到 Gleam is an immutable language 才发现啊被骗了怎么是纯函数式（）</p>
<p lang="xh">先来看看 hello world：</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="gleam"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> gleam</span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#24292E;--shiki-dark:#E1E4E8">io</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">pub</span><span style="color:#D73A49;--shiki-dark:#F97583"> fn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> main</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  io.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">println</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Hello, world!"</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span></code></pre>
<p>非常好懂（点头</p>
<h3 id="immutable">Immutable</h3>
<p lang="zh">虽然 immutable 比过程式语言通常写起来更容易遇到一些不得不搞一些奇怪的递归函数的情况，但是也是一个不错的选择。</p>
<p lang="zh">Gleam 会编译到 Erlang（可以编译到 js，但是因为语言特性很容易爆递归），听说过 Erlang 的人大概都知道这个传闻：写 Erlang/Elixir 的人习以为常地开几万甚至几十万个进程<sup><a href="#user-content-fn-elixir%20%E7%9A%84%E8%BF%9B%E7%A8%8B%E6%98%AF%20erlang%20%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%8F%90%E4%BE%9B%E7%9A%84%E2%80%9C%E8%BD%BB%E9%87%8F%E7%BA%A7%E2%80%9D%E8%BF%9B%E7%A8%8B%EF%BC%8C%E7%94%9A%E8%87%B3%E6%AF%94%E4%B8%80%E8%88%AC%E8%AF%AD%E8%A8%80%E7%9A%84%E7%BA%BF%E7%A8%8B%E8%BF%98%E8%BD%BB%E9%87%8F" id="user-content-fnref-elixir%20%E7%9A%84%E8%BF%9B%E7%A8%8B%E6%98%AF%20erlang%20%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%8F%90%E4%BE%9B%E7%9A%84%E2%80%9C%E8%BD%BB%E9%87%8F%E7%BA%A7%E2%80%9D%E8%BF%9B%E7%A8%8B%EF%BC%8C%E7%94%9A%E8%87%B3%E6%AF%94%E4%B8%80%E8%88%AC%E8%AF%AD%E8%A8%80%E7%9A%84%E7%BA%BF%E7%A8%8B%E8%BF%98%E8%BD%BB%E9%87%8F" data-footnote-ref="" aria-describedby="footnote-label">1</a></sup>，这也是得益于 immutable 的特性让并发操作变得非常简单好写</p>
<p lang="zh">对于 mutable 的语言，需要担忧一块内存空间被并发地同时读和写，进而引出了一堆的互斥锁/原子操作之类的概念，而 immutable 根本不需要担心这个问题，因为你根本没有编写“覆写”一块内存区域的代码，（虽然 Erlang 虚拟机可能会优化这个操作，从而实际上覆写），所有的变量都是只读的。</p>
<p lang="zh">这也是大多数 immutable 函数式语言共享的优势，许多纯函数连状态都没有，自然也就不存在状态不一致的问题。对于函数式而言并发、scale 都是天然的事情。</p>
<h3 id="pipeline">Pipeline</h3>
<p lang="tk">Gleam 支持 pipeline 操作</p>
<p lang="zh">我是链式调用狂热粉丝（？）所以非常需要这个！对我来说一个语言能吸引我的一个重要的 sugar 就是类似 pipeline 的机制 i.e.</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="haskell"><code><span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">|</span><span style="color:#6F42C1;--shiki-dark:#B392F0">></span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">a </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> b</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> b</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">x </span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> f </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> f x</span></span></code></pre>
<p lang="zh">这意味着任何一个 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo>:</mo><mi>a</mi><mo>→</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">f: a \to b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span> 都能 pipeline 一个 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span> 进去得到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span>，非常好用，因为很多现实世界的操作本来就是串联起来的</p>
<p lang="zh">比如你可以在 gleam 中写这样的：</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="gleam"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> gleam</span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#24292E;--shiki-dark:#E1E4E8">io</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> gleam</span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#24292E;--shiki-dark:#E1E4E8">string</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">pub</span><span style="color:#D73A49;--shiki-dark:#F97583"> fn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> main</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // Without the pipe operator</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  io.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">debug</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">string.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">drop_start</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">string.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">drop_end</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Hello, Joe!"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">7</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#6A737D;--shiki-dark:#6A737D">// "Joe"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // With the pipe operator</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">  "Hello, Mike!"</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  |</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> string.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">drop_end</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  |</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> string.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">drop_start</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">7</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  |</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> io.debug </span><span style="color:#6A737D;--shiki-dark:#6A737D">// "Mike"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // Changing order with function capturing</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">  "1"</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  |</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> string.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">append</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"2"</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  |</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> string.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">append</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"3"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6A737D;--shiki-dark:#6A737D">_</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  |</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> io.debug  </span><span style="color:#6A737D;--shiki-dark:#6A737D">// "312"</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span></code></pre>
<p lang="zh">中缀表示法 <code>a f b</code> 就是比前缀表示法 <code>f a b</code> 在链式调用下好看多了！这或许是一种比 Ruby 的 Open Class 更好的方案来给对象添加“成员函数”，因为实际上成员函数就是一个 <code>fn(self, ...)</code></p>
<h3 id="pattern-matching">Pattern matching</h3>
<p lang="zh">说到函数式语言最重要的特色当然是 Pattern matching！</p>
<p lang="zh">Gleam 的 Pattern matching 基本上就是 rust 的形状，不过更强大，和大多数其它函数式语言一样可以匹配一些内置运算：</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="gleam"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> gleam</span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#24292E;--shiki-dark:#E1E4E8">io</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">pub</span><span style="color:#D73A49;--shiki-dark:#F97583"> fn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> main</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  io.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">debug</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">get_name</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Hello, Joe"</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">            </span><span style="color:#6A737D;--shiki-dark:#6A737D">// "Joe"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  io.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">debug</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">get_name</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Hello, Mike"</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">           </span><span style="color:#6A737D;--shiki-dark:#6A737D">// "Mike"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  io.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">debug</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">get_name</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"System still working?"</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#6A737D;--shiki-dark:#6A737D">// "Unknown"</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">fn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> get_name</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">x: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> String</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x </span><span style="color:#e36209;--shiki-dark:#ffab70">{</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "Hello, "</span><span style="color:#D73A49;--shiki-dark:#F97583"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> name </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> name</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    _</span><span style="color:#D73A49;--shiki-dark:#F97583"> -</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "Unknown"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  </span><span style="color:#e36209;--shiki-dark:#ffab70">}</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span></code></pre>
<p lang="nn">Gleam 也能写类似 Rust 的 <code>let</code>，但是 Gleam 不存在 <code>if</code> 所以没法写 <code>if let</code> 也没有 <code>let mut</code> 这些东西，let 就是一个纯的 irrefutable 的 pattern matching 而已。当然更多的时候可以用来给变量“赋值”（）</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="gleam"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> gleam</span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#24292E;--shiki-dark:#E1E4E8">io</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">pub</span><span style="color:#D73A49;--shiki-dark:#F97583"> type</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Teacher</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  Teacher</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">name: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">subject: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">pub</span><span style="color:#D73A49;--shiki-dark:#F97583"> fn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> main</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> teacher </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Teacher</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Mr Schofield"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Physics"</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  let</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Teacher</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">tname, </span><span style="color:#6A737D;--shiki-dark:#6A737D">_</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> teacher</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  io.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">debug</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">tname</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#6A737D;--shiki-dark:#6A737D">// "Mr Schofield"</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span></code></pre>
<h3 id="只有递归">只有递归</h3>
<p lang="zh">和很多纯函数式语言一样，Gleam 没有循环结构只有递归，老实说我不觉得这很好，因为这让一些简单的事情变得更复杂……</p>
<p lang="zh">经典的 list 求 sum 可以写这样的函数</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="gleam"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">fn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> sum_list</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">list: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">List</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Int</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> list </span><span style="color:#e36209;--shiki-dark:#ffab70">{</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    </span><span style="color:#5a32a3;--shiki-dark:#b392f0">[</span><span style="color:#24292E;--shiki-dark:#E1E4E8">first, </span><span style="color:#D73A49;--shiki-dark:#F97583">..</span><span style="color:#24292E;--shiki-dark:#E1E4E8">rest</span><span style="color:#5a32a3;--shiki-dark:#b392f0">]</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> first </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> sum_list</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">rest</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    </span><span style="color:#5a32a3;--shiki-dark:#b392f0">[</span><span style="color:#5a32a3;--shiki-dark:#b392f0">]</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  </span><span style="color:#e36209;--shiki-dark:#ffab70">}</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span></code></pre>
<p lang="zh">有过函数式经验的人应该非常好理解，也就是每次取第一位递归地加末尾。写成 haskell 就是：</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="haskell"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">sumlist</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">[</span><span style="color:#D73A49;--shiki-dark:#F97583">Int</span><span style="color:#005cc5;--shiki-dark:#79b8ff">]</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#D73A49;--shiki-dark:#F97583"> Int</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">sumlist </span><span style="color:#005cc5;--shiki-dark:#79b8ff">[</span><span style="color:#005cc5;--shiki-dark:#79b8ff">]</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">sumlist </span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">x</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">xs</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> sumlist xs</span></span></code></pre>
<p lang="da">看上去 gleam 还更长一点，没有 haskell 的韵味 xd</p>
<h3 id="use-sugar">Use sugar</h3>
<p>比较喜欢的是 Gleam 的 use sugar，类似 Javascript 的 <code>async/await</code> 一样，负责简化嵌套层级。</p>
<blockquote>
<p lang="en">Gleam’s use expression helps out here by enabling us to write code that uses callbacks in an unindented style, as shown in the code window.
Gleam 的 use 表达式使我们能够编写以未缩进样式使用回调的代码，从而在此处提供帮助，如代码窗口中所示。</p>
<p lang="en">The higher order function being called goes on the right hand side of the &#x3C;- operator. It must take a callback function as its final argument.
被调用的高阶函数位于 &#x3C;- 运算符的右侧。它必须将回调函数作为其最终参数。</p>
<p lang="en">The argument names for the callback function go on the left hand side of the &#x3C;- operator. The function can take any number of arguments, including zero.
回调函数的参数名称位于 &#x3C;- 运算符的左侧。该函数可以接受任意数量的参数，包括零。</p>
<p lang="en">All the remaining code in the enclosing {} block becomes the body of the callback function.
封闭的 {} 块中的所有剩余代码都成为回调函数的主体。</p>
</blockquote>
<p>直接放官方示例：</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="gleam"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> gleam</span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#24292E;--shiki-dark:#E1E4E8">io</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> gleam</span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#24292E;--shiki-dark:#E1E4E8">result</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">pub</span><span style="color:#D73A49;--shiki-dark:#F97583"> fn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> main</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  let</span><span style="color:#6A737D;--shiki-dark:#6A737D"> _</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> io.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">debug</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">without_use</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  let</span><span style="color:#6A737D;--shiki-dark:#6A737D"> _</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> io.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">debug</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">with_use</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">pub</span><span style="color:#D73A49;--shiki-dark:#F97583"> fn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> without_use</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Result</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Nil</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  result.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">try</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">get_username</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">fn</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">username</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#5a32a3;--shiki-dark:#b392f0">{</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    result.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">try</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">get_password</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">fn</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">password</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#e36209;--shiki-dark:#ffab70">{</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      result.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">log_in</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">username, password</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">fn</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">greeting</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        greeting </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#032F62;--shiki-dark:#9ECBFF"> ", "</span><span style="color:#D73A49;--shiki-dark:#F97583"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> username</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      </span><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    </span><span style="color:#e36209;--shiki-dark:#ffab70">}</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  </span><span style="color:#5a32a3;--shiki-dark:#b392f0">}</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">pub</span><span style="color:#D73A49;--shiki-dark:#F97583"> fn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> with_use</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Result</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Nil</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  use</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> username </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">try</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">get_username</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  use</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> password </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">try</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">get_password</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  use</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> greeting </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">log_in</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">username, password</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  greeting </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#032F62;--shiki-dark:#9ECBFF"> ", "</span><span style="color:#D73A49;--shiki-dark:#F97583"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> username</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// Here are some pretend functions for this example:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">fn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> get_username</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Result</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Nil</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  Ok</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"alice"</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">fn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> get_password</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Result</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Nil</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  Ok</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"hunter2"</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">fn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> log_in</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#6A737D;--shiki-dark:#6A737D">_username</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6A737D;--shiki-dark:#6A737D">_password</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Result</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Nil</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  Ok</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Welcome"</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span></code></pre>
<p>这里其实 <code>use xxx &#x3C;- result.try(foo())</code> 翻译成 rust 就是 <code>foo</code> 会返回一个 <code>Result&#x3C;T, E></code>，然后</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> xxx </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> foo</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span></span></code></pre>
<p lang="zh">如果匹配到 <code>Err</code> 就直接返回了，否则再对 <code>Ok(T)</code> 做某种映射</p>
<h3 id="实战写个-json-parser">实战：写个 JSON Parser</h3>
<p lang="fr">其实本来是想在 rust 里写 json parser 的但是看到有这么像 rust 的 gleam 以后就干脆拿 gleam 了（</p>
<p lang="gl">由于 parse number 比较复杂这又是个玩具就不写 number parser 了</p>
<p lang="zh">首先定义节点的类型，长得很像 rust 的语法（整个语言都很像啊喂！）</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="gleam"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">pub</span><span style="color:#D73A49;--shiki-dark:#F97583"> type</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Node</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  Nul</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  Bol</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">val: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Bool</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  Num</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">val: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Int</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  Str</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">val: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  Arr</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">val: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">List</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Node</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  Obj</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">val: </span><span style="color:#24292E;--shiki-dark:#E1E4E8">dict.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Dict</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Node</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span></code></pre>
<p lang="zh">我们大致定义一个 parse 函数返回的成功类型可能长这样：</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="gleam"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">type</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ParseObjResult</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  ParseObjResult</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">result: </span><span style="color:#24292E;--shiki-dark:#E1E4E8">dict.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Dict</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Node</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">rest: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span></code></pre>
<p>result 是 parse 出来的内核，rest 是剩下的字符串，用来继续 parse：</p>
<p lang="zh">然后就能写出大概这样的 parser</p>
<p lang="zh">可以看到，<code>use</code> sugar 在简化层级上有多么必要，use 可以极大程度简化代码防止过多的层级嵌套</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="gleam"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">fn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> parse_obj</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">str: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Result</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ParseObjResult</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> str </span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> string.trim_start </span><span style="color:#e36209;--shiki-dark:#ffab70">{</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "}"</span><span style="color:#D73A49;--shiki-dark:#F97583"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> rest </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Ok</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ParseObjResult</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">dict.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">from_list</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#5a32a3;--shiki-dark:#b392f0">[</span><span style="color:#5a32a3;--shiki-dark:#b392f0">]</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, rest</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    x </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#5a32a3;--shiki-dark:#b392f0">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      use</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ParseStrResult</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">key, rest</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">then</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">parse_str</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">x</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      use</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> rest </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">then</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">parse_col</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">rest</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      use</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ParseNodeResult</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">node, rest</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">then</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">parse_node</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">rest</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> rest </span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> string.trim_start </span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> string.pop_grapheme </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        Ok</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">#</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">","</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, next</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          next</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">          |</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> string.trim_start</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">          |</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> parse_obj</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">          |</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#D73A49;--shiki-dark:#F97583">fn</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">res</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#5a32a3;--shiki-dark:#b392f0">{</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            ParseObjResult</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">res.result </span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> dict.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">insert</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">key, node</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, res.rest</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          </span><span style="color:#5a32a3;--shiki-dark:#b392f0">}</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        Ok</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">#</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"}"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, rest</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">          Ok</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ParseObjResult</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">dict.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">from_list</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#e36209;--shiki-dark:#ffab70">[</span><span style="color:#24292E;--shiki-dark:#E1E4E8">#</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">key, node</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">]</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, rest</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        Ok</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">#</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">x, </span><span style="color:#6A737D;--shiki-dark:#6A737D">_</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Error</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"unexpected token "</span><span style="color:#D73A49;--shiki-dark:#F97583"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        Error</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#6A737D;--shiki-dark:#6A737D">_</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Error</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"unexpected eof"</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      </span><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    </span><span style="color:#5a32a3;--shiki-dark:#b392f0">}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  </span><span style="color:#e36209;--shiki-dark:#ffab70">}</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">fn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> parse_node</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">str: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Result</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ParseNodeResult</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> str </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> str </span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> string.trim_start</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> str </span><span style="color:#e36209;--shiki-dark:#ffab70">{</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "null"</span><span style="color:#D73A49;--shiki-dark:#F97583"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> rest </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Ok</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ParseNodeResult</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Nul</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, rest</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "true"</span><span style="color:#D73A49;--shiki-dark:#F97583"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> rest </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Ok</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ParseNodeResult</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Bol</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">val: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">True</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, rest</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "false"</span><span style="color:#D73A49;--shiki-dark:#F97583"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> rest </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Ok</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ParseNodeResult</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Bol</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">val: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">False</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, rest</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#D73A49;--shiki-dark:#F97583"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6A737D;--shiki-dark:#6A737D"> _</span><span style="color:#D73A49;--shiki-dark:#F97583"> -</span><span style="color:#D73A49;--shiki-dark:#F97583">></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      parse_str</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">str</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      |</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#D73A49;--shiki-dark:#F97583">fn</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">res</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">ParseNodeResult</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Str</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">val: </span><span style="color:#24292E;--shiki-dark:#E1E4E8">res.result</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, res.rest</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "{"</span><span style="color:#D73A49;--shiki-dark:#F97583"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> rest </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      parse_obj</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">rest</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      |</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#D73A49;--shiki-dark:#F97583">fn</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">res</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">ParseNodeResult</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Obj</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">val: </span><span style="color:#24292E;--shiki-dark:#E1E4E8">res.result</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, res.rest</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "["</span><span style="color:#D73A49;--shiki-dark:#F97583"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> rest </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      parse_arr</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">rest</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      |</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#D73A49;--shiki-dark:#F97583">fn</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">res</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">ParseNodeResult</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Arr</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">val: </span><span style="color:#24292E;--shiki-dark:#E1E4E8">res.result</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, res.rest</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    x </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Error</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"unexpected token "</span><span style="color:#D73A49;--shiki-dark:#F97583"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  </span><span style="color:#e36209;--shiki-dark:#ffab70">}</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span></code></pre>
<details>
<summary>完整代码</summary>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="gleam"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> gleam</span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#24292E;--shiki-dark:#E1E4E8">dict</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> gleam</span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#24292E;--shiki-dark:#E1E4E8">io</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> gleam</span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#24292E;--shiki-dark:#E1E4E8">result</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> gleam</span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#24292E;--shiki-dark:#E1E4E8">string</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">pub</span><span style="color:#D73A49;--shiki-dark:#F97583"> type</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Node</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  Nul</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  Bol</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">val: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Bool</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  Num</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">val: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Int</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  Str</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">val: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  Arr</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">val: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">List</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Node</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  Obj</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">val: </span><span style="color:#24292E;--shiki-dark:#E1E4E8">dict.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Dict</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Node</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">type</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ParseNodeResult</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  ParseNodeResult</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">result: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Node</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">rest: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">type</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ParseStrResult</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  ParseStrResult</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">result: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">rest: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">type</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ParseListResult</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  ParseListResult</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">result: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">List</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Node</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">rest: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">type</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ParseObjResult</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  ParseObjResult</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">result: </span><span style="color:#24292E;--shiki-dark:#E1E4E8">dict.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Dict</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Node</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">rest: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">fn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> read_str</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">str: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Result</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ParseStrResult</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> str </span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> string.pop_grapheme </span><span style="color:#e36209;--shiki-dark:#ffab70">{</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    Error</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Nil</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Error</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Unexpected EOF"</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    Ok</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">#</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">first, rest</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> first </span><span style="color:#5a32a3;--shiki-dark:#b392f0">{</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">        "</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#D73A49;--shiki-dark:#F97583"> -</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Ok</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ParseStrResult</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">""</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, rest</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">        _</span><span style="color:#D73A49;--shiki-dark:#F97583"> -</span><span style="color:#D73A49;--shiki-dark:#F97583">></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">          read_str</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">rest</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">          |</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#D73A49;--shiki-dark:#F97583">fn</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">res</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#e36209;--shiki-dark:#ffab70">{</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            ParseStrResult</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">first </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> res.result, res.rest</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          </span><span style="color:#e36209;--shiki-dark:#ffab70">}</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      </span><span style="color:#5a32a3;--shiki-dark:#b392f0">}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  </span><span style="color:#e36209;--shiki-dark:#ffab70">}</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">fn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> parse_str</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">str: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Result</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ParseStrResult</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> str </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> str </span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> string.trim_start</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> str </span><span style="color:#e36209;--shiki-dark:#ffab70">{</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#D73A49;--shiki-dark:#F97583"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> content </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> read_str</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">content</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    x </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Error</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"unexpected token "</span><span style="color:#D73A49;--shiki-dark:#F97583"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  </span><span style="color:#e36209;--shiki-dark:#ffab70">}</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">fn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> parse_col</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">str: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Result</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> str </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> str </span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> string.trim_start</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> str </span><span style="color:#e36209;--shiki-dark:#ffab70">{</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    ":"</span><span style="color:#D73A49;--shiki-dark:#F97583"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> rest </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Ok</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">rest </span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> string.trim_start</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    x </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Error</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"unexpected token "</span><span style="color:#D73A49;--shiki-dark:#F97583"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  </span><span style="color:#e36209;--shiki-dark:#ffab70">}</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">fn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> parse_obj</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">str: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Result</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ParseObjResult</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> str </span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> string.trim_start </span><span style="color:#e36209;--shiki-dark:#ffab70">{</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "}"</span><span style="color:#D73A49;--shiki-dark:#F97583"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> rest </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Ok</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ParseObjResult</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">dict.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">from_list</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#5a32a3;--shiki-dark:#b392f0">[</span><span style="color:#5a32a3;--shiki-dark:#b392f0">]</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, rest</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    x </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#5a32a3;--shiki-dark:#b392f0">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      use</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ParseStrResult</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">key, rest</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">then</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">parse_str</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">x</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      use</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> rest </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">then</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">parse_col</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">rest</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      use</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ParseNodeResult</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">node, rest</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">then</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">parse_node</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">rest</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> rest </span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> string.trim_start </span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> string.pop_grapheme </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        Ok</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">#</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">","</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, next</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          next</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">          |</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> string.trim_start</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">          |</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> parse_obj</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">          |</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#D73A49;--shiki-dark:#F97583">fn</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">res</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#5a32a3;--shiki-dark:#b392f0">{</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            ParseObjResult</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">res.result </span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> dict.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">insert</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">key, node</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, res.rest</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          </span><span style="color:#5a32a3;--shiki-dark:#b392f0">}</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        Ok</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">#</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"}"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, rest</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">          Ok</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ParseObjResult</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">dict.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">from_list</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#e36209;--shiki-dark:#ffab70">[</span><span style="color:#24292E;--shiki-dark:#E1E4E8">#</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">key, node</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">]</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, rest</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        Ok</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">#</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">x, </span><span style="color:#6A737D;--shiki-dark:#6A737D">_</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Error</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"unexpected token "</span><span style="color:#D73A49;--shiki-dark:#F97583"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        Error</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#6A737D;--shiki-dark:#6A737D">_</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Error</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"unexpected eof"</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      </span><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    </span><span style="color:#5a32a3;--shiki-dark:#b392f0">}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  </span><span style="color:#e36209;--shiki-dark:#ffab70">}</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">fn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> parse_arr</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">str: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Result</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ParseListResult</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> str </span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> string.trim_start </span><span style="color:#e36209;--shiki-dark:#ffab70">{</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "]"</span><span style="color:#D73A49;--shiki-dark:#F97583"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> rest </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Ok</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ParseListResult</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#e36209;--shiki-dark:#ffab70">[</span><span style="color:#e36209;--shiki-dark:#ffab70">]</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, rest</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    x </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#5a32a3;--shiki-dark:#b392f0">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      use</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ParseNodeResult</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">node, rest</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">then</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">parse_node</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">x</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> rest </span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> string.trim_start </span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> string.pop_grapheme </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        Ok</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">#</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">","</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, next</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          next</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">          |</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> string.trim_start</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">          |</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> parse_arr</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">          |</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#D73A49;--shiki-dark:#F97583">fn</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">res</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#5a32a3;--shiki-dark:#b392f0">{</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            ParseListResult</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#e36209;--shiki-dark:#ffab70">[</span><span style="color:#24292E;--shiki-dark:#E1E4E8">node, </span><span style="color:#D73A49;--shiki-dark:#F97583">..</span><span style="color:#24292E;--shiki-dark:#E1E4E8">res.result</span><span style="color:#e36209;--shiki-dark:#ffab70">]</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, res.rest</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          </span><span style="color:#5a32a3;--shiki-dark:#b392f0">}</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        Ok</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">#</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"]"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, rest</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Ok</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ParseListResult</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#005cc5;--shiki-dark:#79b8ff">[</span><span style="color:#24292E;--shiki-dark:#E1E4E8">node</span><span style="color:#005cc5;--shiki-dark:#79b8ff">]</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, rest</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        Ok</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">#</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">x, </span><span style="color:#6A737D;--shiki-dark:#6A737D">_</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Error</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"unexpected token "</span><span style="color:#D73A49;--shiki-dark:#F97583"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        Error</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#6A737D;--shiki-dark:#6A737D">_</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Error</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"unexpected eof"</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      </span><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    </span><span style="color:#5a32a3;--shiki-dark:#b392f0">}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  </span><span style="color:#e36209;--shiki-dark:#ffab70">}</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">fn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> parse_node</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">str: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Result</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ParseNodeResult</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> str </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> str </span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> string.trim_start</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> str </span><span style="color:#e36209;--shiki-dark:#ffab70">{</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "null"</span><span style="color:#D73A49;--shiki-dark:#F97583"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> rest </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Ok</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ParseNodeResult</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Nul</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, rest</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "true"</span><span style="color:#D73A49;--shiki-dark:#F97583"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> rest </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Ok</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ParseNodeResult</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Bol</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">val: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">True</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, rest</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "false"</span><span style="color:#D73A49;--shiki-dark:#F97583"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> rest </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Ok</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ParseNodeResult</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Bol</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">val: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">False</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, rest</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#D73A49;--shiki-dark:#F97583"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6A737D;--shiki-dark:#6A737D"> _</span><span style="color:#D73A49;--shiki-dark:#F97583"> -</span><span style="color:#D73A49;--shiki-dark:#F97583">></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      parse_str</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">str</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      |</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#D73A49;--shiki-dark:#F97583">fn</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">res</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">ParseNodeResult</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Str</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">val: </span><span style="color:#24292E;--shiki-dark:#E1E4E8">res.result</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, res.rest</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "{"</span><span style="color:#D73A49;--shiki-dark:#F97583"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> rest </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      parse_obj</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">rest</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      |</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#D73A49;--shiki-dark:#F97583">fn</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">res</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">ParseNodeResult</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Obj</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">val: </span><span style="color:#24292E;--shiki-dark:#E1E4E8">res.result</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, res.rest</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "["</span><span style="color:#D73A49;--shiki-dark:#F97583"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> rest </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      parse_arr</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">rest</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      |</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#D73A49;--shiki-dark:#F97583">fn</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">res</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">ParseNodeResult</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Arr</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">val: </span><span style="color:#24292E;--shiki-dark:#E1E4E8">res.result</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, res.rest</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    x </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Error</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"unexpected token "</span><span style="color:#D73A49;--shiki-dark:#F97583"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  </span><span style="color:#e36209;--shiki-dark:#ffab70">}</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">pub</span><span style="color:#D73A49;--shiki-dark:#F97583"> fn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> parse_json</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">str: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Result</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Node</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  case</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> parse_node</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">str </span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> string.trim</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#e36209;--shiki-dark:#ffab70">{</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    Error</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">e</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Error</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">e</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    Ok</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ParseNodeResult</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">node, rest</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> rest </span><span style="color:#5a32a3;--shiki-dark:#b392f0">{</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">        ""</span><span style="color:#D73A49;--shiki-dark:#F97583"> -</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Ok</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">node</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">        _</span><span style="color:#D73A49;--shiki-dark:#F97583"> -</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Error</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"unexpected non EOF"</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      </span><span style="color:#5a32a3;--shiki-dark:#b392f0">}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  </span><span style="color:#e36209;--shiki-dark:#ffab70">}</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">pub</span><span style="color:#D73A49;--shiki-dark:#F97583"> fn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> main</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  let</span><span style="color:#6A737D;--shiki-dark:#6A737D"> _</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> io.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">debug</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">parse_json</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"null"</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  let</span><span style="color:#6A737D;--shiki-dark:#6A737D"> _</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> io.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">debug</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">parse_json</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"true"</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  let</span><span style="color:#6A737D;--shiki-dark:#6A737D"> _</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> io.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">debug</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">parse_json</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"false"</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  let</span><span style="color:#6A737D;--shiki-dark:#6A737D"> _</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> io.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">debug</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">parse_json</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"</span><span style="color:#032F62;--shiki-dark:#9ECBFF">wwww</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  let</span><span style="color:#6A737D;--shiki-dark:#6A737D"> _</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> io.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">debug</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">parse_json</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"{}"</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  let</span><span style="color:#6A737D;--shiki-dark:#6A737D"> _</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> io.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">debug</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">parse_json</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"{</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"</span><span style="color:#032F62;--shiki-dark:#9ECBFF">a</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"</span><span style="color:#032F62;--shiki-dark:#9ECBFF">: true, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"</span><span style="color:#032F62;--shiki-dark:#9ECBFF">b</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"</span><span style="color:#032F62;--shiki-dark:#9ECBFF">: [true, false, null]}"</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  let</span><span style="color:#6A737D;--shiki-dark:#6A737D"> _</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> io.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">debug</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">parse_json</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"[ true, false, null, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"</span><span style="color:#032F62;--shiki-dark:#9ECBFF">abcd</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> ]"</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  io.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">debug</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"done"</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span></code></pre>
</details>
<h3 id="还有一些缺陷">还有一些缺陷</h3>
<p lang="zh">可能是我不会用的原因，gleam 莫名不能 production build……build 的产物全是在 dev 文件夹下的，令人担忧它实际的能力</p>
<p lang="zh">gleam 也不能随便找个文件夹就开始编写单文件代码然后直接 build 一个可执行文件，必须新建一个 project</p>
<h3 id="总结">总结</h3>
<p lang="zh">Gleam 是一个长得很像 rust 的纯函数式语言。由于我不怎么写函数式，写起来还是略微费劲了一点（）</p>
<p lang="zh">像下面 ⬇️ 这样的代码片段显得 gleam 很有魅力，但是因为没有 if，遇到只有两个的情况还不得不 case match 就有点令人抓狂了</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="gleam"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">use</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ParseStrResult</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">key, rest</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">then</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">parse_str</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">x</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">use</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> rest </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">then</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">parse_col</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">rest</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">use</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ParseNodeResult</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">node, rest</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">then</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">parse_node</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">rest</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> rest </span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> string.trim_start </span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> string.pop_grapheme </span><span style="color:#005cc5;--shiki-dark:#79b8ff">{</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  Ok</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">#</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">","</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, next</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    next</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    |</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> string.trim_start</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    |</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> parse_obj</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    |</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#D73A49;--shiki-dark:#F97583">fn</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">res</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#5a32a3;--shiki-dark:#b392f0">{</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      ParseObjResult</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">res.result </span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> dict.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">insert</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">key, node</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, res.rest</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    </span><span style="color:#5a32a3;--shiki-dark:#b392f0">}</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  Ok</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">#</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"}"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, rest</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    Ok</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ParseObjResult</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">dict.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">from_list</span><span style="color:#005cc5;--shiki-dark:#79b8ff">(</span><span style="color:#e36209;--shiki-dark:#ffab70">[</span><span style="color:#24292E;--shiki-dark:#E1E4E8">#</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">key, node</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">]</span><span style="color:#005cc5;--shiki-dark:#79b8ff">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, rest</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  Ok</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">#</span><span style="color:#5a32a3;--shiki-dark:#b392f0">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">x, </span><span style="color:#6A737D;--shiki-dark:#6A737D">_</span><span style="color:#5a32a3;--shiki-dark:#b392f0">)</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Error</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"unexpected token "</span><span style="color:#D73A49;--shiki-dark:#F97583"> </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  Error</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#6A737D;--shiki-dark:#6A737D">_</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Error</span><span style="color:#e36209;--shiki-dark:#ffab70">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"unexpected eof"</span><span style="color:#e36209;--shiki-dark:#ffab70">)</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79b8ff">}</span></span></code></pre>
<section data-footnotes="" class="footnotes"><h2 class="sr-only" id="footnote-label">脚注</h2>
<ol lang="zh">
<li id="user-content-fn-elixir%20%E7%9A%84%E8%BF%9B%E7%A8%8B%E6%98%AF%20erlang%20%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%8F%90%E4%BE%9B%E7%9A%84%E2%80%9C%E8%BD%BB%E9%87%8F%E7%BA%A7%E2%80%9D%E8%BF%9B%E7%A8%8B%EF%BC%8C%E7%94%9A%E8%87%B3%E6%AF%94%E4%B8%80%E8%88%AC%E8%AF%AD%E8%A8%80%E7%9A%84%E7%BA%BF%E7%A8%8B%E8%BF%98%E8%BD%BB%E9%87%8F">
<p lang="zh">Elixir 的进程是 Erlang 虚拟机提供的“轻量级”进程，甚至比一般语言的线程还轻量 <a href="#user-content-fnref-elixir%20%E7%9A%84%E8%BF%9B%E7%A8%8B%E6%98%AF%20erlang%20%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%8F%90%E4%BE%9B%E7%9A%84%E2%80%9C%E8%BD%BB%E9%87%8F%E7%BA%A7%E2%80%9D%E8%BF%9B%E7%A8%8B%EF%BC%8C%E7%94%9A%E8%87%B3%E6%AF%94%E4%B8%80%E8%88%AC%E8%AF%AD%E8%A8%80%E7%9A%84%E7%BA%BF%E7%A8%8B%E8%BF%98%E8%BD%BB%E9%87%8F" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section> </div>
    <div class="divider"></div>
    <p class="post-meta flex flex-wrap items-center gap-2 text-base-content/60 undefined" data-astro-cid-qtyrxm4s> <span class="date flex gap-1 items-center flex-shrink-0 text-sm" data-astro-cid-qtyrxm4s> <svg width="1em" height="1em" data-icon="mingcute:calendar-2-line">   <symbol id="ai:mingcute:calendar-2-line" viewBox="0 0 24 24"><g fill="none" fill-rule="evenodd"><path d="m12.594 23.258l-.012.002l-.071.035l-.02.004l-.014-.004l-.071-.036q-.016-.004-.024.006l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.016-.018m.264-.113l-.014.002l-.184.093l-.01.01l-.003.011l.018.43l.005.012l.008.008l.201.092q.019.005.029-.008l.004-.014l-.034-.614q-.005-.019-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.003-.011l.018-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M16 3a1 1 0 0 1 1 1v1h2a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h2V4a1 1 0 0 1 2 0v1h6V4a1 1 0 0 1 1-1M8 7H5v2h14V7h-3zm-3 4v8h14v-8zm2 2a1 1 0 0 1 1-1h.01a1 1 0 1 1 0 2H8a1 1 0 0 1-1-1m1 2a1 1 0 1 0 0 2h.01a1 1 0 1 0 0-2zm3-2a1 1 0 0 1 1-1h.01a1 1 0 1 1 0 2H12a1 1 0 0 1-1-1m1 2a1 1 0 1 0 0 2h.01a1 1 0 1 0 0-2zm3-2a1 1 0 0 1 1-1h.01a1 1 0 1 1 0 2H16a1 1 0 0 1-1-1m1 2a1 1 0 1 0 0 2h.01a1 1 0 1 0 0-2z"/></g></symbol><use href="#ai:mingcute:calendar-2-line"></use>  </svg> <time datetime="2025-01-06T10:36:24.000Z"> 2025-01-06 </time> </span> <span class="categories items" data-astro-cid-qtyrxm4s>  </span> <span class="tags items" data-astro-cid-qtyrxm4s> <a class="item" href="/tags/Code/" data-astro-cid-qtyrxm4s> <svg width="1em" height="1em" class="flex-shrink-0" data-astro-cid-qtyrxm4s="true" data-icon="mingcute:tag-line">   <symbol id="ai:mingcute:tag-line" viewBox="0 0 24 24"><g fill="none" fill-rule="evenodd"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M10.537 2.164a3 3 0 0 1 2.244.727l.15.14l7.822 7.823a3 3 0 0 1 .135 4.098l-.135.144l-5.657 5.657a3 3 0 0 1-4.098.135l-.144-.135L3.03 12.93a3 3 0 0 1-.878-2.188l.011-.205l.472-5.185a3 3 0 0 1 2.537-2.695l.179-.021zm.308 1.989l-.127.003l-5.185.472a1 1 0 0 0-.888.787l-.017.118l-.472 5.185a1 1 0 0 0 .206.703l.083.095l7.823 7.823a1 1 0 0 0 1.32.083l.094-.083l5.657-5.657a1 1 0 0 0 .083-1.32l-.083-.094l-7.823-7.823a1 1 0 0 0-.671-.292M7.317 7.318a3 3 0 1 1 4.243 4.243a3 3 0 0 1-4.243-4.243m2.829 1.414a1 1 0 1 0-1.415 1.414a1 1 0 0 0 1.415-1.414"/></g></symbol><use href="#ai:mingcute:tag-line"></use>  </svg> <span class="truncate" data-astro-cid-qtyrxm4s>Code</span> </a><a class="item" href="/tags/Gleam/" data-astro-cid-qtyrxm4s> <svg width="1em" height="1em" viewBox="0 0 24 24" class="flex-shrink-0" data-astro-cid-qtyrxm4s="true" data-icon="mingcute:tag-line">   <use href="#ai:mingcute:tag-line"></use>  </svg> <span class="truncate" data-astro-cid-qtyrxm4s>Gleam</span> </a><a class="item" href="/tags/Functional/" data-astro-cid-qtyrxm4s> <svg width="1em" height="1em" viewBox="0 0 24 24" class="flex-shrink-0" data-astro-cid-qtyrxm4s="true" data-icon="mingcute:tag-line">   <use href="#ai:mingcute:tag-line"></use>  </svg> <span class="truncate" data-astro-cid-qtyrxm4s>Functional</span> </a><a class="item" href="/tags/Programing Language/" data-astro-cid-qtyrxm4s> <svg width="1em" height="1em" viewBox="0 0 24 24" class="flex-shrink-0" data-astro-cid-qtyrxm4s="true" data-icon="mingcute:tag-line">   <use href="#ai:mingcute:tag-line"></use>  </svg> <span class="truncate" data-astro-cid-qtyrxm4s>Programing Language</span> </a> </span> </p> 
    <div class="mt-8"><div class="comments-container"> <div id="gitalk-mainEl" data-uid="blog:gleam-intro"></div> </div> <script type="module" src="/_astro/GitalkComment.astro_astro_type_script_index_0_lang.yHboq2cn.js"></script> </div> </div> </article>  </main> <footer> <div class="text-center mb-4 markdown-body"> <p>
&copy; 2025 Linca. All rights reserved.
</p> <p>
开业 <span id="BLOG_DAYS" data-first-date="1538918349000">2543</span> 天里，写下了 54 篇博客，2 篇页面，8 篇杂记，352905 字符。
</p> <p>
Powered by
<a href="https://astro.build" target="_blank" rel="noopener noreferrer">
Astro
</a>
and
<a href="https://github.com/Lhcfl/astro-theme-krypton2" target="_blank" rel="noopener noreferrer">
Krypton 2
</a>.
</p> </div> </footer> <script type="module">document.addEventListener("astro:page-load",()=>{const t=document.getElementById("BLOG_DAYS");if(t){const e=Date.now()-Number(t.dataset.firstDate),n=Math.floor(e/(1e3*60*60*24));t.textContent=n.toString()}});</script> </div> </div> <div class="sidebar__outer-container
              hidden print:hidden!
              flex-grow-0 flex-shrink max-w-70 has-sidebar:flex-shrink-0
              md:block md:relative md:has-sidebar:w-50
              lg:flex-shrink-0 lg:has-sidebar:w-70
              xl:w-70
              max-md:show-toc:z-10 max-md:show-toc:block max-md:show-toc:fixed max-md:show-toc:bottom-2 max-md:show-toc:w-full max-md:show-toc:max-w-full
              max-md:[body.show-toc_&]:animate-fade-in-up max-md:[body.show-toc_&]:animate-duration-300 max-md:[body.show-toc_&]:animate-ease-in-out
              max-md:[body.removing-toc_&]:animate-fade-out-down max-md:[body.removing-toc_&]:animate-duration-300 max-md:[body.removing-toc_&]:animate-ease-in-out"> <div class="sidebar__inner-container
          sticky top-0 bg-surface pt-6
          md:px-0 md:h-screen
          max-md:show-toc:px-2 max-md:show-toc:pt-4 max-md:show-toc:border-t max-md:show-toc:border-base-300 overflow-y-auto overflow-x-visible">  <div class="hidden has-sidebar:block min-[55rem]:block">  </div> </div> </div>  </div> <div class="float-buttons fixed bottom-4 right-4 flex flex-col gap-2 print:hidden! text-base-content" aria-hidden="true"> <div class="opacity-0 translate-x-20 transition [body.is-scrolled_&]:opacity-100 [body.is-scrolled_&]:translate-x-0"> <button onclick="window.scrollTo({ top: 0, behavior: 'smooth' })" class="rounded-full p-4 text-lg md:text-xl bg-surface border-base-300 border" aria-label="Scroll to top"> <div class="i-mingcute:arrow-up-line"></div> </button> </div> <div class="hidden has-sidebar:block md:hidden!"> <button onclick="document.body.classList.add('show-toc')" class="rounded-full p-4 text-lg md:text-xl bg-surface border-base-300 border" aria-label="Show TOC"> <div class="i-mingcute:list-check-fill"></div> </button> </div> </div> <script type="module">document.addEventListener("scroll",()=>{window.scrollY>100?document.body.classList.add("is-scrolled"):document.body.classList.remove("is-scrolled")});document.addEventListener("click",s=>{if(!document.body.classList.contains("show-toc"))return;let t=s.target;for(;t!=null;){if(t.classList.contains("float-buttons")||t.classList.contains("sidebar__inner-container"))return;t=t.parentElement}document.body.classList.remove("show-toc"),document.body.classList.add("removing-toc"),setTimeout(()=>{document.body.classList.remove("removing-toc")},280),s.stopPropagation()});</script> </body></html>